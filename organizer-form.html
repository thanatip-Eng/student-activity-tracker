<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Portal - Student Talent Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1e5631 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border-left: 5px solid #27ae60;
        }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 50px; width: auto; }
        .logo h1 { color: #1a472a; font-size: 1.5em; }
        .logo p { color: #666; font-size: 0.9em; }
        .badge-organizer {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 550px;
            width: 100%;
            border-top: 5px solid #27ae60;
        }
        .login-card h2 { color: #1a472a; margin-bottom: 10px; font-size: 1.6em; }
        .login-card > p { color: #666; margin-bottom: 25px; }
        .login-form { display: flex; flex-direction: column; gap: 15px; }
        .login-form input {
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }
        .login-form input:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .login-form input[type="password"] { letter-spacing: 3px; }
        .login-form button {
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }
        .error-message { color: #e74c3c; font-size: 0.9em; min-height: 20px; margin-top: 10px; }
        
        /* First Login Info Box */
        .first-login-info {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #27ae60;
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            text-align: left;
        }
        .first-login-info h4 {
            color: #1a472a;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .first-login-info h4 .icon { font-size: 1.5em; }
        .info-step {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        .step-number {
            background: #27ae60;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
            flex-shrink: 0;
        }
        .step-text {
            color: #333;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .step-text strong { color: #1a472a; }
        .contact-box {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #e67e22;
        }
        .contact-box p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .contact-box a {
            color: #e67e22;
            font-weight: 600;
            text-decoration: none;
        }
        .contact-box a:hover { text-decoration: underline; }
        
        .organizer-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #27ae60;
        }
        .organizer-info { display: flex; align-items: center; gap: 15px; }
        .avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: 700;
        }
        .organizer-info strong { display: block; color: #1a472a; }
        .organizer-info span { color: #666; font-size: 0.9em; }
        .btn-logout {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-logout:hover { background: #e9ecef; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .tab:hover:not(.active) { background: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .form-card, .activities-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .form-card h2, .activities-panel h2 {
            color: #1a472a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }
        .section-title {
            color: #27ae60;
            font-weight: 600;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .required { color: #e74c3c; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #27ae60;
            outline: none;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .skills-selector { background: #f0fff4; border-radius: 12px; padding: 20px; }
        .selected-skills { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .no-skills { color: #999; font-style: italic; }
        .skill-tag {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .skill-level-badge {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
        }
        .remove-skill {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0 5px;
            font-size: 1.1em;
        }
        .btn-add-skill {
            background: white;
            border: 2px dashed #27ae60;
            color: #27ae60;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-add-skill:hover { background: #e8f5e9; }
        .student-ids-input {
            font-family: monospace;
            min-height: 120px;
            resize: vertical;
        }
        .btn-submit-group { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .btn-save, .btn-submit {
            flex: 1;
            min-width: 200px;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-save { background: #f8f9fa; border: 2px solid #27ae60; color: #27ae60; }
        .btn-save:hover { background: #e8f5e9; }
        .btn-submit { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4); }
        .activity-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #27ae60;
        }
        .activity-item.pending { border-left-color: #f39c12; }
        .activity-item.approved { border-left-color: #27ae60; }
        .activity-item.rejected { border-left-color: #e74c3c; }
        .activity-item.draft { border-left-color: #95a5a6; }
        .activity-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        .activity-title { font-weight: 600; color: #1a472a; font-size: 1.1em; }
        .activity-status { padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .activity-status.draft { background: #ecf0f1; color: #7f8c8d; }
        .activity-status.pending { background: #fff3e0; color: #e67e22; }
        .activity-status.approved { background: #e8f5e9; color: #27ae60; }
        .activity-status.rejected { background: #ffebee; color: #e74c3c; }
        .activity-meta { color: #666; font-size: 0.9em; margin-bottom: 10px; }
        .activity-skills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .skill-mini { background: #e3f2fd; color: #1976d2; padding: 3px 10px; border-radius: 15px; font-size: 0.8em; }
        .activity-actions { display: flex; gap: 10px; }
        .btn-action { padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 0.9em; transition: all 0.2s; }
        .btn-edit { background: #e3f2fd; color: #1976d2; }
        .btn-delete { background: #ffebee; color: #e74c3c; }
        .btn-action:hover { transform: translateY(-1px); }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state .icon { font-size: 4em; margin-bottom: 15px; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 20px; max-width: 800px; width: 100%; max-height: 85vh; overflow-y: auto; }
        .modal-header { padding: 25px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { color: #1a472a; }
        .modal-close { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #999; }
        .modal-body { padding: 25px; }
        .skill-domain { margin-bottom: 20px; }
        .skill-domain h4 { color: #27ae60; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e8f5e9; }
        .skill-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
        .skill-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s; }
        .skill-item:hover { background: #e8f5e9; }
        .skill-item.selected { background: #e8f5e9; border: 2px solid #27ae60; }
        .skill-info { flex: 1; display: flex; align-items: center; gap: 8px; }
        .skill-info label { cursor: pointer; }
        .skill-level { padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-modal { padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-cancel { background: #f8f9fa; border: 1px solid #ddd; }
        .btn-confirm { background: #27ae60; color: white; border: none; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; gap: 20px; }
        .loading-overlay.show { display: flex; }
        .spinner { width: 50px; height: 50px; border: 4px solid #e0e0e0; border-top-color: #27ae60; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 600px) {
            .login-card { padding: 30px 20px; }
            .header { flex-direction: column; text-align: center; }
            .btn-submit-group { flex-direction: column; }
            .organizer-bar { flex-direction: column; gap: 15px; text-align: center; }
            .first-login-info { padding: 20px 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <img src="images/MainLogo.png" alt="Logo" class="logo-img">
                <div>
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Registration</h1>
                    <p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | For Activity Organizers</p>
                </div>
            </div>
            <span class="badge-organizer">üë®‚Äçüíº ORGANIZER PORTAL</span>
        </header>

        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Portal</h2>
                <p>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°<br>Register activities and add participating students</p>
                
                <div class="login-form">
                    <input type="email" id="organizer-email" placeholder="Email (your-email@cmu.ac.th)">
                    <input type="password" id="organizer-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô | Password (min 4 chars)" minlength="4">
                    <button onclick="loginOrganizer()">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö | Login</button>
                </div>
                <p id="login-error" class="error-message"></p>
                
                <!-- First Login Info Box -->
                <div class="first-login-info">
                    <h4><span class="icon">‚ú®</span> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | How to Use</h4>
                    
                    <div class="info-step">
                        <span class="step-number">1</span>
                        <div class="step-text">
                            <strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (First Login):</strong><br>
                            ‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞ <strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</strong> (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)<br>
                            Enter your Email and <strong>create your password</strong> (min 4 characters)
                        </div>
                    </div>
                    
                    <div class="info-step">
                        <span class="step-number">2</span>
                        <div class="step-text">
                            <strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ (Next Login):</strong><br>
                            ‡πÉ‡∏ä‡πâ Email ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å<br>
                            Use the same Email and password you set initially
                        </div>
                    </div>
                    
                    <div class="info-step">
                        <span class="step-number">3</span>
                        <div class="step-text">
                            <strong>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î (Password is Permanent):</strong><br>
                            ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏<br>
                            Your password will work forever, no expiration
                        </div>
                    </div>
                    
                    <div class="contact-box">
                        <p>üîê <strong>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô? | Forgot Password?</strong></p>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô | Contact us to reset password:</p>
                        <a href="mailto:talentdev@eng.cmu.ac.th">üìß talentdev@eng.cmu.ac.th</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="main-section" class="main-section" style="display: none;">
            <div class="organizer-bar">
                <div class="organizer-info">
                    <span class="avatar" id="organizer-avatar">O</span>
                    <div>
                        <strong id="display-name">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer</strong>
                        <span id="display-email">organizer@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutOrganizer()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö | Logout</button>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="new-activity">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà | New Activity</button>
                <button class="tab" data-tab="my-activities">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Activities</button>
            </div>

            <div id="tab-new-activity" class="tab-content active">
                <div class="form-card">
                    <h2>üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà | Register New Activity</h2>
                    <form id="activity-form" onsubmit="saveActivity(event)">
                        <input type="hidden" id="edit-activity-id">
                        
                        <div class="section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î | Organizer Info</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô | Organizer Name <span class="required">*</span></label>
                                <input type="text" id="organizer-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏°‡∏£‡∏° AI | e.g. AI Club">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î | Department <span class="required">*</span></label>
                                <input type="text" id="department" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå | e.g. Faculty of Engineering">
                            </div>
                        </div>
                        
                        <div class="section-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Info</div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Name <span class="required">*</span></label>
                            <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° | Start Date <span class="required">*</span></label>
                                <input type="date" id="start-date" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î | End Date <span class="required">*</span></label>
                                <input type="date" id="end-date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ | Duration <span class="required">*</span></label>
                                <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô | Amount">
                            </div>
                            <div class="form-group">
                                <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ | Unit</label>
                                <select id="duration-unit">
                                    <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | Hours">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | Hours</option>
                                    <option value="‡∏ß‡∏±‡∏ô | Days">‡∏ß‡∏±‡∏ô | Days</option>
                                    <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | Weeks">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | Weeks</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Level <span class="required">*</span></label>
                            <select id="activity-level" required>
                                <option value="1">‡∏£‡∏∞‡∏î‡∏±‡∏ö 1 | Level 1 - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°/‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á | Participation</option>
                                <option value="2" selected>‡∏£‡∏∞‡∏î‡∏±‡∏ö 2 | Level 2 - ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥/‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î | Practice</option>
                                <option value="3">‡∏£‡∏∞‡∏î‡∏±‡∏ö 3 | Level 3 - ‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå/‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ | Application</option>
                                <option value="4">‡∏£‡∏∞‡∏î‡∏±‡∏ö 4 | Level 4 - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå/‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ | Leadership</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Description</label>
                            <textarea id="description" rows="4" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠... | Brief activity description..."></textarea>
                        </div>

                        <div class="section-title">üéØ ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö | Skills Gained <span class="required">*</span></div>
                        <div class="skills-selector">
                            <div id="selected-skills" class="selected-skills">
                                <p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | No skills selected</p>
                            </div>
                            <button type="button" class="btn-add-skill" onclick="openSkillModal()">
                                ‚ûï ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Select Skills
                            </button>
                        </div>

                        <div class="section-title">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student List <span class="required">*</span></div>
                        <div class="form-group">
                            <label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student IDs (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | one per line)</label>
                            <textarea id="student-ids" class="student-ids-input" rows="6" 
                                placeholder="640610001
640610002
640610003"></textarea>
                            <small style="color: #666;">‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (9 ‡∏´‡∏•‡∏±‡∏Å) ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Enter student IDs (9 digits) who participated</small>
                        </div>

                        <div class="btn-submit-group">
                            <button type="submit" class="btn-save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á | Save Draft</button>
                            <button type="button" class="btn-submit" onclick="saveAndSubmit()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | Submit for Approval</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-my-activities" class="tab-content">
                <div class="activities-panel">
                    <h2>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Activities</h2>
                    <div id="activities-list">
                        <div class="loading-inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skill Selection Modal -->
        <div id="skill-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö | Select Skills & Levels</h3>
                    <button class="modal-close" onclick="closeSkillModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="skill-categories"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn-modal btn-cancel" onclick="closeSkillModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å | Cancel</button>
                    <button class="btn-modal btn-confirm" onclick="confirmSkills()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô | Confirm</button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
            <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", nameEn: "Analytical Reasoning", domain: "Critical Thinking" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Problem Solving", domain: "Critical Thinking" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systems Thinking", domain: "Critical Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", nameEn: "Presentation", domain: "Communication" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", nameEn: "Listening", domain: "Communication" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", nameEn: "English", domain: "Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", nameEn: "Role Understanding", domain: "Teamwork" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", nameEn: "Task Management", domain: "Teamwork" },
            { code: "3.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", nameEn: "Collaboration", domain: "Teamwork" },
            { code: "4.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", nameEn: "Learning Agility", domain: "Digital & Learning" },
            { code: "4.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", nameEn: "Digital Literacy", domain: "Digital & Learning" },
            { code: "4.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", nameEn: "Tool Proficiency", domain: "Digital & Learning" },
            { code: "5.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", nameEn: "Human-Centered Design", domain: "Innovation" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", nameEn: "Project Management", domain: "Innovation" },
            { code: "5.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", nameEn: "Business Awareness", domain: "Innovation" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", nameEn: "Personal Growth", domain: "Self Development" },
            { code: "6.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", nameEn: "Resilience", domain: "Self Development" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", nameEn: "Empathy", domain: "Self Development" }
        ];
        const DOMAINS = ["Critical Thinking", "Communication", "Teamwork", "Digital & Learning", "Innovation", "Self Development"];
        let currentOrganizer = null, selectedSkills = [], currentActivityId = null;

        // LOGIN - Anyone can register (no permission check)
        async function loginOrganizer() {
            const email = document.getElementById('organizer-email').value.trim().toLowerCase();
            const password = document.getElementById('organizer-password').value.trim();
            const errorEl = document.getElementById('login-error');
            errorEl.textContent = '';
            
            if (!email || !email.includes('@')) { 
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á | Please enter valid Email'; 
                return; 
            }
            if (!password || password.length < 4) { 
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£) | Password must be at least 4 characters'; 
                return; 
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö... | Logging in...');
            
            try {
                // Check if organizer exists
                const q = await db.collection('organizers').where('email', '==', email).limit(1).get();
                
                if (q.empty) {
                    // First time login - create new organizer record
                    const newOrganizer = {
                        email: email,
                        name: email.split('@')[0],
                        password: password,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    const docRef = await db.collection('organizers').add(newOrganizer);
                    currentOrganizer = { id: docRef.id, ...newOrganizer };
                } else {
                    // Existing organizer - verify password
                    const doc = q.docs[0];
                    const data = doc.data();
                    
                    if (!data.password) {
                        // Password not set yet - set it now
                        await db.collection('organizers').doc(doc.id).update({ password });
                        data.password = password;
                    } else if (password !== data.password) {
                        errorEl.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á | Incorrect password';
                        showLoading(false);
                        return;
                    }
                    
                    currentOrganizer = { id: doc.id, email, name: data.name || email.split('@')[0], ...data };
                }
                
                // Show main section
                document.getElementById('organizer-avatar').textContent = currentOrganizer.name.charAt(0).toUpperCase();
                document.getElementById('display-name').textContent = currentOrganizer.name;
                document.getElementById('display-email').textContent = email;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-section').style.display = 'block';
                
                await loadMyActivities();
                initSkillModal();
                
            } catch (e) { 
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message; 
            }
            showLoading(false);
        }

        function logoutOrganizer() {
            currentOrganizer = null; 
            selectedSkills = [];
            document.getElementById('activity-form').reset();
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('organizer-email').value = '';
            document.getElementById('organizer-password').value = '';
        }

        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                if (tab.dataset.tab === 'my-activities') loadMyActivities();
            });
        });

        // Skill modal
        function initSkillModal() {
            const container = document.getElementById('skill-categories');
            container.innerHTML = DOMAINS.map(domain => {
                const skills = CRITERIA_LIST.filter(c => c.domain === domain);
                return `<div class="skill-domain"><h4>${domain}</h4><div class="skill-items">${skills.map(s => `
                    <div class="skill-item" data-code="${s.code}">
                        <div class="skill-info">
                            <input type="checkbox" id="skill-${s.code}">
                            <label for="skill-${s.code}"><strong>${s.code}</strong> ${s.nameTh}<br><small>${s.nameEn}</small></label>
                        </div>
                        <select class="skill-level" disabled>
                            <option value="1">Lv.1</option>
                            <option value="2" selected>Lv.2</option>
                            <option value="3">Lv.3</option>
                            <option value="4">Lv.4</option>
                        </select>
                    </div>`).join('')}</div></div>`;
            }).join('');
            
            container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', e => {
                    const item = e.target.closest('.skill-item');
                    const sel = item.querySelector('.skill-level');
                    sel.disabled = !e.target.checked;
                    item.classList.toggle('selected', e.target.checked);
                });
            });
        }

        function openSkillModal() {
            document.querySelectorAll('.skill-item').forEach(item => {
                const code = item.dataset.code;
                const cb = item.querySelector('input[type="checkbox"]');
                const sel = item.querySelector('.skill-level');
                const ex = selectedSkills.find(s => s.code === code);
                if (ex) { 
                    cb.checked = true; 
                    sel.disabled = false; 
                    sel.value = ex.level; 
                    item.classList.add('selected'); 
                } else { 
                    cb.checked = false; 
                    sel.disabled = true; 
                    sel.value = '2'; 
                    item.classList.remove('selected'); 
                }
            });
            document.getElementById('skill-modal').classList.add('show');
        }

        function closeSkillModal() { 
            document.getElementById('skill-modal').classList.remove('show'); 
        }

        function confirmSkills() {
            selectedSkills = [];
            document.querySelectorAll('.skill-item').forEach(item => {
                if (item.querySelector('input[type="checkbox"]').checked) {
                    const code = item.dataset.code;
                    const level = parseInt(item.querySelector('.skill-level').value);
                    const c = CRITERIA_LIST.find(x => x.code === code);
                    selectedSkills.push({ code, level, nameTh: c.nameTh, nameEn: c.nameEn });
                }
            });
            renderSelectedSkills(); 
            closeSkillModal();
        }

        function renderSelectedSkills() {
            const c = document.getElementById('selected-skills');
            c.innerHTML = selectedSkills.length === 0 
                ? '<p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | No skills selected</p>' 
                : selectedSkills.map(s => `
                    <div class="skill-tag">
                        <span>${s.code} ${s.nameTh}</span>
                        <span class="skill-level-badge">Lv.${s.level}</span>
                        <button type="button" onclick="removeSkill('${s.code}')" class="remove-skill">‚úï</button>
                    </div>
                `).join('');
        }

        function removeSkill(code) { 
            selectedSkills = selectedSkills.filter(s => s.code !== code); 
            renderSelectedSkills(); 
        }

        // Save activity
        async function saveActivity(e) { 
            e.preventDefault(); 
            await saveActivityData('Draft'); 
        }

        async function saveAndSubmit() { 
            await saveActivityData('Pending'); 
        }

        async function saveActivityData(status) {
            if (!currentOrganizer) { 
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô | Please login first'); 
                return; 
            }
            if (selectedSkills.length === 0) { 
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Please select at least 1 skill'); 
                return; 
            }
            
            const studentIdsRaw = document.getElementById('student-ids').value.trim();
            const studentIds = studentIdsRaw.split('\n')
                .map(id => id.trim())
                .filter(id => id.length > 0);
            
            if (studentIds.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô | Please enter at least 1 student ID');
                return;
            }
            
            showLoading(true, status === 'Draft' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... | Saving...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥... | Submitting...');
            
            try {
                const activityData = {
                    organizerEmail: currentOrganizer.email,
                    organizerName: document.getElementById('organizer-name').value.trim(),
                    department: document.getElementById('department').value.trim(),
                    activityName: document.getElementById('activity-name').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: document.getElementById('duration').value,
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.getElementById('activity-level').value),
                    description: document.getElementById('description').value.trim(),
                    skills: selectedSkills,
                    studentIds: studentIds,
                    status: status,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                const editId = document.getElementById('edit-activity-id').value;
                if (editId) {
                    await db.collection('organizerActivities').doc(editId).update(activityData);
                } else {
                    activityData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('organizerActivities').add(activityData);
                }

                const msg = status === 'Draft' 
                    ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! | Draft saved!' 
                    : '‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! | Submitted for approval!';
                alert(msg);
                
                document.getElementById('activity-form').reset();
                document.getElementById('edit-activity-id').value = '';
                selectedSkills = [];
                renderSelectedSkills();
                
            } catch (e) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message);
            }
            showLoading(false);
        }

        // Load my activities
        async function loadMyActivities() {
            const list = document.getElementById('activities-list');
            list.innerHTML = '<div class="loading-inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</div>';
            
            try {
                const q = await db.collection('organizerActivities')
                    .where('organizerEmail', '==', currentOrganizer.email)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (q.empty) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | No activities yet</p>
                        </div>`;
                    return;
                }
                
                list.innerHTML = q.docs.map(doc => {
                    const d = doc.data();
                    const statusClass = (d.status || 'draft').toLowerCase();
                    const statusText = {
                        'draft': 'üìù ‡∏£‡πà‡∏≤‡∏á | Draft',
                        'pending': '‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö | Pending',
                        'approved': '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | Approved',
                        'rejected': '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | Rejected'
                    }[statusClass] || d.status;
                    
                    return `
                        <div class="activity-item ${statusClass}">
                            <div class="activity-header">
                                <span class="activity-title">${d.activityName}</span>
                                <span class="activity-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="activity-meta">
                                üìÖ ${d.startDate || '-'} | üë• ${(d.studentIds || []).length} ‡∏Ñ‡∏ô | students | üìä Lv.${d.activityLevel || 2}
                            </div>
                            <div class="activity-skills">
                                ${(d.skills || []).map(s => `<span class="skill-mini">${s.code} Lv.${s.level}</span>`).join('')}
                            </div>
                            ${d.status === 'Rejected' && d.rejectReason ? `<div style="color:#e74c3c;font-size:0.9em;margin-bottom:10px;">‚ùå ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• | Reason: ${d.rejectReason}</div>` : ''}
                            <div class="activity-actions">
                                ${d.status === 'Draft' || d.status === 'Rejected' ? `
                                    <button class="btn-action btn-edit" onclick="editActivity('${doc.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç | Edit</button>
                                    <button class="btn-action btn-delete" onclick="deleteActivity('${doc.id}')">üóëÔ∏è ‡∏•‡∏ö | Delete</button>
                                ` : ''}
                            </div>
                        </div>`;
                }).join('');
                
            } catch (e) {
                list.innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ${e.message}</p></div>`;
            }
        }

        async function editActivity(id) {
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...');
            try {
                const doc = await db.collection('organizerActivities').doc(id).get();
                if (!doc.exists) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity not found'); return; }
                const d = doc.data();
                
                document.getElementById('edit-activity-id').value = id;
                document.getElementById('organizer-name').value = d.organizerName || '';
                document.getElementById('department').value = d.department || '';
                document.getElementById('activity-name').value = d.activityName || '';
                document.getElementById('start-date').value = d.startDate || '';
                document.getElementById('end-date').value = d.endDate || '';
                document.getElementById('duration').value = d.duration || '';
                document.getElementById('duration-unit').value = d.durationUnit || '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | Hours';
                document.getElementById('activity-level').value = d.activityLevel || 2;
                document.getElementById('description').value = d.description || '';
                document.getElementById('student-ids').value = (d.studentIds || []).join('\n');
                
                selectedSkills = d.skills || [];
                renderSelectedSkills();
                
                // Switch to new activity tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-tab="new-activity"]').classList.add('active');
                document.getElementById('tab-new-activity').classList.add('active');
                
            } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message); }
            showLoading(false);
        }

        async function deleteActivity(id) {
            if (!confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?\nConfirm delete this activity?')) return;
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö... | Deleting...');
            try {
                await db.collection('organizerActivities').doc(id).delete();
                alert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ | Deleted successfully');
                await loadMyActivities();
            } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message); }
            showLoading(false);
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...') {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').textContent = text;
            if (show) overlay.classList.add('show');
            else overlay.classList.remove('show');
        }

        // Enter key handlers
        document.getElementById('organizer-email').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('organizer-password').focus();
        });
        document.getElementById('organizer-password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginOrganizer();
        });
    </script>
</body>
</html>
