<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - Organizer Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1e5631 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border-left: 5px solid #27ae60;
        }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-icon { font-size: 2.5em; }
        .logo h1 { color: #1a472a; font-size: 1.5em; }
        .logo p { color: #666; font-size: 0.9em; }
        .badge-organizer {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 480px;
            width: 100%;
            border-top: 5px solid #27ae60;
        }
        .login-card h2 { color: #1a472a; margin-bottom: 10px; }
        .login-card > p { color: #666; margin-bottom: 25px; }
        .login-form { display: flex; flex-direction: column; gap: 15px; }
        .login-form input {
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }
        .login-form input:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .login-form input[type="password"] { letter-spacing: 3px; }
        .login-form button {
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }
        .login-note { margin-top: 20px; font-size: 0.85em; color: #999; }
        .error-message { color: #e74c3c; font-size: 0.9em; min-height: 20px; margin-top: 10px; }
        .access-denied {
            background: #fff5f5;
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }
        .access-denied h4 { color: #c0392b; margin-bottom: 10px; }
        .access-denied p { color: #666; font-size: 0.9em; margin-bottom: 5px; }
        .organizer-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #27ae60;
        }
        .organizer-info { display: flex; align-items: center; gap: 15px; }
        .avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: 700;
        }
        .organizer-info strong { display: block; color: #1a472a; }
        .organizer-info span { color: #666; font-size: 0.9em; }
        .btn-logout {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-logout:hover { background: #e9ecef; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .tab:hover:not(.active) { background: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .form-card, .activities-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .form-card h2, .activities-panel h2 {
            color: #1a472a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }
        .section-title {
            color: #27ae60;
            font-weight: 600;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .required { color: #e74c3c; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            font-size: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
            font-family: inherit;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .level-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .level-option { cursor: pointer; }
        .level-option input { display: none; }
        .level-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }
        .level-option input:checked + .level-card { background: #e8f5e9; border-color: #27ae60; }
        .level-number { display: block; font-size: 2em; font-weight: 700; color: #27ae60; }
        .level-title { display: block; font-weight: 600; color: #333; margin: 5px 0; }
        .skills-selector { background: #f0fff4; border-radius: 12px; padding: 20px; }
        .selected-skills { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .no-skills { color: #999; font-style: italic; }
        .skill-tag {
            background: white;
            border: 1px solid #27ae60;
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
        }
        .skill-level-badge {
            background: #27ae60;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .remove-skill { background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1.1em; padding: 0 5px; }
        .btn-add-skill {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-add-skill:hover { background: #219a52; }
        .form-actions { display: flex; gap: 15px; margin-top: 30px; justify-content: flex-end; flex-wrap: wrap; }
        .btn-submit, .btn-secondary {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-submit { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4); }
        .btn-secondary { background: #f8f9fa; color: #333; border: 2px solid #ddd; }
        .btn-secondary:hover { background: #e9ecef; }
        .activity-card {
            background: #f0fff4;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #27ae60;
        }
        .activity-card.status-approved { border-left-color: #27ae60; }
        .activity-card.status-pending { border-left-color: #f39c12; }
        .activity-card.status-rejected { border-left-color: #e74c3c; }
        .activity-card.status-draft { border-left-color: #95a5a6; }
        .activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .activity-header h3 { color: #1a472a; font-size: 1.1em; }
        .activity-meta { display: flex; gap: 20px; color: #666; font-size: 0.9em; margin-bottom: 10px; flex-wrap: wrap; }
        .activity-skills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .skill-mini { background: #e8f5e9; color: #27ae60; padding: 4px 10px; border-radius: 15px; font-size: 0.8em; font-weight: 500; }
        .activity-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-small { padding: 8px 16px; font-size: 0.9em; border: none; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
        .btn-edit { background: #e8f5e9; color: #27ae60; }
        .btn-submit-approval { background: #27ae60; color: white; }
        .btn-students { background: #e3f2fd; color: #1976d2; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .status-badge.approved { background: #d4edda; color: #155724; }
        .status-badge.pending { background: #fff3cd; color: #856404; }
        .status-badge.rejected { background: #f8d7da; color: #721c24; }
        .status-badge.draft { background: #e2e3e5; color: #383d41; }
        .reject-reason { background: #fff0f0; color: #c0392b; padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-size: 0.9em; }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal { background: white; border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; border-bottom: 1px solid #e0e0e0; }
        .modal-header h3 { color: #1a472a; }
        .modal-close { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #999; }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid #e0e0e0; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .skill-modal { max-width: 700px; }
        .skill-categories { max-height: 400px; overflow-y: auto; }
        .skill-domain { margin-bottom: 20px; }
        .skill-domain h4 { color: #27ae60; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0; }
        .skill-items { display: flex; flex-direction: column; gap: 8px; }
        .skill-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #f8f9fa; border-radius: 8px; transition: all 0.3s; }
        .skill-item.selected { background: #e8f5e9; }
        .skill-info { display: flex; align-items: center; gap: 10px; }
        .skill-info label { cursor: pointer; }
        .skill-level { padding: 5px 10px; border: 1px solid #ddd; border-radius: 5px; }
        .students-modal { max-width: 500px; }
        .students-modal textarea { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-family: monospace; resize: vertical; }
        .student-count { margin-top: 10px; color: #666; font-size: 0.9em; }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .loading-overlay.show { display: flex; }
        .loading-box { background: white; padding: 40px 60px; border-radius: 16px; text-align: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #27ae60; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state .icon { font-size: 4em; margin-bottom: 15px; }
        .activities-list { max-height: 600px; overflow-y: auto; }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { flex-direction: column; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .level-options { grid-template-columns: repeat(2, 1fr); }
            .form-actions { flex-direction: column; }
            .form-actions button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üë®‚Äçüíº</span>
                <div>
                    <h1>Organizer Portal</h1>
                    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</p>
                </div>
            </div>
            <span class="badge-organizer">üîê ORGANIZER ACCESS</span>
        </header>

        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏≤‡∏Å Admin</p>
                <div class="login-form">
                    <input type="email" id="organizer-email" placeholder="organizer@cmu.ac.th">
                    <input type="password" id="organizer-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)" minlength="4">
                    <button onclick="loginOrganizer()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <p id="login-error" class="error-message"></p>
                <div id="access-denied-box" class="access-denied" style="display: none;">
                    <h4>‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h4>
                    <p>Email ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                </div>
                <p class="login-note">üí° ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏≤‡∏Å Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å? ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</p>
            </div>
        </section>

        <section id="main-section" class="main-section" style="display: none;">
            <div class="organizer-bar">
                <div class="organizer-info">
                    <span class="avatar" id="organizer-avatar">O</span>
                    <div>
                        <strong id="display-name">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</strong>
                        <span id="display-email">organizer@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutOrganizer()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="new-activity">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                <button class="tab" data-tab="my-activities">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
            </div>

            <div id="tab-new-activity" class="tab-content active">
                <div class="form-card">
                    <h2>üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="activity-form" onsubmit="saveActivity(event)">
                        <input type="hidden" id="edit-activity-id">
                        <div class="section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                                <input type="text" id="organizer-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏°‡∏£‡∏° AI">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î <span class="required">*</span></label>
                                <input type="text" id="department" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                            </div>
                        </div>
                        <div class="section-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="required">*</span></label>
                                <input type="date" id="start-date" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="required">*</span></label>
                                <input type="date" id="end-date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ <span class="required">*</span></label>
                                <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                            </div>
                            <div class="form-group">
                                <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                <select id="duration-unit">
                                    <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                    <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô</option>
                                    <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <div class="level-options">
                                <label class="level-option"><input type="radio" name="activity-level" value="1" required><div class="level-card"><span class="level-number">1</span><span class="level-title">‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</span></div></label>
                                <label class="level-option"><input type="radio" name="activity-level" value="2"><div class="level-card"><span class="level-number">2</span><span class="level-title">Workshop</span></div></label>
                                <label class="level-option"><input type="radio" name="activity-level" value="3"><div class="level-card"><span class="level-number">3</span><span class="level-title">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</span></div></label>
                                <label class="level-option"><input type="radio" name="activity-level" value="4"><div class="level-card"><span class="level-number">4</span><span class="level-title">‡∏ú‡∏π‡πâ‡∏ô‡∏≥/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</span></div></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <textarea id="description" required rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ <span class="required">*</span></label>
                            <textarea id="learning-outcomes" required rows="3" placeholder="‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á..."></textarea>
                        </div>
                        <div class="section-title">üéØ ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</div>
                        <div class="skills-selector">
                            <div id="selected-skills" class="selected-skills"></div>
                            <button type="button" class="btn-add-skill" onclick="openSkillModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏Å‡∏©‡∏∞</button>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label>Link ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input type="url" id="promotional-link" placeholder="https://...">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-secondary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á</button>
                            <button type="button" class="btn-submit" onclick="saveAndSubmit()">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-my-activities" class="tab-content">
                <div class="activities-panel">
                    <h2>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                    <div id="my-activities-list" class="activities-list">
                        <div class="empty-state"><span class="icon">üì≠</span><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p></div>
                    </div>
                </div>
            </div>
        </section>

        <div id="skill-modal" class="modal-overlay">
            <div class="modal skill-modal">
                <div class="modal-header"><h3>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞</h3><button class="modal-close" onclick="closeSkillModal()">‚úï</button></div>
                <div class="modal-body"><div id="skill-categories" class="skill-categories"></div></div>
                <div class="modal-footer"><button class="btn-secondary" onclick="closeSkillModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="btn-primary" onclick="confirmSkills()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div>
            </div>
        </div>

        <div id="students-modal" class="modal-overlay">
            <div class="modal students-modal">
                <div class="modal-header"><h3>üë• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3><button class="modal-close" onclick="closeStudentsModal()">‚úï</button></div>
                <div class="modal-body">
                    <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢ Enter ‡∏´‡∏£‡∏∑‡∏≠ , )</p>
                    <textarea id="student-ids-input" rows="6" placeholder="640610001&#10;640610002"></textarea>
                    <div id="student-count" class="student-count"></div>
                </div>
                <div class="modal-footer"><button class="btn-secondary" onclick="closeStudentsModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="btn-primary" onclick="addStudentsToActivity()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button></div>
            </div>
        </div>

        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-box"><div class="spinner"></div><p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", domain: "Critical Thinking" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", domain: "Critical Thinking" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö", domain: "Critical Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", domain: "Communication" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", domain: "Communication" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", domain: "Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", domain: "Teamwork" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", domain: "Teamwork" },
            { code: "3.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", domain: "Teamwork" },
            { code: "4.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", domain: "Digital & Learning" },
            { code: "4.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", domain: "Digital & Learning" },
            { code: "4.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", domain: "Digital & Learning" },
            { code: "5.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", domain: "Innovation" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", domain: "Innovation" },
            { code: "5.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", domain: "Innovation" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", domain: "Self Development" },
            { code: "6.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", domain: "Self Development" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", domain: "Self Development" }
        ];
        const DOMAINS = ["Critical Thinking", "Communication", "Teamwork", "Digital & Learning", "Innovation", "Self Development"];
        let currentOrganizer = null, selectedSkills = [], currentActivityId = null;

        async function loginOrganizer() {
            const email = document.getElementById('organizer-email').value.trim().toLowerCase();
            const password = document.getElementById('organizer-password').value.trim();
            const errorEl = document.getElementById('login-error');
            const accessDeniedBox = document.getElementById('access-denied-box');
            errorEl.textContent = ''; accessDeniedBox.style.display = 'none';
            if (!email || !email.includes('@')) { errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'; return; }
            if (!password || password.length < 4) { errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)'; return; }
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...');
            try {
                const q = await db.collection('organizers').where('email', '==', email).limit(1).get();
                if (q.empty) { accessDeniedBox.style.display = 'block'; showLoading(false); return; }
                const doc = q.docs[0], data = doc.data();
                if (!data.password) { await db.collection('organizers').doc(doc.id).update({ password }); data.password = password; }
                else if (password !== data.password) { errorEl.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'; showLoading(false); return; }
                currentOrganizer = { id: doc.id, email, name: data.name || email.split('@')[0], ...data };
                document.getElementById('organizer-avatar').textContent = currentOrganizer.name.charAt(0).toUpperCase();
                document.getElementById('display-name').textContent = currentOrganizer.name;
                document.getElementById('display-email').textContent = email;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-section').style.display = 'block';
                await loadMyActivities(); initSkillModal();
            } catch (e) { errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message; }
            showLoading(false);
        }

        function logoutOrganizer() {
            currentOrganizer = null; selectedSkills = [];
            document.getElementById('activity-form').reset();
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('organizer-email').value = '';
            document.getElementById('organizer-password').value = '';
            document.getElementById('access-denied-box').style.display = 'none';
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                if (tab.dataset.tab === 'my-activities') loadMyActivities();
            });
        });

        function initSkillModal() {
            const container = document.getElementById('skill-categories');
            container.innerHTML = DOMAINS.map(domain => {
                const skills = CRITERIA_LIST.filter(c => c.domain === domain);
                return `<div class="skill-domain"><h4>${domain}</h4><div class="skill-items">${skills.map(s => `
                    <div class="skill-item" data-code="${s.code}">
                        <div class="skill-info"><input type="checkbox" id="skill-${s.code}"><label for="skill-${s.code}"><strong>${s.code}</strong> ${s.nameTh}</label></div>
                        <select class="skill-level" disabled><option value="1">Lv.1</option><option value="2">Lv.2</option><option value="3">Lv.3</option><option value="4">Lv.4</option></select>
                    </div>`).join('')}</div></div>`;
            }).join('');
            container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', e => {
                    const item = e.target.closest('.skill-item'), sel = item.querySelector('.skill-level');
                    sel.disabled = !e.target.checked;
                    item.classList.toggle('selected', e.target.checked);
                });
            });
        }

        function openSkillModal() {
            document.querySelectorAll('.skill-item').forEach(item => {
                const code = item.dataset.code, cb = item.querySelector('input[type="checkbox"]'), sel = item.querySelector('.skill-level');
                const ex = selectedSkills.find(s => s.code === code);
                if (ex) { cb.checked = true; sel.disabled = false; sel.value = ex.level; item.classList.add('selected'); }
                else { cb.checked = false; sel.disabled = true; sel.value = '1'; item.classList.remove('selected'); }
            });
            document.getElementById('skill-modal').classList.add('show');
        }
        function closeSkillModal() { document.getElementById('skill-modal').classList.remove('show'); }
        function confirmSkills() {
            selectedSkills = [];
            document.querySelectorAll('.skill-item').forEach(item => {
                if (item.querySelector('input[type="checkbox"]').checked) {
                    const code = item.dataset.code, level = parseInt(item.querySelector('.skill-level').value);
                    const c = CRITERIA_LIST.find(x => x.code === code);
                    selectedSkills.push({ code, level, nameTh: c.nameTh });
                }
            });
            renderSelectedSkills(); closeSkillModal();
        }
        function renderSelectedSkills() {
            const c = document.getElementById('selected-skills');
            c.innerHTML = selectedSkills.length === 0 ? '<p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞</p>' :
                selectedSkills.map(s => `<div class="skill-tag"><span>${s.code} ${s.nameTh}</span><span class="skill-level-badge">Lv.${s.level}</span><button type="button" onclick="removeSkill('${s.code}')" class="remove-skill">‚úï</button></div>`).join('');
        }
        function removeSkill(code) { selectedSkills = selectedSkills.filter(s => s.code !== code); renderSelectedSkills(); }

        async function saveActivity(e) { e.preventDefault(); await saveActivityData('Draft'); }
        async function saveAndSubmit() { await saveActivityData('Pending'); }
        async function saveActivityData(status) {
            if (!currentOrganizer) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
            if (selectedSkills.length === 0) { alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞'); return; }
            showLoading(true, status === 'Draft' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            try {
                const data = {
                    organizerEmail: currentOrganizer.email,
                    organizerName: document.getElementById('organizer-name').value.trim(),
                    department: document.getElementById('department').value.trim(),
                    activityName: document.getElementById('activity-name').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: parseInt(document.getElementById('duration').value),
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.querySelector('input[name="activity-level"]:checked').value),
                    description: document.getElementById('description').value.trim(),
                    learningOutcomes: document.getElementById('learning-outcomes').value.trim(),
                    skills: selectedSkills,
                    promotionalLink: document.getElementById('promotional-link').value.trim(),
                    status, studentIds: [], studentCount: 0,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                const editId = document.getElementById('edit-activity-id').value;
                if (editId) await db.collection('organizerActivities').doc(editId).update(data);
                else { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await db.collection('organizerActivities').add(data); }
                document.getElementById('activity-form').reset(); document.getElementById('edit-activity-id').value = '';
                selectedSkills = []; renderSelectedSkills();
                alert(status === 'Pending' ? '‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                document.querySelector('[data-tab="my-activities"]').click();
            } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message); }
            showLoading(false);
        }

        async function loadMyActivities() {
            const c = document.getElementById('my-activities-list');
            if (!currentOrganizer) return;
            try {
                const q = await db.collection('organizerActivities').where('organizerEmail', '==', currentOrganizer.email).orderBy('updatedAt', 'desc').get();
                if (q.empty) { c.innerHTML = '<div class="empty-state"><span class="icon">üì≠</span><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p></div>'; return; }
                c.innerHTML = q.docs.map(doc => {
                    const d = doc.data(), sc = getStatusClass(d.status), st = getStatusText(d.status);
                    return `<div class="activity-card status-${sc}">
                        <div class="activity-header"><h3>${d.activityName}</h3><span class="status-badge ${sc}">${st}</span></div>
                        <div class="activity-meta"><span>üìÖ ${d.startDate} - ${d.endDate}</span><span>‚è±Ô∏è ${d.duration} ${d.durationUnit}</span><span>üìä Level ${d.activityLevel}</span><span>üë• ${d.studentCount||0} ‡∏Ñ‡∏ô</span></div>
                        <div class="activity-skills">${(d.skills||[]).map(s=>`<span class="skill-mini">${s.code} Lv.${s.level}</span>`).join('')}</div>
                        <div class="activity-actions">
                            ${d.status==='Draft'?`<button onclick="editActivity('${doc.id}')" class="btn-small btn-edit">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button onclick="submitForApproval('${doc.id}')" class="btn-small btn-submit-approval">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>`:''}
                            ${['Approved','Draft','Pending'].includes(d.status)?`<button onclick="openStudentsModal('${doc.id}')" class="btn-small btn-students">üë• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>`:''}
                            ${d.status==='Rejected'?`<button onclick="editActivity('${doc.id}')" class="btn-small btn-edit">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà</button><div class="reject-reason">‚ùå ${d.rejectReason||'-'}</div>`:''}
                        </div></div>`;
                }).join('');
            } catch (e) { console.error(e); }
        }

        async function editActivity(id) {
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            try {
                const doc = await db.collection('organizerActivities').doc(id).get();
                if (!doc.exists) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'); showLoading(false); return; }
                const d = doc.data();
                document.getElementById('edit-activity-id').value = id;
                document.getElementById('organizer-name').value = d.organizerName||'';
                document.getElementById('department').value = d.department||'';
                document.getElementById('activity-name').value = d.activityName||'';
                document.getElementById('start-date').value = d.startDate||'';
                document.getElementById('end-date').value = d.endDate||'';
                document.getElementById('duration').value = d.duration||'';
                document.getElementById('duration-unit').value = d.durationUnit||'‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á';
                document.querySelector(`input[name="activity-level"][value="${d.activityLevel}"]`).checked = true;
                document.getElementById('description').value = d.description||'';
                document.getElementById('learning-outcomes').value = d.learningOutcomes||'';
                document.getElementById('promotional-link').value = d.promotionalLink||'';
                selectedSkills = d.skills||[]; renderSelectedSkills();
                document.querySelector('[data-tab="new-activity"]').click();
            } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); }
            showLoading(false);
        }

        async function submitForApproval(id) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?')) return;
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            try {
                await db.collection('organizerActivities').doc(id).update({ status: 'Pending', submittedAt: firebase.firestore.FieldValue.serverTimestamp() });
                alert('‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                await loadMyActivities();
            } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); }
            showLoading(false);
        }

        function openStudentsModal(id) { currentActivityId = id; document.getElementById('student-ids-input').value = ''; document.getElementById('students-modal').classList.add('show'); }
        function closeStudentsModal() { document.getElementById('students-modal').classList.remove('show'); currentActivityId = null; }

        async function addStudentsToActivity() {
            if (!currentActivityId) return;
            const ids = document.getElementById('student-ids-input').value.split(/[\n,]/).map(x=>x.trim()).filter(x=>x);
            if (!ids.length) { alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤'); return; }
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤...');
            try {
                const doc = await db.collection('organizerActivities').doc(currentActivityId).get(), d = doc.data();
                const all = [...new Set([...(d.studentIds||[]), ...ids])];
                await db.collection('organizerActivities').doc(currentActivityId).update({ studentIds: all, studentCount: all.length, updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
                if (d.status === 'Approved') {
                    for (const sid of ids) {
                        const ex = await db.collection('participation').where('studentId','==',sid).where('activityName','==',d.activityName).get();
                        if (ex.empty) await db.collection('participation').add({ studentId: sid, activityName: d.activityName, status: 'Approved', date: d.startDate, addedBy: 'organizer', addedAt: firebase.firestore.FieldValue.serverTimestamp() });
                    }
                }
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${ids.length} ‡∏Ñ‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                closeStudentsModal(); await loadMyActivities();
            } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message); }
            showLoading(false);
        }

        function getStatusClass(s) { if (!s) return 'draft'; s=s.toLowerCase(); if (s==='approved') return 'approved'; if (s==='rejected') return 'rejected'; if (s==='pending') return 'pending'; return 'draft'; }
        function getStatusText(s) { if (!s) return 'üìù ‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á'; s=s.toLowerCase(); if (s==='approved') return '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß'; if (s==='rejected') return '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'; if (s==='pending') return '‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'; return 'üìù ‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á'; }
        function showLoading(show, text='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') { const o = document.getElementById('loading-overlay'); document.getElementById('loading-text').textContent = text; show ? o.classList.add('show') : o.classList.remove('show'); }

        document.getElementById('organizer-email').addEventListener('keypress', e => { if (e.key === 'Enter') document.getElementById('organizer-password').focus(); });
        document.getElementById('organizer-password').addEventListener('keypress', e => { if (e.key === 'Enter') loginOrganizer(); });
    </script>
</body>
</html>
