<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Portal - Student Talent Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1e5631 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border-left: 5px solid #27ae60;
        }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 50px; width: auto; }
        .logo h1 { color: #1a472a; font-size: 1.5em; }
        .logo p { color: #666; font-size: 0.9em; }
        .badge-organizer {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .home-link {
            color: #1a472a;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s;
            background: #e8f5e9;
        }
        .home-link:hover {
            background: #c8e6c9;
        }
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 550px;
            width: 100%;
            border-top: 5px solid #27ae60;
        }
        .login-card h2 { color: #1a472a; margin-bottom: 10px; font-size: 1.6em; }
        .login-card > p { color: #666; margin-bottom: 25px; }
        .login-form { display: flex; flex-direction: column; gap: 15px; }
        .login-form input {
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }
        .login-form input:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .login-form input[type="password"] { letter-spacing: 3px; }
        .login-form button {
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }
        .error-message { color: #e74c3c; font-size: 0.9em; min-height: 20px; margin-top: 10px; }
        
        /* First Login Info Box */
        .first-login-info {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #27ae60;
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            text-align: left;
        }
        .first-login-info h4 {
            color: #1a472a;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .first-login-info h4 .icon { font-size: 1.5em; }
        .info-step {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        .step-number {
            background: #27ae60;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
            flex-shrink: 0;
        }
        .step-text {
            color: #333;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .step-text strong { color: #1a472a; }
        .contact-box {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #e67e22;
        }
        .contact-box p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .contact-box a {
            color: #e67e22;
            font-weight: 600;
            text-decoration: none;
        }
        .contact-box a:hover { text-decoration: underline; }
        
        .organizer-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #27ae60;
        }
        .organizer-info { display: flex; align-items: center; gap: 15px; }
        .avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: 700;
        }
        .organizer-info strong { display: block; color: #1a472a; }
        .organizer-info span { color: #666; font-size: 0.9em; }
        .btn-logout {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-logout:hover { background: #e9ecef; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .tab:hover:not(.active) { background: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .form-card, .activities-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .form-card h2, .activities-panel h2 {
            color: #1a472a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }
        .section-title {
            color: #27ae60;
            font-weight: 600;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .required { color: #e74c3c; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #27ae60;
            outline: none;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        
        /* Role Selection */
        .role-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .role-card {
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .role-card:hover {
            border-color: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .role-card.selected {
            border-color: #27ae60;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
        }
        .role-card.selected::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #27ae60;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .role-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .role-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #1a472a;
            margin-bottom: 5px;
        }
        .role-subtitle {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .role-level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .role-card.organizer .role-level { background: #fff3e0; color: #e65100; }
        .role-card.staff .role-level { background: #e3f2fd; color: #1565c0; }
        .role-card.participant .role-level { background: #f3e5f5; color: #7b1fa2; }
        .role-skills {
            font-size: 0.85em;
            color: #555;
            line-height: 1.6;
        }
        .role-skills li {
            margin-bottom: 3px;
        }
        
        /* Role Info Box */
        .role-info-box {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        .role-info-box h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        .role-info-box p {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .role-info-box .example {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .role-info-box .example h5 {
            color: #333;
            margin-bottom: 10px;
        }
        .role-info-box .example ul {
            margin-left: 20px;
            color: #555;
        }
        .role-info-box .example li {
            margin-bottom: 5px;
        }
        
        .skills-selector { background: #f0fff4; border-radius: 12px; padding: 20px; }
        .selected-skills { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .no-skills { color: #999; font-style: italic; }
        .skill-tag {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .skill-level-badge {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
        }
        .remove-skill {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0 5px;
            font-size: 1.1em;
        }
        .btn-add-skill {
            background: white;
            border: 2px dashed #27ae60;
            color: #27ae60;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-add-skill:hover { background: #e8f5e9; }
        
        /* AI Analysis Section */
        .ai-analyze-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .btn-ai-analyze {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-ai-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-ai-analyze:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .ai-hint {
            color: #666;
            font-size: 0.9em;
        }
        .ai-analysis-result {
            background: linear-gradient(135deg, #f3e7ff 0%, #e8f4fd 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .ai-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-weight: 600;
            color: #5a4fcf;
        }
        .btn-clear-ai {
            background: #ffebee;
            border: none;
            color: #c62828;
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
        }
        .btn-clear-ai:hover { background: #ffcdd2; }
        .ai-suggested-skills {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .ai-skill-item {
            background: white;
            border-radius: 10px;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .ai-skill-info {
            flex: 1;
        }
        .ai-skill-code {
            font-weight: 700;
            color: #667eea;
        }
        .ai-skill-name {
            color: #666;
            font-size: 0.9em;
        }
        .ai-skill-reason {
            font-size: 0.85em;
            color: #888;
            margin-top: 4px;
            font-style: italic;
        }
        .ai-skill-level {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 600;
        }
        .ai-note {
            margin-top: 12px;
            font-size: 0.9em;
            color: #5a4fcf;
            text-align: center;
        }
        .ai-loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        .ai-loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #e0e0e0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .student-ids-input {
            font-family: monospace;
            min-height: 120px;
            resize: vertical;
        }
        .btn-submit-group { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .btn-save, .btn-submit {
            flex: 1;
            min-width: 200px;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-save { background: #f8f9fa; border: 2px solid #27ae60; color: #27ae60; }
        .btn-save:hover { background: #e8f5e9; }
        .btn-submit { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4); }
        
        .btn-another-role {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }
        .btn-another-role:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.4);
        }
        
        .activity-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #27ae60;
        }
        .activity-item.pending { border-left-color: #f39c12; }
        .activity-item.approved { border-left-color: #27ae60; }
        .activity-item.rejected { border-left-color: #e74c3c; }
        .activity-item.draft { border-left-color: #95a5a6; }
        .activity-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        .activity-title { font-weight: 600; color: #1a472a; font-size: 1.1em; }
        .activity-status { padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .activity-status.draft { background: #ecf0f1; color: #7f8c8d; }
        .activity-status.pending { background: #fff3e0; color: #e67e22; }
        .activity-status.approved { background: #e8f5e9; color: #27ae60; }
        .activity-status.rejected { background: #ffebee; color: #e74c3c; }
        .activity-role {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        .activity-role.organizer { background: #fff3e0; color: #e65100; }
        .activity-role.staff { background: #e3f2fd; color: #1565c0; }
        .activity-role.participant { background: #f3e5f5; color: #7b1fa2; }
        .activity-meta { color: #666; font-size: 0.9em; margin-bottom: 10px; }
        .activity-skills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .skill-mini { background: #e3f2fd; color: #1976d2; padding: 3px 10px; border-radius: 15px; font-size: 0.8em; }
        .activity-actions { display: flex; gap: 10px; }
        .btn-action { padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 0.9em; transition: all 0.2s; }
        .btn-edit { background: #e3f2fd; color: #1976d2; }
        .btn-delete { background: #ffebee; color: #e74c3c; }
        .btn-action:hover { transform: translateY(-1px); }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state .icon { font-size: 4em; margin-bottom: 15px; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 20px; max-width: 800px; width: 100%; max-height: 85vh; overflow-y: auto; }
        .modal-header { padding: 25px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { color: #1a472a; }
        .modal-close { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #999; }
        .modal-body { padding: 25px; }
        .skill-domain { margin-bottom: 20px; }
        .skill-domain h4 { color: #27ae60; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e8f5e9; }
        .skill-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
        .skill-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; transition: all 0.2s; }
        .skill-item:hover { background: #e8f5e9; }
        .skill-item.selected { background: #e8f5e9; border: 2px solid #27ae60; }
        .skill-info { flex: 1; display: flex; align-items: center; gap: 8px; }
        .skill-info label { cursor: pointer; font-size: 0.9em; }
        .skill-level { padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-modal { padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-cancel { background: #f8f9fa; border: 1px solid #ddd; }
        .btn-confirm { background: #27ae60; color: white; border: none; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; gap: 20px; }
        .loading-overlay.show { display: flex; }
        .spinner { width: 50px; height: 50px; border: 4px solid #e0e0e0; border-top-color: #27ae60; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Preset Skills Display */
        .preset-skills-info {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .preset-skills-info h5 {
            color: #27ae60;
            margin-bottom: 10px;
        }
        .preset-skill-tag {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            margin: 3px;
        }
        
        @media (max-width: 600px) {
            .login-card { padding: 30px 20px; }
            .header { flex-direction: column; text-align: center; }
            .btn-submit-group { flex-direction: column; }
            .organizer-bar { flex-direction: column; gap: 15px; text-align: center; }
            .first-login-info { padding: 20px 15px; }
            .role-selector { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <img src="images/MainLogo.png" alt="Logo" class="logo-img">
                <div>
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Registration</h1>
                    <p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | For Activity Organizers</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <a href="index.html" class="home-link">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <span class="badge-organizer">üë®‚Äçüíº ORGANIZER PORTAL</span>
            </div>
        </header>

        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Portal</h2>
                <p>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°<br>Register activities and add participating students</p>
                
                <div class="login-form">
                    <input type="email" id="organizer-email" placeholder="Email (your-email@cmu.ac.th)">
                    <input type="password" id="organizer-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô | Password (min 4 chars)" minlength="4">
                    <button onclick="loginOrganizer()">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö | Login</button>
                </div>
                <p id="login-error" class="error-message"></p>
                
                <!-- First Login Info Box -->
                <div class="first-login-info">
                    <h4><span class="icon">‚ú®</span> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | How to Use</h4>
                    
                    <div class="info-step">
                        <span class="step-number">1</span>
                        <div class="step-text">
                            <strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (First Login):</strong><br>
                            ‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞ <strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</strong><br>
                            Enter Email and <strong>create your password</strong>
                        </div>
                    </div>
                    
                    <div class="info-step">
                        <span class="step-number">2</span>
                        <div class="step-text">
                            <strong>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ:</strong> ‡πÉ‡∏ä‡πâ Email ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°<br>
                            <strong>Next time:</strong> Use same credentials
                        </div>
                    </div>
                    
                    <div class="contact-box">
                        <p>üîê <strong>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô? | Forgot Password?</strong></p>
                        <a href="mailto:talentdev@eng.cmu.ac.th">üìß talentdev@eng.cmu.ac.th</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="main-section" class="main-section" style="display: none;">
            <div class="organizer-bar">
                <div class="organizer-info">
                    <span class="avatar" id="organizer-avatar">O</span>
                    <div>
                        <strong id="display-name">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer</strong>
                        <span id="display-email">organizer@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutOrganizer()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö | Logout</button>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="new-activity">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà | New Activity</button>
                <button class="tab" data-tab="my-activities">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Activities</button>
            </div>

            <div id="tab-new-activity" class="tab-content active">
                <div class="form-card">
                    <h2>üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Register Activity</h2>
                    
                    <!-- Role Info Box -->
                    <div class="role-info-box">
                        <h4>üí° ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó | Role-Based Registration</h4>
                        <p>
                            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô<br>
                            Same activity, different roles receive different skills
                        </p>
                        <div class="example">
                            <h5>üìå ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á | Example: "Workshop Generative AI"</h5>
                            <ul>
                                <li><strong>‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î:</strong> ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥, ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Lv.3-4)</li>
                                <li><strong>Staff:</strong> ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô (Lv.2)</li>
                                <li><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°:</strong> ‡πÑ‡∏î‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å workshop (Lv.1-2)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <form id="activity-form" onsubmit="saveActivity(event)">
                        <input type="hidden" id="edit-activity-id">
                        
                        <!-- Step 1: Select Role -->
                        <div class="section-title">üë§ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° | Step 1: Select Role <span class="required">*</span></div>
                        
                        <div class="role-selector">
                            <div class="role-card organizer" data-role="organizer" onclick="selectRole('organizer')">
                                <div class="role-icon">üëë</div>
                                <div class="role-title">‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                                <div class="role-subtitle">Organizer Team</div>
                                <div class="role-level">Level 3-4 ‡∏ú‡∏π‡πâ‡∏ô‡∏≥/‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</div>
                                <ul class="role-skills">
                                    <li>‚úì ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</li>
                                    <li>‚úì ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£/‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠</li>
                                    <li>‚úì ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏°</li>
                                </ul>
                            </div>
                            
                            <div class="role-card staff" data-role="staff" onclick="selectRole('staff')">
                                <div class="role-icon">ü§ù</div>
                                <div class="role-title">Staff ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</div>
                                <div class="role-subtitle">Event Staff</div>
                                <div class="role-level">Level 2 ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</div>
                                <ul class="role-skills">
                                    <li>‚úì ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</li>
                                    <li>‚úì ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</li>
                                    <li>‚úì ‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</li>
                                </ul>
                            </div>
                            
                            <div class="role-card participant" data-role="participant" onclick="selectRole('participant')">
                                <div class="role-icon">üë•</div>
                                <div class="role-title">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                                <div class="role-subtitle">Participant</div>
                                <div class="role-level">Level 1-2 ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</div>
                                <ul class="role-skills">
                                    <li>‚úì ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</li>
                                    <li>‚úì ‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÉ‡∏ô workshop</li>
                                    <li>‚úì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</li>
                                </ul>
                            </div>
                        </div>
                        
                        <input type="hidden" id="selected-role" value="">
                        
                        <!-- Step 2: Activity Info -->
                        <div class="section-title">üìù ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Step 2: Activity Info</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô | Organizer Name <span class="required">*</span></label>
                                <input type="text" id="organizer-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏°‡∏£‡∏° AI | e.g. AI Club">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î | Department <span class="required">*</span></label>
                                <input type="text" id="department" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Name <span class="required">*</span></label>
                            <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop Generative AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                            <small style="color: #666;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ | Role will be appended automatically</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Date <span class="required">*</span></label>
                                <input type="date" id="activity-date" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ | Duration</label>
                                <input type="text" id="duration" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | e.g. 3 hours">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Description</label>
                            <textarea id="description" rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠..."></textarea>
                        </div>

                        <!-- Step 3: Skills -->
                        <div class="section-title">üéØ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 3: ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö | Step 3: Skills <span class="required">*</span></div>
                        
                        <div class="ai-analyze-section">
                            <button type="button" class="btn-ai-analyze" onclick="analyzeSkillsWithAI()">
                                ü§ñ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI | AI Analyze
                            </button>
                            <span class="ai-hint">‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</span>
                        </div>
                        
                        <div id="ai-analysis-result" class="ai-analysis-result" style="display: none;">
                            <div class="ai-result-header">
                                <span>ü§ñ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å AI</span>
                                <button type="button" class="btn-clear-ai" onclick="clearAIAnalysis()">‚úï ‡∏•‡πâ‡∏≤‡∏á</button>
                            </div>
                            <div id="ai-suggested-skills" class="ai-suggested-skills"></div>
                            <p class="ai-note">üí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                        </div>
                        
                        <div id="preset-skills-display" class="preset-skills-info" style="display: none;">
                            <h5>‚ö° ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó | Recommended Skills for Role</h5>
                            <div id="preset-skills-list"></div>
                            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á | You can modify skills below
                            </p>
                        </div>
                        
                        <div class="skills-selector">
                            <div id="selected-skills" class="selected-skills">
                                <p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | No skills selected</p>
                            </div>
                            <button type="button" class="btn-add-skill" onclick="openSkillModal()">
                                ‚ûï ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Select/Edit Skills
                            </button>
                        </div>

                        <!-- Step 4: Students -->
                        <div class="section-title">üë• ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 4: ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Step 4: Student List <span class="required">*</span></div>
                        <div class="form-group">
                            <label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student IDs (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | one per line)</label>
                            <textarea id="student-ids" class="student-ids-input" rows="6" 
                                placeholder="640610001
640610002
640610003"></textarea>
                            <small id="student-count" style="color: #27ae60; font-weight: 600;">0 ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ | 0 students</small>
                        </div>

                        <div class="btn-submit-group">
                            <button type="submit" class="btn-save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á | Save Draft</button>
                            <button type="button" class="btn-submit" onclick="saveAndSubmit()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | Submit</button>
                            <button type="button" class="btn-another-role" onclick="saveAndCreateAnotherRole()">
                                üîÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏™‡∏£‡πâ‡∏≤‡∏á Role ‡πÉ‡∏´‡∏°‡πà | Save & New Role
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-my-activities" class="tab-content">
                <div class="activities-panel">
                    <h2>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Activities</h2>
                    <div id="activities-list">
                        <div class="loading-inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skill Selection Modal -->
        <div id="skill-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö | Select Skills & Levels</h3>
                    <button class="modal-close" onclick="closeSkillModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="skill-categories"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn-modal btn-cancel" onclick="closeSkillModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å | Cancel</button>
                    <button class="btn-modal btn-confirm" onclick="confirmSkills()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô | Confirm</button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
            <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", nameEn: "Analytical Reasoning", domain: "Critical Thinking" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Problem Solving", domain: "Critical Thinking" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systems Thinking", domain: "Critical Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", nameEn: "Presentation", domain: "Communication" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", nameEn: "Listening", domain: "Communication" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", nameEn: "English", domain: "Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", nameEn: "Role Understanding", domain: "Teamwork" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", nameEn: "Task Management", domain: "Teamwork" },
            { code: "3.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", nameEn: "Collaboration", domain: "Teamwork" },
            { code: "4.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", nameEn: "Learning Agility", domain: "Digital & Learning" },
            { code: "4.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", nameEn: "Digital Literacy", domain: "Digital & Learning" },
            { code: "4.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", nameEn: "Tool Proficiency", domain: "Digital & Learning" },
            { code: "5.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", nameEn: "Human-Centered Design", domain: "Innovation" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", nameEn: "Project Management", domain: "Innovation" },
            { code: "5.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", nameEn: "Business Awareness", domain: "Innovation" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", nameEn: "Personal Growth", domain: "Self Development" },
            { code: "6.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", nameEn: "Resilience", domain: "Self Development" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", nameEn: "Empathy", domain: "Self Development" }
        ];
        const DOMAINS = ["Critical Thinking", "Communication", "Teamwork", "Digital & Learning", "Innovation", "Self Development"];
        
        // Role presets (max 3 skills each)
        const ROLE_PRESETS = {
            organizer: {
                name: "‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î | Organizer",
                suffix: "(‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î)",
                suffixEn: "(Organizer)",
                defaultLevel: 4,
                skills: [
                    { code: "3.2", level: 4 }, // Task Management
                    { code: "5.2", level: 4 }, // Project Management
                    { code: "2.1", level: 4 }  // Presentation
                ]
            },
            staff: {
                name: "Staff | Staff",
                suffix: "(Staff)",
                suffixEn: "(Staff)",
                defaultLevel: 2,
                skills: [
                    { code: "3.1", level: 2 }, // Role Understanding
                    { code: "3.3", level: 2 }, // Collaboration
                    { code: "6.2", level: 2 }  // Resilience
                ]
            },
            participant: {
                name: "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° | Participant",
                suffix: "(‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)",
                suffixEn: "(Participant)",
                defaultLevel: 2,
                skills: [
                    { code: "4.1", level: 2 }, // Learning Agility
                    { code: "4.2", level: 2 }  // Digital Literacy
                ]
            }
        };
        
        let currentOrganizer = null;
        let selectedSkills = [];
        let currentRole = null;
        let savedActivityBase = null; // Store base activity info for creating multiple roles
        const MAX_SKILLS = 3; // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞

        // Student count update
        document.getElementById('student-ids').addEventListener('input', function() {
            const ids = this.value.trim().split('\n').filter(id => id.trim().length > 0);
            document.getElementById('student-count').textContent = `${ids.length} ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ | ${ids.length} students`;
        });

        // Role Selection
        function selectRole(role) {
            currentRole = role;
            document.getElementById('selected-role').value = role;
            
            // Update UI
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.role-card[data-role="${role}"]`).classList.add('selected');
            
            // Don't auto-apply skills - let user click AI Analyze button
            // Just show a hint that they can use AI analysis
            const presetDisplay = document.getElementById('preset-skills-display');
            presetDisplay.style.display = 'none';
            
            // Clear any previous AI analysis result
            document.getElementById('ai-analysis-result').style.display = 'none';
        }

        // LOGIN - Anyone can register
        async function loginOrganizer() {
            const email = document.getElementById('organizer-email').value.trim().toLowerCase();
            const password = document.getElementById('organizer-password').value.trim();
            const errorEl = document.getElementById('login-error');
            errorEl.textContent = '';
            
            if (!email || !email.includes('@')) { 
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á | Please enter valid Email'; 
                return; 
            }
            if (!password || password.length < 4) { 
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)'; 
                return; 
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö... | Logging in...');
            
            try {
                const q = await db.collection('organizers').where('email', '==', email).limit(1).get();
                
                if (q.empty) {
                    // First time - create new organizer
                    const newOrganizer = {
                        email: email,
                        name: email.split('@')[0],
                        password: password,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    const docRef = await db.collection('organizers').add(newOrganizer);
                    currentOrganizer = { id: docRef.id, ...newOrganizer };
                } else {
                    const doc = q.docs[0];
                    const data = doc.data();
                    
                    if (!data.password) {
                        await db.collection('organizers').doc(doc.id).update({ password });
                        data.password = password;
                    } else if (password !== data.password) {
                        errorEl.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á | Incorrect password';
                        showLoading(false);
                        return;
                    }
                    
                    currentOrganizer = { id: doc.id, email, name: data.name || email.split('@')[0], ...data };
                }
                
                document.getElementById('organizer-avatar').textContent = currentOrganizer.name.charAt(0).toUpperCase();
                document.getElementById('display-name').textContent = currentOrganizer.name;
                document.getElementById('display-email').textContent = email;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-section').style.display = 'block';
                
                await loadMyActivities();
                initSkillModal();
                
            } catch (e) { 
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message; 
            }
            showLoading(false);
        }

        function logoutOrganizer() {
            currentOrganizer = null; 
            selectedSkills = [];
            currentRole = null;
            savedActivityBase = null;
            document.getElementById('activity-form').reset();
            document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('preset-skills-display').style.display = 'none';
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('organizer-email').value = '';
            document.getElementById('organizer-password').value = '';
        }

        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                if (tab.dataset.tab === 'my-activities') loadMyActivities();
            });
        });

        // Skill modal
        function initSkillModal() {
            const container = document.getElementById('skill-categories');
            container.innerHTML = DOMAINS.map(domain => {
                const skills = CRITERIA_LIST.filter(c => c.domain === domain);
                return `<div class="skill-domain"><h4>${domain}</h4><div class="skill-items">${skills.map(s => `
                    <div class="skill-item" data-code="${s.code}">
                        <div class="skill-info">
                            <input type="checkbox" id="skill-${s.code}">
                            <label for="skill-${s.code}"><strong>${s.code}</strong> ${s.nameTh}</label>
                        </div>
                        <select class="skill-level" disabled>
                            <option value="1">Lv.1</option>
                            <option value="2">Lv.2</option>
                            <option value="3">Lv.3</option>
                            <option value="4">Lv.4</option>
                        </select>
                    </div>`).join('')}</div></div>`;
            }).join('');
            
            container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', e => {
                    const item = e.target.closest('.skill-item');
                    const sel = item.querySelector('.skill-level');
                    
                    // Count currently checked items
                    const checkedCount = container.querySelectorAll('input[type="checkbox"]:checked').length;
                    
                    if (e.target.checked && checkedCount > MAX_SKILLS) {
                        e.target.checked = false;
                        alert(`‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${MAX_SKILLS} ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Maximum ${MAX_SKILLS} skills allowed`);
                        return;
                    }
                    
                    sel.disabled = !e.target.checked;
                    item.classList.toggle('selected', e.target.checked);
                    
                    // Update counter display
                    updateSkillCounter(container.querySelectorAll('input[type="checkbox"]:checked').length);
                });
            });
        }
        
        function updateSkillCounter(count) {
            let counter = document.getElementById('skill-counter');
            if (!counter) {
                const modalHeader = document.querySelector('#skill-modal .modal h3');
                if (modalHeader) {
                    counter = document.createElement('span');
                    counter.id = 'skill-counter';
                    counter.style.cssText = 'background:#27ae60;color:white;padding:4px 12px;border-radius:20px;font-size:0.7em;margin-left:10px;';
                    modalHeader.appendChild(counter);
                }
            }
            if (counter) {
                counter.textContent = `${count}/${MAX_SKILLS}`;
                counter.style.background = count >= MAX_SKILLS ? '#f39c12' : '#27ae60';
            }
        }

        // ============================================
        // AI SKILL ANALYSIS (Google Gemini API)
        // ============================================
        const GEMINI_API_KEY = 'AIzaSyCkImt0c2mVpDs0IYCwedICILocuOjORTw';
        
        async function analyzeSkillsWithAI() {
            const activityName = document.getElementById('activity-name').value.trim();
            const description = document.getElementById('description').value.trim();
            
            if (!activityName) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡πà‡∏≠‡∏ô | Please enter activity name first');
                return;
            }
            
            if (!currentRole) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô | Please select participant role first');
                return;
            }
            
            // Get role name from ROLE_PRESETS
            const roleName = ROLE_PRESETS[currentRole]?.name || currentRole;
            
            const btn = document.querySelector('.btn-ai-analyze');
            const resultDiv = document.getElementById('ai-analysis-result');
            const suggestedDiv = document.getElementById('ai-suggested-skills');
            
            // Show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...';
            resultDiv.style.display = 'block';
            suggestedDiv.innerHTML = `
                <div class="ai-loading">
                    <span class="spinner"></span>
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢ AI...
                </div>
            `;
            
            try {
                const prompt = buildGeminiPrompt(activityName, description, roleName);
                const response = await callGeminiAPI(prompt);
                const skills = parseGeminiResponse(response);
                
                if (skills.length === 0) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ');
                }
                
                displayAISuggestions(skills);
                
                // Auto-apply to selected skills
                selectedSkills = skills.map(s => ({
                    code: s.code,
                    level: s.level,
                    nameTh: CRITERIA_LIST.find(c => c.code === s.code)?.nameTh || '',
                    nameEn: CRITERIA_LIST.find(c => c.code === s.code)?.nameEn || ''
                }));
                renderSelectedSkills();
                
            } catch (error) {
                console.error('AI Analysis error:', error);
                suggestedDiv.innerHTML = `
                    <div style="color: #c62828; text-align: center; padding: 20px;">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}<br>
                        <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</small>
                    </div>
                `;
            }
            
            btn.disabled = false;
            btn.innerHTML = 'ü§ñ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI | AI Analyze';
        }
        
        function buildGeminiPrompt(activityName, description, roleName) {
            return `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà

## CMU Engineer Competency Framework (V4)

### 6 Domains ‡πÅ‡∏•‡∏∞ 18 Sub-criteria:

**Domain 1: ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Critical Thinking & Problem Solving)**
- 1.1 ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Analytical Reasoning)
- 1.2 ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Systematic Problem Solving)
- 1.3 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏° (Systems Thinking & Societal Context)

**Domain 2: ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ (Communication)**
- 2.1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ (Presentation Skills)
- 2.2 ‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à (Listening and Comprehension)
- 2.3 ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (English Communication)

**Domain 3: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠ (Teamwork & Collaboration)**
- 3.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô (Role Understanding and Execution)
- 3.2 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (Task Management)
- 3.3 ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô (Collaborative Work)

**Domain 4: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß (Professional Growth & Adaptability)**
- 4.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Learning Agility)
- 4.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (Digital Literacy)
- 4.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Tool Proficiency)

**Domain 5: ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (Innovation & Business Acumen)**
- 5.1 ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á (Human-Centered Design)
- 5.2 ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Project Management)
- 5.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏π‡πâ‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ (Business & Entrepreneurial Awareness)

**Domain 6: ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (Self-Development & Resilience)**
- 6.1 ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏π‡πâ‡πÉ‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á (Personal Growth & Self-Awareness)
- 6.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß (Resilience & Adaptability)
- 6.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Empathy & Interpersonal Understanding)

### ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö (Level):
- **Level 1 (‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å)**: ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á, ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
- **Level 2 (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à)**: Workshop, Lab, ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
- **Level 3 (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô)**: ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏≥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£, ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
- **Level 4 (‡∏ú‡∏π‡πâ‡∏ô‡∏≥)**: ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô, ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ, ‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô

---

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:

**‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:** ${activityName}
**‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:** ${description || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'}
**‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°:** ${roleName}

---

## ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:
1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° 1-3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞
2. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö (Level 1-4) ‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÇ‡∏î‡∏¢‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
3. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ô‡∏±‡πâ‡∏ô

## ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô):
\`\`\`json
[
  {"code": "X.X", "level": N, "reason": "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"}
]
\`\`\`

‡∏ï‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`;
        }
        
        async function callGeminiAPI(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        temperature: 0.3,
                        maxOutputTokens: 1024
                    }
                })
            });
            
            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || 'Gemini API Error');
            }
            
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || '';
        }
        
        function parseGeminiResponse(responseText) {
            // Extract JSON from response
            const jsonMatch = responseText.match(/\[[\s\S]*?\]/);
            if (!jsonMatch) {
                console.error('No JSON found in response:', responseText);
                throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö');
            }
            
            const skills = JSON.parse(jsonMatch[0]);
            
            // Validate and filter valid skills
            return skills.filter(s => {
                const valid = CRITERIA_LIST.find(c => c.code === s.code);
                return valid && s.level >= 1 && s.level <= 4;
            }).slice(0, 3); // Max 3 skills
        }
        
        // Fallback rule-based analysis (if API fails)
        function analyzeWithRules(activityName, description, role, roleName) {
            const text = (activityName + ' ' + description).toLowerCase();
            const rolePreset = ROLE_PRESETS[role];
            const baseLevel = rolePreset?.defaultLevel || 2;
            
            // Keywords mapping to skills with weights
            const keywordMap = {
                '1.1': { keywords: ['‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'analysis', '‡∏Ñ‡∏¥‡∏î', 'think', '‡∏ß‡∏¥‡∏à‡∏±‡∏¢', 'research', 'problem', '‡∏õ‡∏±‡∏ç‡∏´‡∏≤', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'solve'], weight: 1 },
                '1.2': { keywords: ['‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'synthesis', '‡∏™‡∏£‡∏∏‡∏õ', 'conclude', '‡∏£‡∏ß‡∏°', 'integrate', '‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•'], weight: 1 },
                '1.3': { keywords: ['‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå', 'critique', '‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', 'evaluate', '‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô', 'judge', 'review'], weight: 1 },
                '2.1': { keywords: ['‡∏ü‡∏±‡∏á', 'listen', '‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', 'communicate', '‡∏û‡∏π‡∏î', 'speak', 'present', '‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠', '‡∏≠‡∏†‡∏¥‡∏õ‡∏£‡∏≤‡∏¢'], weight: 1 },
                '2.2': { keywords: ['‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', 'write', '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'report', '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', 'document', '‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°', 'article'], weight: 1 },
                '2.3': { keywords: ['‡∏†‡∏≤‡∏©‡∏≤', 'language', 'english', '‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', 'international', 'global', 'foreign'], weight: 1 },
                '3.1': { keywords: ['‡∏ó‡∏µ‡∏°', 'team', '‡∏Å‡∏•‡∏∏‡πà‡∏°', 'group', '‡∏£‡πà‡∏ß‡∏°', 'collaborate', 'cooperation', '‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠'], weight: 1 },
                '3.2': { keywords: ['‡∏ú‡∏π‡πâ‡∏ô‡∏≥', 'leader', 'lead', '‡∏ô‡∏≥', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'manage', '‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô', '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤', 'captain'], weight: 1 },
                '3.3': { keywords: ['‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢', 'network', '‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå', 'relation', 'social', 'connect', '‡∏û‡∏±‡∏ô‡∏ò‡∏°‡∏¥‡∏ï‡∏£'], weight: 1 },
                '4.1': { keywords: ['‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•', 'digital', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', 'technology', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', 'computer', 'ai', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'coding', 'software', 'app'], weight: 1 },
                '4.2': { keywords: ['‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', 'learn', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'develop', 'skill', '‡∏ó‡∏±‡∏Å‡∏©‡∏∞', 'training', '‡∏≠‡∏ö‡∏£‡∏°', 'workshop'], weight: 1 },
                '4.3': { keywords: ['‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'data', '‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®', 'information', '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'database', 'analytics'], weight: 1 },
                '5.1': { keywords: ['‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå', 'creative', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î', 'idea', '‡πÉ‡∏´‡∏°‡πà', 'new', 'innovative', '‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πâ‡∏ô'], weight: 1 },
                '5.2': { keywords: ['‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°', 'innovation', '‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå', 'invent', 'design', '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö', 'startup', 'prototype', 'product'], weight: 1 },
                '5.3': { keywords: ['‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£', 'entrepreneur', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', 'business', 'enterprise', 'marketing', 'pitch'], weight: 1 },
                '6.1': { keywords: ['‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°', 'ethic', '‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°', 'moral', '‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå', 'honest', 'integrity'], weight: 1 },
                '6.2': { keywords: ['‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û', 'profession', '‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', 'standard', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£', 'engineer', 'license', '‡∏Å‡∏ß.'], weight: 1 },
                '6.3': { keywords: ['‡∏™‡∏±‡∏á‡∏Ñ‡∏°', 'social', '‡∏ä‡∏∏‡∏°‡∏ä‡∏ô', 'community', '‡∏≠‡∏≤‡∏™‡∏≤', 'volunteer', 'csr', '‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤', '‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç', '‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞'], weight: 1 }
            };
            
            // Activity type patterns with skill boosts
            const activityPatterns = [
                { pattern: /hackathon|‡πÅ‡∏Æ‡∏Å‡∏Å‡∏≤‡∏ò‡∏≠‡∏ô/i, skills: [{ code: '5.2', boost: 2 }, { code: '3.1', boost: 1 }, { code: '1.1', boost: 1 }] },
                { pattern: /workshop|‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Ñ‡∏ä‡∏≠‡∏õ|‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°/i, skills: [{ code: '4.2', boost: 2 }, { code: '4.1', boost: 1 }] },
                { pattern: /seminar|‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤|‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢/i, skills: [{ code: '2.1', boost: 1 }, { code: '4.2', boost: 1 }] },
                { pattern: /volunteer|‡∏≠‡∏≤‡∏™‡∏≤|‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤|‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç/i, skills: [{ code: '6.3', boost: 3 }, { code: '3.3', boost: 1 }] },
                { pattern: /‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô|competition|contest|‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î/i, skills: [{ code: '1.1', boost: 2 }, { code: '3.1', boost: 1 }] },
                { pattern: /‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠|presentation|pitch/i, skills: [{ code: '2.1', boost: 2 }, { code: '2.2', boost: 1 }] },
                { pattern: /camp|‡∏Ñ‡πà‡∏≤‡∏¢|‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢/i, skills: [{ code: '3.1', boost: 2 }, { code: '3.2', boost: 1 }] },
                { pattern: /startup|‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à|entrepreneur/i, skills: [{ code: '5.3', boost: 2 }, { code: '5.2', boost: 1 }] },
                { pattern: /research|‡∏ß‡∏¥‡∏à‡∏±‡∏¢|‡∏®‡∏∂‡∏Å‡∏©‡∏≤/i, skills: [{ code: '1.1', boost: 2 }, { code: '1.2', boost: 1 }] },
                { pattern: /sport|‡∏Å‡∏µ‡∏¨‡∏≤|marathon|‡∏ß‡∏¥‡πà‡∏á/i, skills: [{ code: '3.1', boost: 1 }, { code: '6.3', boost: 1 }] },
                { pattern: /international|‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®|exchange/i, skills: [{ code: '2.3', boost: 2 }, { code: '3.3', boost: 1 }] },
                { pattern: /coding|programming|‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°|code/i, skills: [{ code: '4.1', boost: 2 }, { code: '1.1', boost: 1 }] },
                { pattern: /ai|machine learning|data science/i, skills: [{ code: '4.1', boost: 2 }, { code: '4.3', boost: 2 }] },
                { pattern: /design|‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö|ux|ui/i, skills: [{ code: '5.1', boost: 2 }, { code: '5.2', boost: 1 }] }
            ];
            
            // Score each skill
            const scores = {};
            
            // Check keywords
            for (const [code, { keywords, weight }] of Object.entries(keywordMap)) {
                for (const kw of keywords) {
                    if (text.includes(kw)) {
                        scores[code] = (scores[code] || 0) + weight;
                    }
                }
            }
            
            // Check activity patterns
            for (const { pattern, skills } of activityPatterns) {
                if (pattern.test(text)) {
                    for (const { code, boost } of skills) {
                        scores[code] = (scores[code] || 0) + boost;
                    }
                }
            }
            
            // Add role preset skills
            if (rolePreset?.skills) {
                for (const skill of rolePreset.skills) {
                    scores[skill.code] = (scores[skill.code] || 0) + 2;
                }
            }
            
            // Sort and pick top 3
            const sortedSkills = Object.entries(scores)
                .filter(([_, score]) => score > 0)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            // If no matches, use role preset
            if (sortedSkills.length === 0 && rolePreset?.skills) {
                return rolePreset.skills.slice(0, 3).map(s => ({
                    code: s.code,
                    level: s.level,
                    reason: '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ' + roleName
                }));
            }
            
            // Reasons for each skill
            const reasons = {
                '1.1': '‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤',
                '1.2': '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ',
                '1.3': '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå',
                '2.1': '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠',
                '2.2': '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
                '2.3': '‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®',
                '3.1': '‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°',
                '3.2': '‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£',
                '3.3': '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢',
                '4.1': '‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ',
                '4.2': '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï',
                '4.3': '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®',
                '5.1': '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå',
                '5.2': '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°',
                '5.3': '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£',
                '6.1': '‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°',
                '6.2': '‡∏à‡∏£‡∏£‡∏¢‡∏≤‡∏ö‡∏£‡∏£‡∏ì‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û',
                '6.3': '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°'
            };
            
            return sortedSkills.map(([code, score]) => {
                // Adjust level based on role
                let level = baseLevel;
                if (role === 'leader' || role === 'organizer' || role === 'presenter') {
                    level = Math.min(level + 1, 4);
                }
                if (role === 'participant' || role === 'audience') {
                    level = Math.max(level - 1, 1);
                }
                
                return {
                    code,
                    level,
                    reason: reasons[code] || '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'
                };
            });
        }
        
        function displayAISuggestions(skills) {
            const container = document.getElementById('ai-suggested-skills');
            
            if (skills.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
                    </div>
                `;
                return;
            }
            
            container.innerHTML = skills.map(s => {
                const criteria = CRITERIA_LIST.find(c => c.code === s.code);
                return `
                    <div class="ai-skill-item">
                        <div class="ai-skill-info">
                            <span class="ai-skill-code">${s.code}</span>
                            <span class="ai-skill-name">${criteria?.nameTh || ''}</span>
                            ${s.reason ? `<div class="ai-skill-reason">üí¨ ${s.reason}</div>` : ''}
                        </div>
                        <span class="ai-skill-level">Lv.${s.level}</span>
                    </div>
                `;
            }).join('');
        }
        
        function clearAIAnalysis() {
            document.getElementById('ai-analysis-result').style.display = 'none';
            document.getElementById('ai-suggested-skills').innerHTML = '';
            selectedSkills = [];
            renderSelectedSkills();
        }

        function openSkillModal() {
            document.querySelectorAll('.skill-item').forEach(item => {
                const code = item.dataset.code;
                const cb = item.querySelector('input[type="checkbox"]');
                const sel = item.querySelector('.skill-level');
                const ex = selectedSkills.find(s => s.code === code);
                if (ex) { 
                    cb.checked = true; 
                    sel.disabled = false; 
                    sel.value = ex.level; 
                    item.classList.add('selected'); 
                } else { 
                    cb.checked = false; 
                    sel.disabled = true; 
                    sel.value = currentRole ? ROLE_PRESETS[currentRole].defaultLevel : 2; 
                    item.classList.remove('selected'); 
                }
            });
            
            // Update counter
            const checkedCount = document.querySelectorAll('.skill-item input[type="checkbox"]:checked').length;
            updateSkillCounter(checkedCount);
            
            document.getElementById('skill-modal').classList.add('show');
        }

        function closeSkillModal() { 
            document.getElementById('skill-modal').classList.remove('show'); 
        }

        function confirmSkills() {
            selectedSkills = [];
            document.querySelectorAll('.skill-item').forEach(item => {
                if (item.querySelector('input[type="checkbox"]').checked) {
                    const code = item.dataset.code;
                    const level = parseInt(item.querySelector('.skill-level').value);
                    const c = CRITERIA_LIST.find(x => x.code === code);
                    selectedSkills.push({ code, level, nameTh: c.nameTh, nameEn: c.nameEn });
                }
            });
            
            // Validate max skills
            if (selectedSkills.length > MAX_SKILLS) {
                alert(`‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${MAX_SKILLS} ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞`);
                selectedSkills = selectedSkills.slice(0, MAX_SKILLS);
            }
            
            renderSelectedSkills(); 
            closeSkillModal();
        }

        function renderSelectedSkills() {
            const c = document.getElementById('selected-skills');
            c.innerHTML = selectedSkills.length === 0 
                ? '<p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | No skills selected</p>' 
                : selectedSkills.map(s => `
                    <div class="skill-tag">
                        <span>${s.code} ${s.nameTh}</span>
                        <span class="skill-level-badge">Lv.${s.level}</span>
                        <button type="button" onclick="removeSkill('${s.code}')" class="remove-skill">‚úï</button>
                    </div>
                `).join('');
        }

        function removeSkill(code) { 
            selectedSkills = selectedSkills.filter(s => s.code !== code); 
            renderSelectedSkills(); 
        }

        // Validation
        function validateForm() {
            if (!currentRole) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° | Please select a role');
                return false;
            }
            if (selectedSkills.length === 0) { 
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Please select at least 1 skill'); 
                return false; 
            }
            if (selectedSkills.length > MAX_SKILLS) { 
                alert(`‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${MAX_SKILLS} ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ | Maximum ${MAX_SKILLS} skills allowed`); 
                return false; 
            }
            const studentIdsRaw = document.getElementById('student-ids').value.trim();
            const studentIds = studentIdsRaw.split('\n').map(id => id.trim()).filter(id => id.length > 0);
            if (studentIds.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô | Please enter at least 1 student ID');
                return false;
            }
            return true;
        }

        // Build activity name with role suffix
        function buildActivityName() {
            const baseName = document.getElementById('activity-name').value.trim();
            const preset = ROLE_PRESETS[currentRole];
            return `${baseName} ${preset.suffix}`;
        }

        // Save activity
        async function saveActivity(e) { 
            e.preventDefault(); 
            await saveActivityData('Draft'); 
        }

        async function saveAndSubmit() { 
            await saveActivityData('Pending'); 
        }
        
        async function saveAndCreateAnotherRole() {
            if (!validateForm()) return;
            
            // Save current activity base info
            savedActivityBase = {
                organizerName: document.getElementById('organizer-name').value.trim(),
                department: document.getElementById('department').value.trim(),
                activityName: document.getElementById('activity-name').value.trim(),
                activityDate: document.getElementById('activity-date').value,
                duration: document.getElementById('duration').value,
                description: document.getElementById('description').value.trim()
            };
            
            // Save current role
            await saveActivityData('Draft');
            
            // Reset for next role
            currentRole = null;
            document.getElementById('selected-role').value = '';
            document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('preset-skills-display').style.display = 'none';
            selectedSkills = [];
            renderSelectedSkills();
            document.getElementById('student-ids').value = '';
            document.getElementById('student-count').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ | 0 students';
            
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô\nSaved! Please select new role for same activity');
        }

        async function saveActivityData(status) {
            if (!currentOrganizer) { 
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô | Please login first'); 
                return; 
            }
            if (!validateForm()) return;
            
            const studentIdsRaw = document.getElementById('student-ids').value.trim();
            const studentIds = studentIdsRaw.split('\n').map(id => id.trim()).filter(id => id.length > 0);
            
            showLoading(true, status === 'Draft' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            
            try {
                const activityData = {
                    organizerEmail: currentOrganizer.email,
                    organizerName: document.getElementById('organizer-name').value.trim(),
                    department: document.getElementById('department').value.trim(),
                    activityNameBase: document.getElementById('activity-name').value.trim(),
                    activityName: buildActivityName(),
                    activityDate: document.getElementById('activity-date').value,
                    duration: document.getElementById('duration').value,
                    description: document.getElementById('description').value.trim(),
                    role: currentRole,
                    roleName: ROLE_PRESETS[currentRole].name,
                    activityLevel: ROLE_PRESETS[currentRole].defaultLevel,
                    skills: selectedSkills,
                    studentIds: studentIds,
                    status: status,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                const editId = document.getElementById('edit-activity-id').value;
                if (editId) {
                    await db.collection('organizerActivities').doc(editId).update(activityData);
                } else {
                    activityData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('organizerActivities').add(activityData);
                }

                const msg = status === 'Draft' 
                    ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! | Draft saved!' 
                    : '‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! | Submitted!';
                alert(msg);
                
                // Reset form if not creating another role
                if (!savedActivityBase) {
                    document.getElementById('activity-form').reset();
                    document.getElementById('edit-activity-id').value = '';
                    currentRole = null;
                    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
                    document.getElementById('preset-skills-display').style.display = 'none';
                    selectedSkills = [];
                    renderSelectedSkills();
                    document.getElementById('student-count').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ | 0 students';
                }
                
            } catch (e) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î | Error: ' + e.message);
            }
            showLoading(false);
        }

        // Load my activities
        async function loadMyActivities() {
            const list = document.getElementById('activities-list');
            list.innerHTML = '<div class="loading-inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... | Loading...</div>';
            
            try {
                // Remove orderBy to avoid needing composite index
                const q = await db.collection('organizerActivities')
                    .where('organizerEmail', '==', currentOrganizer.email)
                    .get();
                
                if (q.empty) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | No activities yet</p>
                        </div>`;
                    return;
                }
                
                // Sort client-side by createdAt (newest first)
                const sortedDocs = q.docs.sort((a, b) => {
                    const aTime = a.data().createdAt?.toMillis?.() || 0;
                    const bTime = b.data().createdAt?.toMillis?.() || 0;
                    return bTime - aTime;
                });
                
                list.innerHTML = sortedDocs.map(doc => {
                    const d = doc.data();
                    const statusClass = (d.status || 'draft').toLowerCase();
                    const statusText = {
                        'draft': 'üìù ‡∏£‡πà‡∏≤‡∏á',
                        'pending': '‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
                        'approved': '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                        'rejected': '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'
                    }[statusClass] || d.status;
                    
                    const roleClass = d.role || 'participant';
                    const roleName = d.roleName || ROLE_PRESETS[d.role]?.name || '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°';
                    
                    return `
                        <div class="activity-item ${statusClass}">
                            <div class="activity-header">
                                <span class="activity-title">
                                    ${d.activityName || d.activityNameBase}
                                    <span class="activity-role ${roleClass}">${roleName}</span>
                                </span>
                                <span class="activity-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="activity-meta">
                                üìÖ ${d.activityDate || '-'} | üë• ${(d.studentIds || []).length} ‡∏Ñ‡∏ô | üìä Lv.${d.activityLevel || 2}
                            </div>
                            <div class="activity-skills">
                                ${(d.skills || []).map(s => `<span class="skill-mini">${s.code} Lv.${s.level}</span>`).join('')}
                            </div>
                            ${d.status === 'Rejected' && d.rejectReason ? `<div style="color:#e74c3c;font-size:0.9em;margin-bottom:10px;">‚ùå ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${d.rejectReason}</div>` : ''}
                            <div class="activity-actions">
                                ${d.status === 'Draft' || d.status === 'Rejected' ? `
                                    <button class="btn-action btn-edit" onclick="editActivity('${doc.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button class="btn-action btn-delete" onclick="deleteActivity('${doc.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
                                ` : ''}
                            </div>
                        </div>`;
                }).join('');
                
            } catch (e) {
                list.innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</p></div>`;
            }
        }

        async function editActivity(id) {
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
            try {
                const doc = await db.collection('organizerActivities').doc(id).get();
                if (!doc.exists) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'); return; }
                const d = doc.data();
                
                document.getElementById('edit-activity-id').value = id;
                document.getElementById('organizer-name').value = d.organizerName || '';
                document.getElementById('department').value = d.department || '';
                document.getElementById('activity-name').value = d.activityNameBase || d.activityName || '';
                document.getElementById('activity-date').value = d.activityDate || '';
                document.getElementById('duration').value = d.duration || '';
                document.getElementById('description').value = d.description || '';
                document.getElementById('student-ids').value = (d.studentIds || []).join('\n');
                
                // Select role
                if (d.role) {
                    selectRole(d.role);
                }
                
                selectedSkills = d.skills || [];
                renderSelectedSkills();
                
                // Update student count
                document.getElementById('student-count').textContent = `${(d.studentIds || []).length} ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠`;
                
                // Switch to new activity tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-tab="new-activity"]').classList.add('active');
                document.getElementById('tab-new-activity').classList.add('active');
                
            } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message); }
            showLoading(false);
        }

        async function deleteActivity(id) {
            if (!confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?')) return;
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...');
            try {
                await db.collection('organizerActivities').doc(id).delete();
                alert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                await loadMyActivities();
            } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message); }
            showLoading(false);
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').textContent = text;
            if (show) overlay.classList.add('show');
            else overlay.classList.remove('show');
        }

        // Enter key handlers
        document.getElementById('organizer-email').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('organizer-password').focus();
        });
        document.getElementById('organizer-password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginOrganizer();
        });
    </script>
</body>
</html>
