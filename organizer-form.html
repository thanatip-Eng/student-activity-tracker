<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Portal - Student Talent Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1e5631 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border-left: 5px solid #27ae60;
        }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 50px; width: auto; }
        .logo h1 { color: #1a472a; font-size: 1.5em; }
        .logo p { color: #666; font-size: 0.9em; }
        .badge-organizer {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .home-link {
            color: #1a472a;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s;
            background: #e8f5e9;
        }
        .home-link:hover { background: #c8e6c9; }
        
        /* Login Section */
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 550px;
            width: 100%;
            border-top: 5px solid #27ae60;
        }
        .login-card h2 { color: #1a472a; margin-bottom: 10px; font-size: 1.6em; }
        .login-card > p { color: #666; margin-bottom: 25px; }
        .login-form { display: flex; flex-direction: column; gap: 15px; }
        .login-form input {
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }
        .login-form input:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .login-form button {
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }
        .error-message { color: #e74c3c; font-size: 0.9em; min-height: 20px; margin-top: 10px; }
        
        /* First Login Info */
        .first-login-info {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #27ae60;
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            text-align: left;
        }
        .first-login-info h4 {
            color: #1a472a;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .info-step {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        .step-number {
            background: #27ae60;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
            flex-shrink: 0;
        }
        .step-text { color: #333; font-size: 0.95em; line-height: 1.5; }
        .step-text strong { color: #1a472a; }
        
        /* Organizer Bar */
        .organizer-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #27ae60;
        }
        .organizer-info { display: flex; align-items: center; gap: 15px; }
        .avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: 700;
        }
        .organizer-info strong { display: block; color: #1a472a; }
        .organizer-info span { color: #666; font-size: 0.9em; }
        .btn-logout {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-logout:hover { background: #e9ecef; }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .tab:hover:not(.active) { background: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Form Card */
        .form-card, .activities-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .form-card h2, .activities-panel h2 {
            color: #1a472a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }
        .section-title {
            color: #27ae60;
            font-weight: 600;
            font-size: 1.1em;
            margin: 30px 0 15px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 10px;
            border-left: 4px solid #27ae60;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .required { color: #e74c3c; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #27ae60;
            outline: none;
            box-shadow: 0 0 0 4px rgba(39, 174, 96, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .form-row-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        @media (max-width: 768px) {
            .form-row-4 { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Duration Display */
        .duration-display {
            background: #e8f5e9;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
        }
        .duration-display .value {
            font-size: 1.5em;
            font-weight: 700;
            color: #27ae60;
        }
        .duration-display .label {
            color: #666;
            font-size: 0.9em;
        }
        
        /* Role Checkbox Cards */
        .role-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .role-checkbox-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .role-checkbox-card.active {
            border-color: #27ae60;
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.2);
        }
        .role-header {
            padding: 15px 20px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .role-header:hover {
            background: #e8f5e9;
        }
        .role-checkbox-card.active .role-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .role-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        .role-icon { font-size: 1.5em; }
        .role-info { flex: 1; }
        .role-info h4 { font-size: 1.1em; margin-bottom: 3px; }
        .role-info p { font-size: 0.85em; opacity: 0.8; }
        .role-level-badge {
            padding: 5px 12px;
            background: rgba(0,0,0,0.1);
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .role-checkbox-card.active .role-level-badge {
            background: rgba(255,255,255,0.2);
        }
        
        /* Role Details Panel */
        .role-details {
            display: none;
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        .role-checkbox-card.active .role-details {
            display: block;
        }
        .role-details-section {
            margin-bottom: 20px;
        }
        .role-details-section h5 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        /* Skills in Role */
        .role-skills-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .skill-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .skill-chip:hover {
            border-color: #27ae60;
            background: #e8f5e9;
        }
        .skill-chip.selected {
            background: #27ae60;
            border-color: #27ae60;
            color: white;
        }
        .skill-chip input[type="checkbox"] { display: none; }
        .skill-chip .skill-code { font-weight: 600; }
        .skill-chip select {
            padding: 3px 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.85em;
            background: white;
        }
        .skill-chip.selected select {
            background: rgba(255,255,255,0.9);
        }
        
        /* Student IDs in Role */
        .role-student-ids {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        .role-student-ids:focus {
            border-color: #27ae60;
            outline: none;
        }
        .student-count-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #27ae60;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
        }
        
        /* Submit Buttons */
        .btn-submit-group {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #e8f5e9;
        }
        .btn-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .btn-save {
            flex: 1;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-save:hover {
            background: #e9ecef;
            border-color: #aaa;
        }
        .btn-submit {
            flex: 2;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4);
        }
        
        /* Info Boxes */
        .info-box {
            background: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 10px;
            padding: 15px 20px;
            font-size: 0.9em;
        }
        .info-box.blue {
            background: #e3f2fd;
            border-color: #90caf9;
        }
        .info-box h5 {
            color: #e65100;
            margin-bottom: 8px;
        }
        .info-box.blue h5 { color: #1565c0; }
        .info-box ul {
            margin-left: 20px;
            color: #666;
        }
        .info-box li { margin-bottom: 5px; }
        
        /* Activity List */
        .activity-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #27ae60;
        }
        .activity-item.draft { border-left-color: #95a5a6; }
        .activity-item.pending { border-left-color: #f39c12; }
        .activity-item.approved { border-left-color: #27ae60; }
        .activity-item.rejected { border-left-color: #e74c3c; }
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .activity-name { font-weight: 600; color: #1a472a; font-size: 1.1em; }
        .activity-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .activity-status.draft { background: #ecf0f1; color: #7f8c8d; }
        .activity-status.pending { background: #fff3e0; color: #e67e22; }
        .activity-status.approved { background: #e8f5e9; color: #27ae60; }
        .activity-status.rejected { background: #ffebee; color: #e74c3c; }
        .activity-meta { color: #666; font-size: 0.9em; margin-bottom: 10px; }
        .activity-skills { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .skill-mini {
            background: #e8f5e9;
            color: #27ae60;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .activity-actions { display: flex; gap: 10px; }
        .btn-action {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-edit { background: #e3f2fd; color: #1976d2; }
        .btn-edit:hover { background: #bbdefb; }
        .btn-delete { background: #ffebee; color: #e53935; }
        .btn-delete:hover { background: #ffcdd2; }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #999;
        }
        .empty-state .icon { font-size: 3em; margin-bottom: 15px; }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
        }
        .loading-overlay.show { display: flex; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #27ae60;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-overlay p { color: white; font-size: 1.1em; }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 95%;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 { font-size: 1.2em; }
        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
        }
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }
        .modal-footer {
            padding: 15px 25px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .btn-modal {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-cancel { background: #e0e0e0; color: #333; }
        .btn-confirm { background: #27ae60; color: white; }
        
        /* Skill Categories in Modal */
        .skill-category {
            margin-bottom: 20px;
        }
        .skill-category h4 {
            color: #1a472a;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e8f5e9;
        }
        .skill-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .skill-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .skill-item:hover { background: #e8f5e9; }
        .skill-item.selected { background: #27ae60; color: white; }
        .skill-item input { display: none; }
        
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .btn-row { flex-direction: column; }
            .btn-save, .btn-submit { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <img src="images/MainLogo.png" alt="Logo" class="logo-img">
                <div>
                    <h1>Organizer Portal</h1>
                    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</p>
                </div>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span class="badge-organizer">üë®‚Äçüíº ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
                <a href="index.html" class="home-link">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            </div>
        </header>

        <!-- Login Section -->
        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üë®‚Äçüíº ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                <p>Organizer Login</p>
                <div class="login-form">
                    <input type="email" id="organizer-email" placeholder="Email ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î | Organizer Email">
                    <button onclick="loginOrganizer()">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö | Login</button>
                </div>
                <p id="login-error" class="error-message"></p>
                
                <div class="first-login-info">
                    <h4>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h4>
                    <div class="info-step">
                        <span class="step-number">1</span>
                        <span class="step-text"><strong>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</strong> - ‡∏ä‡∏∑‡πà‡∏≠ ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</span>
                    </div>
                    <div class="info-step">
                        <span class="step-number">2</span>
                        <span class="step-text"><strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞</strong> - ‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="info-step">
                        <span class="step-number">3</span>
                        <span class="step-text"><strong>‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</strong> - Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Section -->
        <section id="main-section" style="display: none;">
            <div class="organizer-bar">
                <div class="organizer-info">
                    <span class="avatar" id="organizer-avatar">O</span>
                    <div>
                        <strong id="display-name">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</strong>
                        <span id="display-email">organizer@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutOrganizer()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="new-activity">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                <button class="tab" data-tab="my-activities">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
            </div>

            <!-- New Activity Tab -->
            <div id="tab-new-activity" class="tab-content active">
                <div class="form-card">
                    <h2>üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Register Activity</h2>
                    
                    <form id="activity-form">
                        <input type="hidden" id="edit-activity-id">
                        
                        <!-- Step 1: Activity Info -->
                        <div class="section-title">üìù ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Details</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                                <input type="text" id="organizer-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏°‡∏£‡∏° AI">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤ <span class="required">*</span></label>
                                <input type="text" id="department" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop Generative AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                        </div>
                        
                        <div class="form-row-4">
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="required">*</span></label>
                                <input type="date" id="start-date" required onchange="calculateDuration()">
                            </div>
                            <div class="form-group">
                                <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="required">*</span></label>
                                <input type="time" id="start-time" required onchange="calculateDuration()">
                            </div>
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="required">*</span></label>
                                <input type="date" id="end-date" required onchange="calculateDuration()">
                            </div>
                            <div class="form-group">
                                <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="required">*</span></label>
                                <input type="time" id="end-time" required onchange="calculateDuration()">
                            </div>
                        </div>
                        
                        <div class="duration-display" id="duration-display" style="display: none;">
                            <span class="label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
                            <div class="value" id="calculated-duration">0 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
                        </div>
                        
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <textarea id="description" rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠..."></textarea>
                        </div>
                        
                        <!-- Step 2: Roles -->
                        <div class="section-title">üë• ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Select Roles & Students</div>
                        
                        <p style="color: #666; margin-bottom: 20px;">
                            ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
                        </p>
                        
                        <div class="role-checkboxes" id="role-checkboxes">
                            <!-- Organizer Role -->
                            <div class="role-checkbox-card" id="role-card-organizer">
                                <div class="role-header" onclick="toggleRole('organizer')">
                                    <input type="checkbox" class="role-checkbox" id="check-organizer" onchange="toggleRole('organizer')">
                                    <span class="role-icon">üëë</span>
                                    <div class="role-info">
                                        <h4>‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer Team</h4>
                                        <p>‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</p>
                                    </div>
                                    <span class="role-level-badge">Level 3-4</span>
                                </div>
                                <div class="role-details">
                                    <div class="role-details-section">
                                        <h5>üìù ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ô‡∏µ‡πâ</h5>
                                        <textarea id="role-desc-organizer" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£ ‡∏î‡∏π‡πÅ‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"></textarea>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞)</h5>
                                        <div class="role-skills-selector" id="skills-organizer"></div>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üë• ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)</h5>
                                        <textarea class="role-student-ids" id="students-organizer" rows="4" placeholder="640610001&#10;640610002&#10;640610003" onkeyup="updateStudentCount('organizer')"></textarea>
                                        <span class="student-count-badge" id="count-organizer">0 ‡∏Ñ‡∏ô</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Staff Role -->
                            <div class="role-checkbox-card" id="role-card-staff">
                                <div class="role-header" onclick="toggleRole('staff')">
                                    <input type="checkbox" class="role-checkbox" id="check-staff" onchange="toggleRole('staff')">
                                    <span class="role-icon">ü§ù</span>
                                    <div class="role-info">
                                        <h4>Staff ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô | Event Staff</h4>
                                        <p>‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î ‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
                                    </div>
                                    <span class="role-level-badge">Level 2</span>
                                </div>
                                <div class="role-details">
                                    <div class="role-details-section">
                                        <h5>üìù ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ô‡∏µ‡πâ</h5>
                                        <textarea id="role-desc-staff" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‡∏î‡∏π‡πÅ‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°"></textarea>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞)</h5>
                                        <div class="role-skills-selector" id="skills-staff"></div>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üë• ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)</h5>
                                        <textarea class="role-student-ids" id="students-staff" rows="4" placeholder="640610004&#10;640610005" onkeyup="updateStudentCount('staff')"></textarea>
                                        <span class="student-count-badge" id="count-staff">0 ‡∏Ñ‡∏ô</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Participant Role -->
                            <div class="role-checkbox-card" id="role-card-participant">
                                <div class="role-header" onclick="toggleRole('participant')">
                                    <input type="checkbox" class="role-checkbox" id="check-participant" onchange="toggleRole('participant')">
                                    <span class="role-icon">üë•</span>
                                    <div class="role-info">
                                        <h4>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Participant</h4>
                                        <p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ ‡∏ó‡∏≥ workshop ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</p>
                                    </div>
                                    <span class="role-level-badge">Level 1-2</span>
                                </div>
                                <div class="role-details">
                                    <div class="role-details-section">
                                        <h5>üìù ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ô‡∏µ‡πâ</h5>
                                        <textarea id="role-desc-participant" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î workshop ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö"></textarea>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞)</h5>
                                        <div class="role-skills-selector" id="skills-participant"></div>
                                    </div>
                                    <div class="role-details-section">
                                        <h5>üë• ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)</h5>
                                        <textarea class="role-student-ids" id="students-participant" rows="4" placeholder="640610006&#10;640610007&#10;640610008" onkeyup="updateStudentCount('participant')"></textarea>
                                        <span class="student-count-badge" id="count-participant">0 ‡∏Ñ‡∏ô</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Buttons -->
                        <div class="btn-submit-group">
                            <div class="btn-row">
                                <button type="button" class="btn-save" onclick="saveAsDraft()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á</button>
                                <button type="button" class="btn-submit" onclick="submitForApproval()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            </div>
                            
                            <div class="info-box">
                                <h5>üí° ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</h5>
                                <ul>
                                    <li><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á:</strong> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" <em>(‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏î‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞!)</em></li>
                                    <li><strong>‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</strong> ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö <strong>‡∏´‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</strong></li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- My Activities Tab -->
            <div id="tab-my-activities" class="tab-content">
                <div class="activities-panel">
                    <h2>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Activities</h2>
                    <div id="activities-list">
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
            <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        // Criteria list
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", nameEn: "Analytical Reasoning", domain: "Critical Thinking" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systematic Problem Solving", domain: "Critical Thinking" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systems Thinking", domain: "Critical Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", nameEn: "Presentation Skills", domain: "Communication" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", nameEn: "Listening & Comprehension", domain: "Communication" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", nameEn: "English Communication", domain: "Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", nameEn: "Role Understanding", domain: "Teamwork" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", nameEn: "Task Management", domain: "Teamwork" },
            { code: "3.3", nameTh: "‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥", nameEn: "Leadership", domain: "Teamwork" },
            { code: "4.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ", nameEn: "Technology Utilization", domain: "Digital & Learning" },
            { code: "4.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á", nameEn: "Self-Learning", domain: "Digital & Learning" },
            { code: "4.3", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏ß‡∏á‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ", nameEn: "Knowledge Seeking", domain: "Digital & Learning" },
            { code: "5.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå", nameEn: "Creativity", domain: "Innovation" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°", nameEn: "Innovation Design", domain: "Innovation" },
            { code: "5.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", nameEn: "Application", domain: "Innovation" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", nameEn: "Adaptability", domain: "Self Development" },
            { code: "6.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå", nameEn: "Emotional Management", domain: "Self Development" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", nameEn: "Empathy", domain: "Self Development" }
        ];
        
        // Role configs
        const ROLE_CONFIG = {
            organizer: { name: '‡∏ó‡∏µ‡∏°‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î', level: 4, suggestedSkills: ['3.3', '5.2', '2.1'] },
            staff: { name: 'Staff', level: 2, suggestedSkills: ['3.1', '3.2', '6.1'] },
            participant: { name: '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°', level: 2, suggestedSkills: ['4.2', '4.3', '2.2'] }
        };
        
        let currentOrganizer = null;
        let selectedSkillsByRole = { organizer: [], staff: [], participant: [] };
        
        // Login
        async function loginOrganizer() {
            const email = document.getElementById('organizer-email').value.trim().toLowerCase();
            const errorEl = document.getElementById('login-error');
            
            if (!email || !email.includes('@')) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');
            
            try {
                currentOrganizer = { email: email };
                sessionStorage.setItem('organizerSession', JSON.stringify(currentOrganizer));
                
                document.getElementById('organizer-avatar').textContent = email.charAt(0).toUpperCase();
                document.getElementById('display-name').textContent = email.split('@')[0];
                document.getElementById('display-email').textContent = email;
                
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-section').style.display = 'block';
                
                initSkillSelectors();
                await loadMyActivities();
            } catch (e) {
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message;
            }
            showLoading(false);
        }
        
        function logoutOrganizer() {
            currentOrganizer = null;
            sessionStorage.removeItem('organizerSession');
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('main-section').style.display = 'none';
        }
        
        // Check session
        window.onload = function() {
            const session = sessionStorage.getItem('organizerSession');
            if (session) {
                currentOrganizer = JSON.parse(session);
                document.getElementById('organizer-avatar').textContent = currentOrganizer.email.charAt(0).toUpperCase();
                document.getElementById('display-name').textContent = currentOrganizer.email.split('@')[0];
                document.getElementById('display-email').textContent = currentOrganizer.email;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-section').style.display = 'block';
                initSkillSelectors();
                loadMyActivities();
            }
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                    if (this.dataset.tab === 'my-activities') loadMyActivities();
                });
            });
        };
        
        // Calculate duration
        function calculateDuration() {
            const startDate = document.getElementById('start-date').value;
            const startTime = document.getElementById('start-time').value;
            const endDate = document.getElementById('end-date').value;
            const endTime = document.getElementById('end-time').value;
            
            if (startDate && startTime && endDate && endTime) {
                const start = new Date(startDate + 'T' + startTime);
                const end = new Date(endDate + 'T' + endTime);
                const diffMs = end - start;
                
                if (diffMs > 0) {
                    const hours = Math.round(diffMs / (1000 * 60 * 60) * 10) / 10;
                    document.getElementById('calculated-duration').textContent = hours + ' ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á';
                    document.getElementById('duration-display').style.display = 'block';
                } else {
                    document.getElementById('duration-display').style.display = 'none';
                }
            }
        }
        
        // Toggle role
        function toggleRole(role) {
            const checkbox = document.getElementById('check-' + role);
            const card = document.getElementById('role-card-' + role);
            
            // Toggle checkbox if clicking header
            if (event && event.target !== checkbox) {
                checkbox.checked = !checkbox.checked;
            }
            
            if (checkbox.checked) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        }
        
        // Initialize skill selectors for each role
        function initSkillSelectors() {
            ['organizer', 'staff', 'participant'].forEach(role => {
                const container = document.getElementById('skills-' + role);
                const config = ROLE_CONFIG[role];
                
                container.innerHTML = CRITERIA_LIST.map(c => {
                    const isSuggested = config.suggestedSkills.includes(c.code);
                    return `
                        <div class="skill-chip ${isSuggested ? 'selected' : ''}" 
                             data-code="${c.code}" data-role="${role}"
                             onclick="toggleSkill('${role}', '${c.code}', this)">
                            <span class="skill-code">${c.code}</span>
                            <span class="skill-name">${c.nameTh}</span>
                            <select onclick="event.stopPropagation()" onchange="updateSkillLevel('${role}', '${c.code}', this.value)">
                                ${[1,2,3,4].map(l => `<option value="${l}" ${l === config.level ? 'selected' : ''} ${l > config.level ? 'disabled' : ''}>Lv.${l}</option>`).join('')}
                            </select>
                        </div>
                    `;
                }).join('');
                
                // Initialize selected skills
                selectedSkillsByRole[role] = config.suggestedSkills.map(code => ({
                    code: code,
                    level: config.level,
                    nameTh: CRITERIA_LIST.find(c => c.code === code)?.nameTh || ''
                }));
            });
        }
        
        function toggleSkill(role, code, element) {
            const config = ROLE_CONFIG[role];
            const maxSkills = 3;
            
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedSkillsByRole[role] = selectedSkillsByRole[role].filter(s => s.code !== code);
            } else {
                if (selectedSkillsByRole[role].length >= maxSkills) {
                    alert(`‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${maxSkills} ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ï‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó`);
                    return;
                }
                element.classList.add('selected');
                const level = parseInt(element.querySelector('select').value);
                selectedSkillsByRole[role].push({
                    code: code,
                    level: level,
                    nameTh: CRITERIA_LIST.find(c => c.code === code)?.nameTh || ''
                });
            }
        }
        
        function updateSkillLevel(role, code, level) {
            const skill = selectedSkillsByRole[role].find(s => s.code === code);
            if (skill) {
                skill.level = parseInt(level);
            }
        }
        
        // Update student count
        function updateStudentCount(role) {
            const textarea = document.getElementById('students-' + role);
            const count = textarea.value.trim().split('\n').filter(id => id.trim().length > 0).length;
            document.getElementById('count-' + role).textContent = count + ' ‡∏Ñ‡∏ô';
        }
        
        // Validate form
        function validateForm() {
            const required = ['organizer-name', 'department', 'activity-name', 'start-date', 'start-time', 'end-date', 'end-time'];
            for (const id of required) {
                if (!document.getElementById(id).value.trim()) {
                    alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    document.getElementById(id).focus();
                    return false;
                }
            }
            
            // Check at least one role selected
            const roles = ['organizer', 'staff', 'participant'];
            const selectedRoles = roles.filter(r => document.getElementById('check-' + r).checked);
            
            if (selectedRoles.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó');
                return false;
            }
            
            // Check each selected role has students
            for (const role of selectedRoles) {
                const students = document.getElementById('students-' + role).value.trim();
                if (!students) {
                    alert(`‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ${ROLE_CONFIG[role].name}`);
                    document.getElementById('students-' + role).focus();
                    return false;
                }
                
                if (selectedSkillsByRole[role].length === 0) {
                    alert(`‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ${ROLE_CONFIG[role].name}`);
                    return false;
                }
            }
            
            return true;
        }
        
        // Get duration in hours
        function getDurationHours() {
            const startDate = document.getElementById('start-date').value;
            const startTime = document.getElementById('start-time').value;
            const endDate = document.getElementById('end-date').value;
            const endTime = document.getElementById('end-time').value;
            
            if (startDate && startTime && endDate && endTime) {
                const start = new Date(startDate + 'T' + startTime);
                const end = new Date(endDate + 'T' + endTime);
                return Math.round((end - start) / (1000 * 60 * 60) * 10) / 10;
            }
            return 0;
        }
        
        // Save as draft
        async function saveAsDraft() {
            if (!currentOrganizer) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            await saveActivity('Draft');
        }
        
        // Submit for approval
        async function submitForApproval() {
            if (!validateForm()) return;
            
            if (!confirm('üì§ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?\n\n‡∏´‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ')) {
                return;
            }
            
            await saveActivity('Pending');
        }
        
        // Save activity
        async function saveActivity(status) {
            showLoading(true, status === 'Draft' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            
            try {
                const roles = ['organizer', 'staff', 'participant'];
                const selectedRoles = roles.filter(r => document.getElementById('check-' + r).checked);
                
                const baseActivityName = document.getElementById('activity-name').value.trim();
                const editId = document.getElementById('edit-activity-id').value;
                
                // Save each role as separate activity
                for (const role of selectedRoles) {
                    const studentIds = document.getElementById('students-' + role).value.trim()
                        .split('\n').map(id => id.trim()).filter(id => id.length > 0);
                    
                    const activityData = {
                        organizerEmail: currentOrganizer.email,
                        organizerName: document.getElementById('organizer-name').value.trim(),
                        department: document.getElementById('department').value.trim(),
                        activityNameBase: baseActivityName,
                        activityName: `${baseActivityName} (${ROLE_CONFIG[role].name})`,
                        startDate: document.getElementById('start-date').value,
                        startTime: document.getElementById('start-time').value,
                        endDate: document.getElementById('end-date').value,
                        endTime: document.getElementById('end-time').value,
                        activityDate: document.getElementById('start-date').value,
                        duration: getDurationHours(),
                        durationUnit: '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á',
                        description: document.getElementById('description').value.trim(),
                        roleDescription: document.getElementById('role-desc-' + role).value.trim(),
                        role: role,
                        roleName: ROLE_CONFIG[role].name,
                        activityLevel: ROLE_CONFIG[role].level,
                        skills: selectedSkillsByRole[role],
                        studentIds: studentIds,
                        status: status,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    // If editing, check if this role exists
                    if (editId) {
                        // Try to find existing activity with same base name and role
                        const existing = await db.collection('organizerActivities')
                            .where('organizerEmail', '==', currentOrganizer.email)
                            .where('activityNameBase', '==', baseActivityName)
                            .where('role', '==', role)
                            .get();
                        
                        if (!existing.empty) {
                            await db.collection('organizerActivities').doc(existing.docs[0].id).update(activityData);
                        } else {
                            activityData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                            await db.collection('organizerActivities').add(activityData);
                        }
                    } else {
                        activityData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection('organizerActivities').add(activityData);
                    }
                }
                
                const msg = status === 'Draft' 
                    ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô"' 
                    : '‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n‡∏£‡∏≠ Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                alert(msg);
                
                // Reset form
                document.getElementById('activity-form').reset();
                document.getElementById('edit-activity-id').value = '';
                ['organizer', 'staff', 'participant'].forEach(r => {
                    document.getElementById('check-' + r).checked = false;
                    document.getElementById('role-card-' + r).classList.remove('active');
                    document.getElementById('count-' + r).textContent = '0 ‡∏Ñ‡∏ô';
                });
                document.getElementById('duration-display').style.display = 'none';
                initSkillSelectors();
                
                // Switch to my activities tab
                document.querySelector('.tab[data-tab="my-activities"]').click();
                
            } catch (e) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
                console.error(e);
            }
            showLoading(false);
        }
        
        // Load my activities
        async function loadMyActivities() {
            const list = document.getElementById('activities-list');
            list.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p></div>';
            
            try {
                const q = await db.collection('organizerActivities')
                    .where('organizerEmail', '==', currentOrganizer.email)
                    .get();
                
                if (q.empty) {
                    list.innerHTML = '<div class="empty-state"><div class="icon">üì≠</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p></div>';
                    return;
                }
                
                // Sort by updatedAt
                const docs = q.docs.sort((a, b) => {
                    const timeA = a.data().updatedAt?.toDate?.() || new Date(0);
                    const timeB = b.data().updatedAt?.toDate?.() || new Date(0);
                    return timeB - timeA;
                });
                
                list.innerHTML = docs.map(doc => {
                    const d = doc.data();
                    const statusClass = (d.status || 'draft').toLowerCase();
                    const statusText = {
                        'draft': 'üìù ‡∏£‡πà‡∏≤‡∏á',
                        'pending': '‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                        'approved': '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
                        'rejected': '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'
                    }[statusClass] || d.status;
                    
                    return `
                        <div class="activity-item ${statusClass}">
                            <div class="activity-header">
                                <span class="activity-name">${d.activityName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</span>
                                <span class="activity-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="activity-meta">
                                üìÖ ${d.startDate || d.activityDate || '-'} | 
                                ‚è±Ô∏è ${d.duration || '-'} ‡∏ä‡∏°. | 
                                üë• ${(d.studentIds || []).length} ‡∏Ñ‡∏ô
                            </div>
                            <div class="activity-skills">
                                ${(d.approvedSkills || d.skills || []).map(s => `<span class="skill-mini">${s.code} Lv.${s.level}</span>`).join('')}
                            </div>
                            ${d.status === 'Rejected' && d.rejectReason ? `<div style="color:#e74c3c;font-size:0.9em;margin-bottom:10px;">‚ùå ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${d.rejectReason}</div>` : ''}
                            ${d.status === 'Approved' && d.adminNote ? `<div style="background:#e3f2fd;color:#1565c0;font-size:0.9em;padding:10px;border-radius:8px;margin-bottom:10px;border-left:3px solid #2196f3;">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å Admin: ${d.adminNote}</div>` : ''}
                            <div class="activity-actions">
                                ${d.status === 'Draft' || d.status === 'Rejected' ? `
                                    <button class="btn-action btn-edit" onclick="editActivity('${doc.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button class="btn-action btn-delete" onclick="deleteActivity('${doc.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
                                ` : ''}
                            </div>
                        </div>`;
                }).join('');
                
            } catch (e) {
                list.innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</p></div>`;
            }
        }
        
        // Edit activity
        async function editActivity(id) {
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
            try {
                const doc = await db.collection('organizerActivities').doc(id).get();
                if (!doc.exists) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'); return; }
                const d = doc.data();
                
                // Fill form
                document.getElementById('edit-activity-id').value = id;
                document.getElementById('organizer-name').value = d.organizerName || '';
                document.getElementById('department').value = d.department || '';
                document.getElementById('activity-name').value = d.activityNameBase || d.activityName || '';
                document.getElementById('start-date').value = d.startDate || d.activityDate || '';
                document.getElementById('start-time').value = d.startTime || '';
                document.getElementById('end-date').value = d.endDate || d.startDate || '';
                document.getElementById('end-time').value = d.endTime || '';
                document.getElementById('description').value = d.description || '';
                
                // Check the role
                const role = d.role || 'participant';
                document.getElementById('check-' + role).checked = true;
                document.getElementById('role-card-' + role).classList.add('active');
                document.getElementById('role-desc-' + role).value = d.roleDescription || '';
                document.getElementById('students-' + role).value = (d.studentIds || []).join('\n');
                updateStudentCount(role);
                
                // Set skills
                if (d.skills) {
                    selectedSkillsByRole[role] = d.skills;
                    // Update UI
                    d.skills.forEach(s => {
                        const chip = document.querySelector(`.skill-chip[data-code="${s.code}"][data-role="${role}"]`);
                        if (chip) {
                            chip.classList.add('selected');
                            chip.querySelector('select').value = s.level;
                        }
                    });
                }
                
                calculateDuration();
                
                // Switch to new activity tab
                document.querySelector('.tab[data-tab="new-activity"]').click();
                
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
            showLoading(false);
        }
        
        // Delete activity
        async function deleteActivity(id) {
            if (!confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?')) return;
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...');
            try {
                await db.collection('organizerActivities').doc(id).delete();
                alert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                await loadMyActivities();
            } catch (e) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
            }
            showLoading(false);
        }
        
        // Loading
        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').textContent = text;
            if (show) overlay.classList.add('show');
            else overlay.classList.remove('show');
        }
    </script>
</body>
</html>
