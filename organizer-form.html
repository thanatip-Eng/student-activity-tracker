<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - Organizer Activity Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/form-style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üë®‚Äçüíº</span>
                <div>
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
                    <p>Activity Registration for Organizers</p>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</a>
                <a href="student-form.html">üìù ‡∏ô‡∏®.‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
            </nav>
        </header>

        <!-- Login Section -->
        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                <div class="login-form">
                    <input type="email" id="organizer-email" placeholder="organizer@cmu.ac.th">
                    <button onclick="loginOrganizer()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <p id="login-error" class="error-message"></p>
                <p class="login-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏î‡∏à‡∏≥ Email ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
            </div>
        </section>

        <!-- Main Section -->
        <section id="main-section" class="main-section" style="display: none;">
            <!-- Organizer Info Bar -->
            <div class="student-bar organizer-bar">
                <div class="student-info">
                    <span class="avatar organizer-avatar">O</span>
                    <div>
                        <strong id="display-name">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</strong>
                        <span id="display-email">organizer@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutOrganizer()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="new-activity">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                <button class="tab" data-tab="my-activities">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
            </div>

            <!-- Tab: New Activity -->
            <div id="tab-new-activity" class="tab-content active">
                <div class="form-card">
                    <h2>üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
                    
                    <form id="activity-form" onsubmit="saveActivity(event)">
                        <input type="hidden" id="edit-activity-id">
                        
                        <!-- Organizer Info -->
                        <div class="section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                                <input type="text" id="organizer-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏°‡∏£‡∏° AI, ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤ CPE">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                                <input type="text" id="department" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                            </div>
                        </div>

                        <!-- Activity Info -->
                        <div class="section-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="required">*</span></label>
                                <input type="date" id="start-date" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="required">*</span></label>
                                <input type="date" id="end-date" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ <span class="required">*</span></label>
                                <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                            </div>
                            <div class="form-group">
                                <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                <select id="duration-unit">
                                    <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                    <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô</option>
                                    <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                                </select>
                            </div>
                        </div>

                        <!-- Activity Level -->
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <div class="level-options">
                                <label class="level-option">
                                    <input type="radio" name="activity-level" value="1" required>
                                    <div class="level-card">
                                        <span class="level-number">1</span>
                                        <span class="level-title">‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</span>
                                    </div>
                                </label>
                                <label class="level-option">
                                    <input type="radio" name="activity-level" value="2">
                                    <div class="level-card">
                                        <span class="level-number">2</span>
                                        <span class="level-title">Workshop</span>
                                    </div>
                                </label>
                                <label class="level-option">
                                    <input type="radio" name="activity-level" value="3">
                                    <div class="level-card">
                                        <span class="level-number">3</span>
                                        <span class="level-title">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</span>
                                    </div>
                                </label>
                                <label class="level-option">
                                    <input type="radio" name="activity-level" value="4">
                                    <div class="level-card">
                                        <span class="level-number">4</span>
                                        <span class="level-title">‡∏ú‡∏π‡πâ‡∏ô‡∏≥/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                            <textarea id="description" required rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ <span class="required">*</span></label>
                            <textarea id="learning-outcomes" required rows="3" placeholder="‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á..."></textarea>
                        </div>

                        <!-- Skills Selection -->
                        <div class="section-title">üéØ ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</div>
                        <div class="skills-selector">
                            <div id="selected-skills" class="selected-skills"></div>
                            <button type="button" class="btn-add-skill" onclick="openSkillModal()">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏Å‡∏©‡∏∞
                            </button>
                        </div>

                        <!-- Promotional Link -->
                        <div class="form-group">
                            <label>Link ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input type="url" id="promotional-link" placeholder="https://...">
                        </div>

                        <!-- Actions -->
                        <div class="form-actions">
                            <button type="submit" class="btn-secondary" name="action" value="draft">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á
                            </button>
                            <button type="button" class="btn-submit" onclick="saveAndSubmit()">
                                üöÄ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tab: My Activities -->
            <div id="tab-my-activities" class="tab-content">
                <div class="activities-panel">
                    <h2>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                    <div id="my-activities-list" class="activities-list">
                        <div class="empty-state">
                            <span class="icon">üì≠</span>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skill Selection Modal -->
        <div id="skill-modal" class="modal-overlay">
            <div class="modal skill-modal">
                <div class="modal-header">
                    <h3>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞</h3>
                    <button class="modal-close" onclick="closeSkillModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div id="skill-categories" class="skill-categories">
                        <!-- Generated by JS -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeSkillModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-primary" onclick="confirmSkills()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                </div>
            </div>
        </div>

        <!-- Add Students Modal -->
        <div id="students-modal" class="modal-overlay">
            <div class="modal students-modal">
                <div class="modal-header">
                    <h3>üë• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
                    <button class="modal-close" onclick="closeStudentsModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢ Enter ‡∏´‡∏£‡∏∑‡∏≠ , )</p>
                    <textarea id="student-ids-input" rows="6" placeholder="640610001&#10;640610002&#10;640610003"></textarea>
                    <div id="student-count" class="student-count"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeStudentsModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-primary" onclick="addStudentsToActivity()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-box">
                <div class="spinner"></div>
                <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        // ============================================
        // CRITERIA DEFINITIONS
        // ============================================
        const CRITERIA_LIST = [
            { code: "1.1", name: "Analytical Reasoning", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", domain: "Critical Thinking" },
            { code: "1.2", name: "Problem Solving", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", domain: "Critical Thinking" },
            { code: "1.3", name: "Systems Thinking", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö", domain: "Critical Thinking" },
            { code: "2.1", name: "Presentation", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", domain: "Communication" },
            { code: "2.2", name: "Listening", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", domain: "Communication" },
            { code: "2.3", name: "English", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", domain: "Communication" },
            { code: "3.1", name: "Role Understanding", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", domain: "Teamwork" },
            { code: "3.2", name: "Task Management", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", domain: "Teamwork" },
            { code: "3.3", name: "Collaboration", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", domain: "Teamwork" },
            { code: "4.1", name: "Learning Agility", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", domain: "Digital & Learning" },
            { code: "4.2", name: "Digital Literacy", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", domain: "Digital & Learning" },
            { code: "4.3", name: "Tool Proficiency", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", domain: "Digital & Learning" },
            { code: "5.1", name: "Human-Centered Design", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", domain: "Innovation" },
            { code: "5.2", name: "Project Management", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", domain: "Innovation" },
            { code: "5.3", name: "Business Awareness", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", domain: "Innovation" },
            { code: "6.1", name: "Personal Growth", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", domain: "Self Development" },
            { code: "6.2", name: "Resilience", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", domain: "Self Development" },
            { code: "6.3", name: "Empathy", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", domain: "Self Development" }
        ];

        const DOMAINS = ["Critical Thinking", "Communication", "Teamwork", "Digital & Learning", "Innovation", "Self Development"];

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let currentOrganizer = null;
        let selectedSkills = [];
        let tempSelectedSkills = [];
        let currentActivityId = null;

        // ============================================
        // LOGIN FUNCTIONS
        // ============================================
        async function loginOrganizer() {
            const email = document.getElementById('organizer-email').value.trim().toLowerCase();
            const errorEl = document.getElementById('login-error');
            
            if (!email || !email.includes('@')) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');
            
            currentOrganizer = { email: email };
            
            // Update UI
            document.getElementById('display-name').textContent = email.split('@')[0];
            document.getElementById('display-email').textContent = email;
            
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('main-section').style.display = 'block';
            
            await loadMyActivities();
            initSkillModal();
            
            showLoading(false);
        }

        function logoutOrganizer() {
            currentOrganizer = null;
            selectedSkills = [];
            document.getElementById('activity-form').reset();
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('organizer-email').value = '';
        }

        // ============================================
        // TABS
        // ============================================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                
                if (tab.dataset.tab === 'my-activities') {
                    loadMyActivities();
                }
            });
        });

        // ============================================
        // SKILL MODAL
        // ============================================
        function initSkillModal() {
            const container = document.getElementById('skill-categories');
            container.innerHTML = DOMAINS.map(domain => {
                const domainSkills = CRITERIA_LIST.filter(c => c.domain === domain);
                return `
                    <div class="skill-domain">
                        <h4>${domain}</h4>
                        <div class="skill-items">
                            ${domainSkills.map(skill => `
                                <div class="skill-item" data-code="${skill.code}">
                                    <div class="skill-info">
                                        <input type="checkbox" id="skill-${skill.code}">
                                        <label for="skill-${skill.code}">
                                            <strong>${skill.code}</strong> ${skill.nameTh}
                                        </label>
                                    </div>
                                    <select class="skill-level" disabled>
                                        <option value="1">Lv.1</option>
                                        <option value="2">Lv.2</option>
                                        <option value="3">Lv.3</option>
                                        <option value="4">Lv.4</option>
                                    </select>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            container.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const skillItem = e.target.closest('.skill-item');
                    const levelSelect = skillItem.querySelector('.skill-level');
                    levelSelect.disabled = !e.target.checked;
                    if (e.target.checked) {
                        skillItem.classList.add('selected');
                    } else {
                        skillItem.classList.remove('selected');
                    }
                });
            });
        }

        function openSkillModal() {
            // Reset to current selected skills
            tempSelectedSkills = [...selectedSkills];
            
            document.querySelectorAll('.skill-item').forEach(item => {
                const code = item.dataset.code;
                const checkbox = item.querySelector('input[type="checkbox"]');
                const levelSelect = item.querySelector('.skill-level');
                
                const existing = selectedSkills.find(s => s.code === code);
                if (existing) {
                    checkbox.checked = true;
                    levelSelect.disabled = false;
                    levelSelect.value = existing.level;
                    item.classList.add('selected');
                } else {
                    checkbox.checked = false;
                    levelSelect.disabled = true;
                    levelSelect.value = '1';
                    item.classList.remove('selected');
                }
            });
            
            document.getElementById('skill-modal').classList.add('show');
        }

        function closeSkillModal() {
            document.getElementById('skill-modal').classList.remove('show');
        }

        function confirmSkills() {
            selectedSkills = [];
            
            document.querySelectorAll('.skill-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    const code = item.dataset.code;
                    const level = parseInt(item.querySelector('.skill-level').value);
                    const criteria = CRITERIA_LIST.find(c => c.code === code);
                    selectedSkills.push({
                        code: code,
                        level: level,
                        name: criteria.name,
                        nameTh: criteria.nameTh
                    });
                }
            });
            
            renderSelectedSkills();
            closeSkillModal();
        }

        function renderSelectedSkills() {
            const container = document.getElementById('selected-skills');
            
            if (selectedSkills.length === 0) {
                container.innerHTML = '<p class="no-skills">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞</p>';
                return;
            }
            
            container.innerHTML = selectedSkills.map(skill => `
                <div class="skill-tag">
                    <span>${skill.code} ${skill.nameTh}</span>
                    <span class="skill-level-badge">Lv.${skill.level}</span>
                    <button type="button" onclick="removeSkill('${skill.code}')" class="remove-skill">‚úï</button>
                </div>
            `).join('');
        }

        function removeSkill(code) {
            selectedSkills = selectedSkills.filter(s => s.code !== code);
            renderSelectedSkills();
        }

        // ============================================
        // SAVE ACTIVITY
        // ============================================
        async function saveActivity(event) {
            event.preventDefault();
            await saveActivityData('Draft');
        }

        async function saveAndSubmit() {
            await saveActivityData('Pending');
        }

        async function saveActivityData(status) {
            if (!currentOrganizer) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            if (selectedSkills.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞');
                return;
            }
            
            showLoading(true, status === 'Draft' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            
            try {
                const activityData = {
                    organizerEmail: currentOrganizer.email,
                    organizerName: document.getElementById('organizer-name').value.trim(),
                    department: document.getElementById('department').value.trim(),
                    activityName: document.getElementById('activity-name').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: parseInt(document.getElementById('duration').value),
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.querySelector('input[name="activity-level"]:checked').value),
                    description: document.getElementById('description').value.trim(),
                    learningOutcomes: document.getElementById('learning-outcomes').value.trim(),
                    skills: selectedSkills,
                    promotionalLink: document.getElementById('promotional-link').value.trim(),
                    status: status,
                    studentIds: [],
                    studentCount: 0,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const editId = document.getElementById('edit-activity-id').value;
                
                if (editId) {
                    // Update existing
                    await db.collection('organizerActivities').doc(editId).update(activityData);
                } else {
                    // Create new
                    activityData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('organizerActivities').add(activityData);
                }
                
                // Reset form
                document.getElementById('activity-form').reset();
                document.getElementById('edit-activity-id').value = '';
                selectedSkills = [];
                renderSelectedSkills();
                
                // Show message
                if (status === 'Pending') {
                    alert('‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
                // Switch to activities tab
                document.querySelector('[data-tab="my-activities"]').click();
                
            } catch (error) {
                console.error('Save error:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
            
            showLoading(false);
        }

        // ============================================
        // LOAD MY ACTIVITIES
        // ============================================
        async function loadMyActivities() {
            const container = document.getElementById('my-activities-list');
            
            if (!currentOrganizer) return;
            
            try {
                const query = await db.collection('organizerActivities')
                    .where('organizerEmail', '==', currentOrganizer.email)
                    .orderBy('updatedAt', 'desc')
                    .get();
                
                if (query.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <span class="icon">üì≠</span>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = query.docs.map(doc => {
                    const data = doc.data();
                    const statusClass = getStatusClass(data.status);
                    const statusText = getStatusText(data.status);
                    
                    return `
                        <div class="activity-card status-${statusClass}">
                            <div class="activity-header">
                                <h3>${data.activityName}</h3>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div class="activity-meta">
                                <span>üìÖ ${data.startDate} - ${data.endDate}</span>
                                <span>‚è±Ô∏è ${data.duration} ${data.durationUnit}</span>
                                <span>üìä Level ${data.activityLevel}</span>
                                <span>üë• ${data.studentCount || 0} ‡∏Ñ‡∏ô</span>
                            </div>
                            <div class="activity-skills">
                                ${(data.skills || []).map(s => `
                                    <span class="skill-mini">${s.code} Lv.${s.level}</span>
                                `).join('')}
                            </div>
                            <div class="activity-actions">
                                ${data.status === 'Draft' ? `
                                    <button onclick="editActivity('${doc.id}')" class="btn-small btn-edit">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button onclick="submitForApproval('${doc.id}')" class="btn-small btn-submit-approval">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                ` : ''}
                                ${data.status === 'Approved' || data.status === 'Draft' || data.status === 'Pending' ? `
                                    <button onclick="openStudentsModal('${doc.id}')" class="btn-small btn-students">üë• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
                                ` : ''}
                                ${data.status === 'Rejected' ? `
                                    <button onclick="editActivity('${doc.id}')" class="btn-small btn-edit">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                                    <div class="reject-reason">‚ùå ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${data.rejectReason || '-'}</div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Load activities error:', error);
            }
        }

        // ============================================
        // EDIT ACTIVITY
        // ============================================
        async function editActivity(activityId) {
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            try {
                const doc = await db.collection('organizerActivities').doc(activityId).get();
                
                if (!doc.exists) {
                    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°');
                    showLoading(false);
                    return;
                }
                
                const data = doc.data();
                
                // Fill form
                document.getElementById('edit-activity-id').value = activityId;
                document.getElementById('organizer-name').value = data.organizerName || '';
                document.getElementById('department').value = data.department || '';
                document.getElementById('activity-name').value = data.activityName || '';
                document.getElementById('start-date').value = data.startDate || '';
                document.getElementById('end-date').value = data.endDate || '';
                document.getElementById('duration').value = data.duration || '';
                document.getElementById('duration-unit').value = data.durationUnit || '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á';
                document.querySelector(`input[name="activity-level"][value="${data.activityLevel}"]`).checked = true;
                document.getElementById('description').value = data.description || '';
                document.getElementById('learning-outcomes').value = data.learningOutcomes || '';
                document.getElementById('promotional-link').value = data.promotionalLink || '';
                
                // Load skills
                selectedSkills = data.skills || [];
                renderSelectedSkills();
                
                // Switch to form tab
                document.querySelector('[data-tab="new-activity"]').click();
                
            } catch (error) {
                console.error('Edit error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
            
            showLoading(false);
        }

        // ============================================
        // SUBMIT FOR APPROVAL
        // ============================================
        async function submitForApproval(activityId) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?')) return;
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...');
            
            try {
                await db.collection('organizerActivities').doc(activityId).update({
                    status: 'Pending',
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('‚úÖ ‡∏™‡πà‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                await loadMyActivities();
                
            } catch (error) {
                console.error('Submit error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
            
            showLoading(false);
        }

        // ============================================
        // ADD STUDENTS MODAL
        // ============================================
        function openStudentsModal(activityId) {
            currentActivityId = activityId;
            document.getElementById('student-ids-input').value = '';
            document.getElementById('student-count').textContent = '';
            document.getElementById('students-modal').classList.add('show');
        }

        function closeStudentsModal() {
            document.getElementById('students-modal').classList.remove('show');
            currentActivityId = null;
        }

        async function addStudentsToActivity() {
            if (!currentActivityId) return;
            
            const input = document.getElementById('student-ids-input').value;
            const studentIds = input.split(/[\n,]/)
                .map(id => id.trim())
                .filter(id => id.length > 0);
            
            if (studentIds.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤');
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤...');
            
            try {
                // Get current activity
                const actDoc = await db.collection('organizerActivities').doc(currentActivityId).get();
                const actData = actDoc.data();
                
                // Merge student IDs
                const existingIds = actData.studentIds || [];
                const allIds = [...new Set([...existingIds, ...studentIds])];
                
                // Update activity
                await db.collection('organizerActivities').doc(currentActivityId).update({
                    studentIds: allIds,
                    studentCount: allIds.length,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // If approved, also add to participation
                if (actData.status === 'Approved') {
                    for (const studentId of studentIds) {
                        // Check if already exists
                        const existing = await db.collection('participation')
                            .where('studentId', '==', studentId)
                            .where('activityName', '==', actData.activityName)
                            .get();
                        
                        if (existing.empty) {
                            await db.collection('participation').add({
                                studentId: studentId,
                                activityName: actData.activityName,
                                status: 'Approved',
                                date: actData.startDate,
                                addedBy: 'organizer',
                                addedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    }
                }
                
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${studentIds.length} ‡∏Ñ‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                closeStudentsModal();
                await loadMyActivities();
                
            } catch (error) {
                console.error('Add students error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
            
            showLoading(false);
        }

        // ============================================
        // HELPERS
        // ============================================
        function getStatusClass(status) {
            if (!status) return 'draft';
            const s = status.toLowerCase();
            if (s === 'approved') return 'approved';
            if (s === 'rejected') return 'rejected';
            if (s === 'pending') return 'pending';
            return 'draft';
        }

        function getStatusText(status) {
            if (!status) return 'üìù ‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á';
            const s = status.toLowerCase();
            if (s === 'approved') return '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
            if (s === 'rejected') return '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            if (s === 'pending') return '‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            return 'üìù ‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á';
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').textContent = text;
            if (show) {
                overlay.classList.add('show');
            } else {
                overlay.classList.remove('show');
            }
        }

        // Enter key handler
        document.getElementById('organizer-email').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginOrganizer();
        });
    </script>
</body>
</html>
