<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Submit Activity - Student Talent Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/form-style.css">
    <style>
        /* Reflection Section Styles */
        .reflection-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #81c784;
        }
        .reflection-section h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .reflection-intro {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        .reflection-intro p {
            color: #555;
            font-size: 0.95em;
            margin: 0;
        }
        .reflection-question {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #a5d6a7;
        }
        .reflection-question label {
            display: block;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .reflection-question .question-hint {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .reflection-question .question-hint strong {
            color: #1976d2;
        }
        .reflection-question textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .reflection-question textarea:focus {
            outline: none;
            border-color: #4caf50;
        }
        .reflection-question textarea::placeholder {
            color: #999;
        }
        
        /* AI Result Styles */
        .ai-result-section {
            margin-top: 20px;
        }
        .ai-skill-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .ai-skill-card .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .ai-skill-card .skill-code {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }
        .ai-skill-card .skill-name {
            color: #333;
            font-size: 0.95em;
        }
        .ai-skill-card .skill-level {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .ai-skill-card .skill-reason {
            background: #f0f4ff;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #555;
            margin-top: 8px;
        }
        .ai-skill-card .skill-reason::before {
            content: "üí° ";
        }
        
        .ai-note {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
        
        /* Character counter */
        .char-counter {
            text-align: right;
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
        }
        .char-counter.warning { color: #f39c12; }
        .char-counter.good { color: #27ae60; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <img src="images/MainLogo.png" alt="Student Talent Development" class="logo-img">
                <div>
                    <h1>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Submit Activity</h1>
                    <p>Student Talent Development System</p>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">üîç ‡∏î‡∏π‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Results</a>
            </nav>
        </header>

        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student Search</h2>
                <p>‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Enter your Email to submit activity</p>
                <div class="login-form">
                    <input type="email" id="student-email" placeholder="Email (example@cmu.ac.th)">
                    <button onclick="loginStudent()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ | Search</button>
                </div>
                <p id="login-error" class="error-message"></p>
                <p class="login-note">üí° ‡πÉ‡∏ä‡πâ Email ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ | Use your registered Email</p>
            </div>
        </section>

        <section id="form-section" class="form-section" style="display: none;">
            <div class="student-bar">
                <div class="student-info">
                    <span class="avatar" id="student-avatar">S</span>
                    <div>
                        <strong id="display-name">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student</strong>
                        <span id="display-email">email@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutStudent()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö | Logout</button>
            </div>

            <div class="form-card">
                <h2>üìã ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Submission Form</h2>
                
                <form id="activity-form" onsubmit="submitActivity(event)">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Name <span class="required">*</span></label>
                        <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners">
                    </div>

                    <div class="form-group">
                        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer <span class="required">*</span></label>
                        <input type="text" id="activity-organizer" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° | Start Date <span class="required">*</span></label>
                            <input type="date" id="start-date" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î | End Date <span class="required">*</span></label>
                            <input type="date" id="end-date" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ | Duration <span class="required">*</span></label>
                            <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ | Unit</label>
                            <select id="duration-unit">
                                <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | Hours</option>
                                <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô | Days</option>
                                <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | Weeks</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Level <span class="required">*</span></label>
                        <div class="level-options">
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="1" required>
                                <div class="level-card">
                                    <span class="level-number">1</span>
                                    <span class="level-title">‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å | Know</span>
                                    <span class="level-desc">‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢/‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡∏§‡∏©‡∏é‡∏µ</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="2">
                                <div class="level-card">
                                    <span class="level-number">2</span>
                                    <span class="level-title">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à | Understand</span>
                                    <span class="level-desc">Workshop/‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="3">
                                <div class="level-card">
                                    <span class="level-number">3</span>
                                    <span class="level-title">‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô | Apply</span>
                                    <span class="level-desc">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á/‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="4">
                                <div class="level-card">
                                    <span class="level-number">4</span>
                                    <span class="level-title">‡∏ú‡∏π‡πâ‡∏ô‡∏≥ | Lead</span>
                                    <span class="level-desc">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏™‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Reflection Section -->
                    <div class="reflection-section">
                        <h3>üìù ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Reflection</h3>
                        
                        <div class="reflection-intro">
                            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ</p>
                        </div>
                        
                        <!-- Question 1: Role -->
                        <div class="reflection-question">
                            <label>1Ô∏è‚É£ ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | My Role <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏ö‡∏£‡∏°, Staff ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô, ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                            </div>
                            <textarea id="reflection-role" required rows="2" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏ö‡∏£‡∏° / ‡πÄ‡∏õ‡πá‡∏ô Staff ‡∏î‡∏π‡πÅ‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô / ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"
                                oninput="updateCharCount(this, 'role-counter')"></textarea>
                            <div class="char-counter" id="role-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                        
                        <!-- Question 2: What I Did -->
                        <div class="reflection-question">
                            <label>2Ô∏è‚É£ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | What I Did <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢, ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠, ‡∏ù‡∏∂‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°, ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°, ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô, ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏°
                            </div>
                            <textarea id="reflection-activities" required rows="3" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á AI / ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ ChatGPT / ‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° 4 ‡∏Ñ‡∏ô / ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏±‡πâ‡∏ô"
                                oninput="updateCharCount(this, 'activities-counter')"></textarea>
                            <div class="char-counter" id="activities-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                        
                        <!-- Question 3: What I Learned -->
                        <div class="reflection-question">
                            <label>3Ô∏è‚É£ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ | What I Learned <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡πÑ‡∏î‡πâ‡∏ù‡∏∂‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤, ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà, ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠
                            </div>
                            <textarea id="reflection-learnings" required rows="3" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏° ‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ô / ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"
                                oninput="updateCharCount(this, 'learnings-counter')"></textarea>
                            <div class="char-counter" id="learnings-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (Link ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£) | Evidence Link</label>
                        <input type="url" id="evidence-link" placeholder="https://drive.google.com/...">
                    </div>

                    <div class="form-group">
                        <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô | Evidence Description</label>
                        <input type="text" id="evidence-desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®, Certificate">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">ü§ñ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢ AI ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á</button>
                    </div>
                </form>
            </div>

            <div class="submissions-card">
                <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Submissions</h2>
                <div id="my-submissions" class="submissions-list">
                    <div class="empty-state">
                        <span class="icon">üì≠</span>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-box">
                <div class="spinner"></div>
                <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>

        <!-- AI Analysis Result Modal -->
        <div id="ai-modal" class="modal-overlay">
            <div class="modal" style="max-width: 550px;">
                <div class="modal-icon">ü§ñ</div>
                <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏à‡∏≤‡∏Å AI</h3>
                <p style="color:#666; font-size:0.9em;">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏£‡∏≠‡∏Å</p>
                
                <div class="ai-result-section" id="ai-result-content">
                    <!-- AI results will be inserted here -->
                </div>
                
                <div class="ai-note">
                    üí° ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Admin ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤<br>
                    Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                </div>
                
                <div class="modal-actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button onclick="confirmSubmission()" class="btn-primary" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á</button>
                    <button onclick="closeAIModal()" class="btn-secondary">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>

        <div id="success-modal" class="modal-overlay">
            <div class="modal success-modal">
                <div class="modal-icon">‚úÖ</div>
                <h3>‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                <p class="modal-note">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</strong></p>
                <button onclick="closeModal()" class="btn-primary">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", nameEn: "Analytical Reasoning" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systematic Problem Solving" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°", nameEn: "Systems Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", nameEn: "Presentation Skills" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", nameEn: "Listening & Comprehension" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", nameEn: "English Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", nameEn: "Role Understanding" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", nameEn: "Task Management" },
            { code: "3.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", nameEn: "Collaborative Work" },
            { code: "4.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", nameEn: "Learning Agility" },
            { code: "4.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", nameEn: "Digital Literacy" },
            { code: "4.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", nameEn: "Tool Proficiency" },
            { code: "5.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", nameEn: "Human-Centered Design" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", nameEn: "Project Management" },
            { code: "5.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", nameEn: "Business Awareness" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", nameEn: "Personal Growth" },
            { code: "6.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", nameEn: "Resilience" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", nameEn: "Empathy" }
        ];

        let currentStudent = null;
        let pendingFormData = null;
        let aiAnalysisResult = null;

        // Character counter
        function updateCharCount(textarea, counterId) {
            const counter = document.getElementById(counterId);
            const length = textarea.value.length;
            counter.textContent = `${length} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
            
            counter.classList.remove('warning', 'good');
            if (length >= 20) {
                counter.classList.add('good');
            } else if (length > 0) {
                counter.classList.add('warning');
            }
        }

        async function loginStudent() {
            const email = document.getElementById('student-email').value.trim().toLowerCase();
            const errorEl = document.getElementById('login-error');
            
            if (!email || !email.includes('@')) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...');
            
            try {
                const query = await db.collection('students').where('email', '==', email).limit(1).get();
                if (query.empty) {
                    errorEl.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                    showLoading(false);
                    return;
                }
                
                currentStudent = { id: query.docs[0].id, ...query.docs[0].data() };
                sessionStorage.setItem('studentSession', JSON.stringify(currentStudent));
                
                document.getElementById('student-avatar').textContent = currentStudent.name?.charAt(0) || 'S';
                document.getElementById('display-name').textContent = currentStudent.name || '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
                document.getElementById('display-email').textContent = currentStudent.email;
                
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('form-section').style.display = 'block';
                
                await loadMySubmissions();
            } catch (error) {
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
            }
            showLoading(false);
        }

        function logoutStudent() {
            currentStudent = null;
            sessionStorage.removeItem('studentSession');
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('form-section').style.display = 'none';
        }

        async function analyzeWithAI(formData) {
            const GEMINI_API_KEY = 'AIzaSyBBeBz8PZ_Jn2eGPCeKhrdFMFRjlGBxgzE';
            
            const prompt = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° ‡∏ï‡∏≤‡∏° CMU Engineer Competency V4 Rubric

üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:
- ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.activityName}
- ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î: ${formData.activityOrganizer}  
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.activityLevel}
- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${formData.duration} ${formData.durationUnit}

üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤:
- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ${formData.role}
- ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥: ${formData.activities}
- ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: ${formData.learnings}

üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ):
- Level 1 (‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å): ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥
- Level 2 (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à): ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡∏°‡∏µ‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
- Level 3 (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô): ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡∏≠‡∏ô
- Level 4 (‡∏ú‡∏π‡πâ‡∏ô‡∏≥): ‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î

üéØ ‡∏ó‡∏±‡∏Å‡∏©‡∏∞ 18 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤):
1.1 ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ
1.2 ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö - ‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
1.3 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö - ‡∏°‡∏≠‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°
2.1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ - ‡∏û‡∏π‡∏î ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô
2.2 ‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à - ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á ‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à
2.3 ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© - ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£
3.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó - ‡∏£‡∏π‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
3.2 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô - ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î
3.3 ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏° ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏±‡∏ô
4.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ - ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡πá‡∏ß
4.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• - ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• ‡πÅ‡∏≠‡∏û ‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå
4.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ - ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°
5.1 Human-Centered Design - ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏∂‡∏á‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
5.2 ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ - ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£
5.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô
6.1 ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• - ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î
6.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô - ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡πÑ‡∏°‡πà‡∏ó‡πâ‡∏≠
6.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô

‚ö†Ô∏è ‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1-3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏î‡∏π‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ)
2. ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞ (level) ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (${formData.activityLevel})
3. ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏£‡∏≠‡∏Å
4. ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: Staff/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î ‡∏°‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°

‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô:
{"skills":[{"code":"X.X","level":N,"reason":"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤"}]}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.7, maxOutputTokens: 1024 }
                    })
                });

                const result = await response.json();
                console.log('AI Response:', result);
                
                if (result.candidates && result.candidates[0]) {
                    const text = result.candidates[0].content.parts[0].text;
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    
                    if (jsonMatch) {
                        const analysis = JSON.parse(jsonMatch[0]);
                        analysis.skills = analysis.skills.map(s => ({
                            ...s,
                            level: Math.min(s.level, formData.activityLevel)
                        })).slice(0, 3);
                        return analysis;
                    }
                }
            } catch (error) {
                console.error('AI error:', error);
            }
            
            // Fallback analysis based on keywords
            return fallbackAnalysis(formData);
        }
        
        function fallbackAnalysis(formData) {
            const combined = `${formData.role} ${formData.activities} ${formData.learnings}`.toLowerCase();
            const skills = [];
            const maxLevel = formData.activityLevel;
            
            // Keyword matching
            if (combined.includes('‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠') || combined.includes('‡∏û‡∏π‡∏î') || combined.includes('present')) {
                skills.push({ code: '2.1', level: Math.min(2, maxLevel), reason: '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô' });
            }
            if (combined.includes('‡∏ó‡∏µ‡∏°') || combined.includes('‡∏Å‡∏•‡∏∏‡πà‡∏°') || combined.includes('‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô') || combined.includes('‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô')) {
                skills.push({ code: '3.3', level: Math.min(2, maxLevel), reason: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô' });
            }
            if (combined.includes('staff') || combined.includes('‡∏™‡∏ï‡πä‡∏≤‡∏ü') || combined.includes('‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô')) {
                skills.push({ code: '3.1', level: Math.min(2, maxLevel), reason: '‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Staff' });
            }
            if (combined.includes('‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î') || combined.includes('‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤') || combined.includes('organizer') || combined.includes('‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô')) {
                skills.push({ code: '5.2', level: Math.min(3, maxLevel), reason: '‡∏°‡∏µ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£' });
            }
            if (combined.includes('‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ') || combined.includes('‡∏≠‡∏ö‡∏£‡∏°') || combined.includes('workshop')) {
                skills.push({ code: '4.1', level: Math.min(2, maxLevel), reason: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà' });
            }
            if (combined.includes('‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•') || combined.includes('ai') || combined.includes('‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ') || combined.includes('‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°') || combined.includes('software')) {
                skills.push({ code: '4.2', level: Math.min(2, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•' });
            }
            if (combined.includes('‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠') || combined.includes('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå') || combined.includes('tool')) {
                skills.push({ code: '4.3', level: Math.min(2, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á' });
            }
            if (combined.includes('‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå') || combined.includes('‡∏Ñ‡∏¥‡∏î') || combined.includes('‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤')) {
                skills.push({ code: '1.1', level: Math.min(2, maxLevel), reason: '‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå' });
            }
            if (combined.includes('‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©') || combined.includes('english')) {
                skills.push({ code: '2.3', level: Math.min(2, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©' });
            }
            
            // Default if no matches
            if (skills.length === 0) {
                skills.push({ code: '4.1', level: Math.min(2, maxLevel), reason: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' });
            }
            
            return { skills: skills.slice(0, 3) };
        }

        async function submitActivity(event) {
            event.preventDefault();
            if (!currentStudent) return;
            
            // Validate reflection fields
            const role = document.getElementById('reflection-role').value.trim();
            const activities = document.getElementById('reflection-activities').value.trim();
            const learnings = document.getElementById('reflection-learnings').value.trim();
            
            if (role.length < 5) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-role').focus();
                return;
            }
            if (activities.length < 10) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-activities').focus();
                return;
            }
            if (learnings.length < 10) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-learnings').focus();
                return;
            }
            
            showLoading(true, 'ü§ñ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢ AI...');
            
            try {
                const formData = {
                    studentId: currentStudent.studentId,
                    studentName: currentStudent.name,
                    studentEmail: currentStudent.email,
                    activityName: document.getElementById('activity-name').value.trim(),
                    activityOrganizer: document.getElementById('activity-organizer').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: parseInt(document.getElementById('duration').value),
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.querySelector('input[name="activity-level"]:checked').value),
                    // Reflection data
                    role: role,
                    activities: activities,
                    learnings: learnings,
                    // Combined description for backward compatibility
                    description: `‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ${role}\n‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥: ${activities}\n‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: ${learnings}`,
                    evidenceLink: document.getElementById('evidence-link').value.trim(),
                    evidenceDescription: document.getElementById('evidence-desc').value.trim()
                };
                
                // Check for duplicate
                const existingQuery = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .where('activityName', '==', formData.activityName)
                    .get();
                
                if (!existingQuery.empty && existingQuery.docs[0].data().status === 'Pending Review') {
                    alert('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß');
                    showLoading(false);
                    return;
                }
                
                // AI Analysis
                aiAnalysisResult = await analyzeWithAI(formData);
                pendingFormData = formData;
                showLoading(false);
                
                // Show AI result modal
                showAIResultModal(aiAnalysisResult);
                
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                showLoading(false);
            }
        }

        function showAIResultModal(aiResult) {
            const content = document.getElementById('ai-result-content');
            
            let html = '';
            aiResult.skills.forEach(skill => {
                const criteria = CRITERIA_LIST.find(c => c.code === skill.code);
                html += `
                    <div class="ai-skill-card">
                        <div class="skill-header">
                            <div>
                                <span class="skill-code">${skill.code}</span>
                                <span class="skill-name">${criteria?.nameTh || skill.code}</span>
                            </div>
                            <span class="skill-level">Level ${skill.level}</span>
                        </div>
                        <div class="skill-reason">${skill.reason || '-'}</div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
            document.getElementById('ai-modal').classList.add('show');
        }

        async function confirmSubmission() {
            if (!pendingFormData || !aiAnalysisResult) return;
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            closeAIModal();
            
            try {
                await db.collection('submissions').add({
                    ...pendingFormData,
                    aiSuggestedSkills: aiAnalysisResult.skills,
                    status: 'Pending Review',
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Reset form
                document.getElementById('activity-form').reset();
                pendingFormData = null;
                aiAnalysisResult = null;
                
                document.getElementById('success-modal').classList.add('show');
                await loadMySubmissions();
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
            showLoading(false);
        }

        function closeAIModal() { document.getElementById('ai-modal').classList.remove('show'); }
        function closeModal() { document.getElementById('success-modal').classList.remove('show'); }

        async function loadMySubmissions() {
            const container = document.getElementById('my-submissions');
            try {
                const query = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .get();
                
                if (query.empty) {
                    container.innerHTML = '<div class="empty-state"><span class="icon">üì≠</span><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p></div>';
                    return;
                }
                
                // Sort by submittedAt desc in JavaScript
                const docs = query.docs.sort((a, b) => {
                    const timeA = a.data().submittedAt?.toDate?.() || new Date(0);
                    const timeB = b.data().submittedAt?.toDate?.() || new Date(0);
                    return timeB - timeA;
                });
                
                container.innerHTML = docs.map(doc => {
                    const data = doc.data();
                    const statusClass = data.status?.toLowerCase().includes('approved') ? 'approved' : 
                                        data.status?.toLowerCase().includes('rejected') ? 'rejected' : 'pending';
                    const statusText = statusClass === 'approved' ? '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' : 
                                       statusClass === 'rejected' ? '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    const date = data.submittedAt?.toDate?.() || new Date();
                    const skills = data.aiSuggestedSkills || [];
                    
                    return `<div class="submission-item status-${statusClass}">
                        <div class="submission-header">
                            <h4>${data.activityName}</h4>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="submission-meta">
                            <span>üìÖ ${data.startDate || '-'}</span>
                            <span>‚è±Ô∏è ${data.duration} ${data.durationUnit}</span>
                            <span>üìä Level ${data.activityLevel}</span>
                        </div>
                        ${skills.length > 0 ? `<div style="margin-top:8px;">
                            ${skills.map(s => `<span style="background:#e3f2fd;padding:2px 8px;border-radius:4px;font-size:0.8em;margin-right:4px;">${s.code} Lv.${s.level}</span>`).join('')}
                        </div>` : ''}
                        <div class="submission-date">‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${date.toLocaleDateString('th-TH')}</div>
                    </div>`;
                }).join('');
            } catch (error) {
                console.error('Load submissions error:', error);
                container.innerHTML = '<div class="empty-state"><span class="icon">‚ö†Ô∏è</span><p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p></div>';
            }
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading-overlay').classList.toggle('show', show);
        }

        document.getElementById('student-email').addEventListener('keypress', e => { if (e.key === 'Enter') loginStudent(); });

        document.addEventListener('DOMContentLoaded', async () => {
            const session = sessionStorage.getItem('studentSession');
            if (session) {
                try {
                    currentStudent = JSON.parse(session);
                    if (currentStudent.email) {
                        document.getElementById('student-avatar').textContent = currentStudent.name?.charAt(0) || 'S';
                        document.getElementById('display-name').textContent = currentStudent.name || '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
                        document.getElementById('display-email').textContent = currentStudent.email;
                        document.getElementById('login-section').style.display = 'none';
                        document.getElementById('form-section').style.display = 'block';
                        await loadMySubmissions();
                    }
                } catch (e) { sessionStorage.removeItem('studentSession'); }
            }
        });
    </script>
</body>
</html>
