<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - Student Activity Submission</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/form-style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üìù</span>
                <div>
                    <h1>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h1>
                    <p>Student Activity Submission System</p>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">üîç ‡∏î‡∏π‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
                <a href="organizer-form.html">üë®‚Äçüíº ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</a>
            </nav>
        </header>

        <!-- Login Section -->
        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                <div class="login-form">
                    <input type="email" id="student-email" placeholder="email@cmu.ac.th">
                    <input type="password" id="student-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (5 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™ ‡∏ô‡∏®.)" maxlength="5">
                    <button onclick="loginStudent()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <p id="login-error" class="error-message"></p>
                <p class="login-note">üí° ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô = ‡πÄ‡∏•‡∏Ç 5 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
            </div>
        </section>

        <!-- Form Section -->
        <section id="form-section" class="form-section" style="display: none;">
            <!-- Student Info Bar -->
            <div class="student-bar">
                <div class="student-info">
                    <span class="avatar" id="student-avatar">S</span>
                    <div>
                        <strong id="display-name">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</strong>
                        <span id="display-email">email@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutStudent()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <!-- Submission Form -->
            <div class="form-card">
                <h2>üìã ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                
                <form id="activity-form" onsubmit="submitActivity(event)">
                    <!-- Activity Name -->
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                        <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners">
                    </div>

                    <!-- Activity Organizer -->
                    <div class="form-group">
                        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                        <input type="text" id="activity-organizer" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC">
                    </div>

                    <!-- Date Range -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="required">*</span></label>
                            <input type="date" id="start-date" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="required">*</span></label>
                            <input type="date" id="end-date" required>
                        </div>
                    </div>

                    <!-- Duration -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ <span class="required">*</span></label>
                            <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="duration-unit">
                                <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô</option>
                                <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                            </select>
                        </div>
                    </div>

                    <!-- Activity Level -->
                    <div class="form-group">
                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                        <div class="level-options">
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="1" required>
                                <div class="level-card">
                                    <span class="level-number">1</span>
                                    <span class="level-title">‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</span>
                                    <span class="level-desc">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ü‡∏±‡∏á/‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="2">
                                <div class="level-card">
                                    <span class="level-number">2</span>
                                    <span class="level-title">Workshop</span>
                                    <span class="level-desc">‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥/‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="3">
                                <div class="level-card">
                                    <span class="level-number">3</span>
                                    <span class="level-title">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</span>
                                    <span class="level-desc">‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏à‡∏£‡∏¥‡∏á/‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="4">
                                <div class="level-card">
                                    <span class="level-number">4</span>
                                    <span class="level-title">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏ú‡∏π‡πâ‡∏ô‡∏≥</span>
                                    <span class="level-desc">‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° <span class="required">*</span></label>
                        <textarea id="description" required rows="4" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ..."></textarea>
                    </div>

                    <!-- Evidence -->
                    <div class="form-group">
                        <label>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (Link ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)</label>
                        <input type="url" id="evidence-link" placeholder="https://drive.google.com/...">
                    </div>

                    <div class="form-group">
                        <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</label>
                        <input type="text" id="evidence-desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®, Certificate">
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            üöÄ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                        </button>
                    </div>
                </form>
            </div>

            <!-- My Submissions -->
            <div class="submissions-card">
                <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                <div id="my-submissions" class="submissions-list">
                    <div class="empty-state">
                        <span class="icon">üì≠</span>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-box">
                <div class="spinner"></div>
                <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="modal-overlay">
            <div class="modal success-modal">
                <div class="modal-icon">‚úÖ</div>
                <h3>‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                <p class="modal-note">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</strong></p>
                <button onclick="closeModal()" class="btn-primary">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let currentStudent = null;

        // ============================================
        // LOGIN FUNCTION
        // ============================================
        async function loginStudent() {
            const email = document.getElementById('student-email').value.trim().toLowerCase();
            const password = document.getElementById('student-password').value.trim();
            const errorEl = document.getElementById('login-error');
            
            if (!email) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email';
                return;
            }
            
            if (!password) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
                return;
            }
            
            if (password.length !== 5) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 5 ‡∏´‡∏•‡∏±‡∏Å';
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            try {
                const query = await db.collection('students').where('email', '==', email).limit(1).get();
                
                if (query.empty) {
                    errorEl.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin';
                    showLoading(false);
                    return;
                }
                
                const doc = query.docs[0];
                const studentData = doc.data();
                
                // Validate password (last 5 digits of studentId)
                const studentId = studentData.studentId || '';
                const expectedPassword = studentId.slice(-5);
                
                if (password !== expectedPassword) {
                    errorEl.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                    showLoading(false);
                    return;
                }
                
                currentStudent = { id: doc.id, ...studentData };
                
                // Update UI
                document.getElementById('student-avatar').textContent = currentStudent.name?.charAt(0) || 'S';
                document.getElementById('display-name').textContent = currentStudent.name || '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
                document.getElementById('display-email').textContent = currentStudent.email;
                
                // Show form
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('form-section').style.display = 'block';
                
                // Load submissions
                await loadMySubmissions();
                
            } catch (error) {
                console.error('Login error:', error);
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
            }
            
            showLoading(false);
        }

        // ============================================
        // LOGOUT FUNCTION
        // ============================================
        function logoutStudent() {
            currentStudent = null;
            document.getElementById('activity-form').reset();
            document.getElementById('form-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('student-email').value = '';
            document.getElementById('student-password').value = '';
            document.getElementById('login-error').textContent = '';
        }

        // ============================================
        // SUBMIT ACTIVITY
        // ============================================
        async function submitActivity(event) {
            event.preventDefault();
            
            if (!currentStudent) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            try {
                const formData = {
                    // Student info
                    studentId: currentStudent.studentId,
                    studentName: currentStudent.name,
                    studentEmail: currentStudent.email,
                    
                    // Activity info
                    activityName: document.getElementById('activity-name').value.trim(),
                    activityOrganizer: document.getElementById('activity-organizer').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: parseInt(document.getElementById('duration').value),
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.querySelector('input[name="activity-level"]:checked').value),
                    description: document.getElementById('description').value.trim(),
                    evidenceLink: document.getElementById('evidence-link').value.trim(),
                    evidenceDescription: document.getElementById('evidence-desc').value.trim(),
                    
                    // Status
                    status: 'Pending Review',
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    reviewedBy: null,
                    reviewedAt: null,
                    rejectReason: null
                };
                
                // Check for duplicate
                const existingQuery = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .where('activityName', '==', formData.activityName)
                    .get();
                
                if (!existingQuery.empty) {
                    const existing = existingQuery.docs[0].data();
                    if (existing.status === 'Pending Review') {
                        alert('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                        showLoading(false);
                        return;
                    }
                }
                
                // Save to Firestore
                await db.collection('submissions').add(formData);
                
                // Reset form
                document.getElementById('activity-form').reset();
                
                // Show success
                document.getElementById('success-modal').classList.add('show');
                
                // Reload submissions
                await loadMySubmissions();
                
            } catch (error) {
                console.error('Submit error:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
            
            showLoading(false);
        }

        // ============================================
        // LOAD MY SUBMISSIONS
        // ============================================
        async function loadMySubmissions() {
            const container = document.getElementById('my-submissions');
            
            try {
                const query = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .orderBy('submittedAt', 'desc')
                    .get();
                
                if (query.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <span class="icon">üì≠</span>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = query.docs.map(doc => {
                    const data = doc.data();
                    const statusClass = getStatusClass(data.status);
                    const statusText = getStatusText(data.status);
                    const date = data.submittedAt?.toDate?.() || new Date();
                    
                    return `
                        <div class="submission-item status-${statusClass}">
                            <div class="submission-header">
                                <h4>${data.activityName}</h4>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div class="submission-meta">
                                <span>üìÖ ${data.startDate || '-'}</span>
                                <span>‚è±Ô∏è ${data.duration} ${data.durationUnit}</span>
                                <span>üìä Level ${data.activityLevel}</span>
                            </div>
                            <div class="submission-date">
                                ‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${date.toLocaleDateString('th-TH')} ${date.toLocaleTimeString('th-TH')}
                            </div>
                            ${data.status.includes('Rejected') ? `
                                <div class="reject-reason">
                                    ‚ùå ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${data.rejectReason || '-'}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Load submissions error:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="icon">‚ö†Ô∏è</span>
                        <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>
                    </div>
                `;
            }
        }

        // ============================================
        // HELPERS
        // ============================================
        function getStatusClass(status) {
            if (!status) return 'pending';
            const s = status.toLowerCase();
            if (s.includes('approved')) return 'approved';
            if (s.includes('rejected')) return 'rejected';
            return 'pending';
        }

        function getStatusText(status) {
            if (!status) return '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            const s = status.toLowerCase();
            if (s.includes('approved')) return '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
            if (s.includes('rejected')) return '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            return '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').textContent = text;
            if (show) {
                overlay.classList.add('show');
            } else {
                overlay.classList.remove('show');
            }
        }

        function closeModal() {
            document.getElementById('success-modal').classList.remove('show');
        }

        // Enter key handler
        document.getElementById('student-email').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('student-password').focus();
            }
        });
        
        document.getElementById('student-password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginStudent();
        });
    </script>
</body>
</html>
