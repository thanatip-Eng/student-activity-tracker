<!DOCTYPE html>
<html lang="th">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Submit Activity - Student Talent Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/form-style.css">
    <style>
        /* Reflection Section Styles */
        .reflection-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #81c784;
        }
        .reflection-section h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .reflection-intro {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        .reflection-intro p {
            color: #555;
            font-size: 0.95em;
            margin: 0;
        }
        .reflection-question {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #a5d6a7;
        }
        .reflection-question label {
            display: block;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 8px;
            font-size: 1em;
        }
        .reflection-question .question-hint {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .reflection-question .question-hint strong {
            color: #1976d2;
        }
        .reflection-question textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .reflection-question textarea:focus {
            outline: none;
            border-color: #4caf50;
        }
        .reflection-question textarea::placeholder {
            color: #999;
        }
        
        /* AI Result Styles */
        .ai-result-section {
            margin-top: 20px;
        }
        .ai-skill-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .ai-skill-card .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .ai-skill-card .skill-code {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }
        .ai-skill-card .skill-name {
            color: #333;
            font-size: 0.95em;
        }
        .ai-skill-card .skill-level {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .ai-skill-card .skill-reason {
            background: #f0f4ff;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #555;
            margin-top: 8px;
        }
        .ai-skill-card .skill-reason::before {
            content: "üí° ";
        }
        
        .ai-note {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
        .ai-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65em;
            font-weight: 600;
            margin-left: 8px;
            vertical-align: middle;
        }
        .ai-badge-ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .ai-badge-rule {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        /* Character counter */
        .char-counter {
            text-align: right;
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
        }
        .char-counter.warning { color: #f39c12; }
        .char-counter.good { color: #27ae60; }
        
        /* Survey Modal Styles */
        .survey-modal {
            text-align: center;
        }
        .survey-question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .survey-question:last-of-type {
            border-bottom: none;
        }
        .survey-question label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            text-align: left;
        }
        .rating-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .rating-group label {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            position: relative;
        }
        .rating-group label:hover {
            background: #e8f4fd;
        }
        .rating-group input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .rating-group input[type="radio"]:checked + label,
        .rating-group label:has(input:checked) {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            color: #999;
            margin-top: 5px;
        }
        .btn-secondary {
            padding: 12px 24px;
            background: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        /* Activity Suggestions Dropdown */
        .activity-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .suggestion-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.15s;
        }
        .suggestion-item:hover {
            background: #f0f8ff;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .suggestion-name {
            font-weight: 600;
            font-size: 0.95em;
            color: #333;
        }
        .suggestion-name mark {
            background: #fff3cd;
            color: #333;
            padding: 0 2px;
            border-radius: 2px;
        }
        .suggestion-meta {
            font-size: 0.8em;
            color: #888;
            margin-top: 2px;
        }
        .suggestion-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }
        .suggestion-skill-tag {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 0.75em;
        }
        .suggestion-header {
            padding: 6px 14px;
            background: #f8f9fa;
            font-size: 0.78em;
            color: #888;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <img src="images/MainLogo.png" alt="Student Talent Development" class="logo-img">
                <div>
                    <h1>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Submit Activity</h1>
                    <p>Student Talent Development System</p>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å | Home</a>
                <a href="student-portal.html">üîç ‡∏î‡∏π‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Results</a>
            </nav>
        </header>

        <section id="login-section" class="login-section">
            <div class="login-card">
                <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student Search</h2>
                <p>‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Enter your Email to submit activity</p>
                <div class="login-form">
                    <input type="email" id="student-email" placeholder="Email (example@cmu.ac.th)">
                    <button onclick="loginStudent()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ | Search</button>
                </div>
                <p id="login-error" class="error-message"></p>
                <p class="login-note">üí° ‡πÉ‡∏ä‡πâ Email ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ | Use your registered Email</p>
            </div>
        </section>

        <section id="form-section" class="form-section" style="display: none;">
            <div class="student-bar">
                <div class="student-info">
                    <span class="avatar" id="student-avatar">S</span>
                    <div>
                        <strong id="display-name">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | Student</strong>
                        <span id="display-email">email@cmu.ac.th</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="logoutStudent()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö | Logout</button>
            </div>

            <div class="form-card">
                <h2>üìã ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Submission Form</h2>
                
                <form id="activity-form" onsubmit="submitActivity(event)">
                    <div class="form-group" style="position:relative;">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Name <span class="required">*</span></label>
                        <input type="text" id="activity-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Workshop AI for Beginners" autocomplete="off" oninput="filterActivitySuggestions(); detectLinkedInLearning()">
                        <div id="activity-suggestions" class="activity-suggestions" style="display:none;"></div>
                        <div id="activity-match-info" style="display:none;margin-top:6px;padding:8px 12px;background:#e8f5e9;border-radius:8px;border-left:3px solid #27ae60;font-size:0.85em;"></div>
                    </div>

                    <div class="form-group">
                        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Organizer <span class="required">*</span></label>
                        <input type="text" id="activity-organizer" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° | Start Date <span class="required">*</span></label>
                            <input type="date" id="start-date" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î | End Date <span class="required">*</span></label>
                            <input type="date" id="end-date" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ | Duration <span class="required">*</span></label>
                            <input type="number" id="duration" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ | Unit</label>
                            <select id="duration-unit">
                                <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á | Hours</option>
                                <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô | Days</option>
                                <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | Weeks</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Level <span class="required">*</span></label>
                        <div class="level-options">
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="1" required>
                                <div class="level-card">
                                    <span class="level-number">1</span>
                                    <span class="level-title">‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å | Know</span>
                                    <span class="level-desc">‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢/‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡∏§‡∏©‡∏é‡∏µ</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="2">
                                <div class="level-card">
                                    <span class="level-number">2</span>
                                    <span class="level-title">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à | Understand</span>
                                    <span class="level-desc">Workshop/‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="3">
                                <div class="level-card">
                                    <span class="level-number">3</span>
                                    <span class="level-title">‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô | Apply</span>
                                    <span class="level-desc">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á/‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</span>
                                </div>
                            </label>
                            <label class="level-option">
                                <input type="radio" name="activity-level" value="4">
                                <div class="level-card">
                                    <span class="level-number">4</span>
                                    <span class="level-title">‡∏ú‡∏π‡πâ‡∏ô‡∏≥ | Lead</span>
                                    <span class="level-desc">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/‡∏™‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- LinkedIn Learning / Online Course Checkbox -->
                    <div class="form-group" id="linkedin-checkbox-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:12px 16px;background:#e3f2fd;border:2px solid #bbdefb;border-radius:10px;transition:all 0.3s;">
                            <input type="checkbox" id="is-linkedin-learning" style="width:20px;height:20px;cursor:pointer;" onchange="onLinkedInCheckboxChange()">
                            <div>
                                <span style="font-weight:600;color:#0077b5;">üîó ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏à‡∏≤‡∏Å LinkedIn Learning / Online Course</span>
                                <div style="font-size:0.82em;color:#666;margin-top:2px;">‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏à‡∏≤‡∏Å LinkedIn Learning, Coursera, Udemy ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
                            </div>
                        </label>
                        <div id="linkedin-auto-detect" style="display:none;margin-top:6px;padding:8px 12px;background:#fff3e0;border-radius:8px;border-left:3px solid #ff9800;font-size:0.85em;color:#e65100;">
                            üí° ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        </div>
                    </div>

                    <!-- Reflection Section -->
                    <div class="reflection-section">
                        <h3>üìù ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | Activity Reflection</h3>
                        
                        <div class="reflection-intro">
                            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ</p>
                        </div>
                        
                        <!-- Question 1: Role -->
                        <div class="reflection-question">
                            <label>1Ô∏è‚É£ ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | My Role <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏ö‡∏£‡∏°, Staff ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô, ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£, ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                            </div>
                            <textarea id="reflection-role" required rows="2" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏ö‡∏£‡∏° / ‡πÄ‡∏õ‡πá‡∏ô Staff ‡∏î‡∏π‡πÅ‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô / ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"
                                oninput="updateCharCount(this, 'role-counter')"></textarea>
                            <div class="char-counter" id="role-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                        
                        <!-- Question 2: What I Did -->
                        <div class="reflection-question">
                            <label>2Ô∏è‚É£ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | What I Did <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢, ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠, ‡∏ù‡∏∂‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°, ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°, ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô, ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏°
                            </div>
                            <textarea id="reflection-activities" required rows="3" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á AI / ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ ChatGPT / ‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° 4 ‡∏Ñ‡∏ô / ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏±‡πâ‡∏ô"
                                oninput="updateCharCount(this, 'activities-counter')"></textarea>
                            <div class="char-counter" id="activities-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                        
                        <!-- Question 3: What I Learned -->
                        <div class="reflection-question">
                            <label>3Ô∏è‚É£ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ | What I Learned <span class="required">*</span></label>
                            <div class="question-hint">
                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡πÑ‡∏î‡πâ‡∏ù‡∏∂‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤, ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà, ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠
                            </div>
                            <textarea id="reflection-learnings" required rows="3" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏° ‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ô / ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"
                                oninput="updateCharCount(this, 'learnings-counter')"></textarea>
                            <div class="char-counter" id="learnings-counter">0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (Link ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£) | Evidence Link</label>
                        <input type="url" id="evidence-link" placeholder="https://drive.google.com/...">
                    </div>

                    <div class="form-group">
                        <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô | Evidence Description</label>
                        <input type="text" id="evidence-desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®, Certificate">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">ü§ñ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢ AI ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á</button>
                    </div>
                </form>
            </div>

            <div class="submissions-card">
                <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | My Submissions</h2>
                <div id="my-submissions" class="submissions-list">
                    <div class="empty-state">
                        <span class="icon">üì≠</span>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-box">
                <div class="spinner"></div>
                <p id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>

        <!-- AI Analysis Result Modal -->
        <div id="ai-modal" class="modal-overlay">
            <div class="modal" style="max-width: 550px;">
                <div class="modal-icon">ü§ñ</div>
                <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏à‡∏≤‡∏Å AI</h3>
                <p style="color:#666; font-size:0.9em;">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏£‡∏≠‡∏Å</p>
                
                <div class="ai-result-section" id="ai-result-content">
                    <!-- AI results will be inserted here -->
                </div>
                
                <div class="ai-note">
                    üí° ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Admin ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤<br>
                    Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                </div>
                
                <div class="modal-actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button onclick="confirmSubmission()" class="btn-primary" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á</button>
                    <button onclick="closeAIModal()" class="btn-secondary">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>

        <div id="success-modal" class="modal-overlay">
            <div class="modal success-modal">
                <div class="modal-icon">‚úÖ</div>
                <h3>‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                <p class="modal-note">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</strong></p>
                <button onclick="closeModal()" class="btn-primary">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>
        
        <!-- Survey Modal for Research -->
        <div id="survey-modal" class="modal-overlay">
            <div class="modal survey-modal" style="max-width: 500px;">
                <div class="modal-icon">üìù</div>
                <h3>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</h3>
                <p style="color: #666; margin-bottom: 20px;">‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</p>
                
                <form id="survey-form" style="text-align: left;">
                    <input type="hidden" id="survey-submission-id">
                    <input type="hidden" id="survey-activity-name">
                    
                    <!-- Q1: Ease of use -->
                    <div class="survey-question">
                        <label>1. ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</label>
                        <div class="rating-group">
                            <label><input type="radio" name="q1_ease" value="1" required> 1</label>
                            <label><input type="radio" name="q1_ease" value="2"> 2</label>
                            <label><input type="radio" name="q1_ease" value="3"> 3</label>
                            <label><input type="radio" name="q1_ease" value="4"> 4</label>
                            <label><input type="radio" name="q1_ease" value="5"> 5</label>
                        </div>
                        <div class="rating-labels"><span>‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢</span><span>‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏Å</span></div>
                    </div>
                    
                    <!-- Q2: AI Helpfulness -->
                    <div class="survey-question">
                        <label>2. AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</label>
                        <div class="rating-group">
                            <label><input type="radio" name="q2_ai" value="1" required> 1</label>
                            <label><input type="radio" name="q2_ai" value="2"> 2</label>
                            <label><input type="radio" name="q2_ai" value="3"> 3</label>
                            <label><input type="radio" name="q2_ai" value="4"> 4</label>
                            <label><input type="radio" name="q2_ai" value="5"> 5</label>
                        </div>
                        <div class="rating-labels"><span>‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢</span><span>‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏Å</span></div>
                    </div>
                    
                    <!-- Q3: Understanding -->
                    <div class="survey-question">
                        <label>3. ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label>
                        <div class="rating-group">
                            <label><input type="radio" name="q3_reflection" value="1" required> 1</label>
                            <label><input type="radio" name="q3_reflection" value="2"> 2</label>
                            <label><input type="radio" name="q3_reflection" value="3"> 3</label>
                            <label><input type="radio" name="q3_reflection" value="4"> 4</label>
                            <label><input type="radio" name="q3_reflection" value="5"> 5</label>
                        </div>
                        <div class="rating-labels"><span>‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢</span><span>‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏Å</span></div>
                    </div>
                    
                    <!-- Q4: Would recommend -->
                    <div class="survey-question">
                        <label>4. ‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</label>
                        <div class="rating-group">
                            <label><input type="radio" name="q4_recommend" value="1" required> 1</label>
                            <label><input type="radio" name="q4_recommend" value="2"> 2</label>
                            <label><input type="radio" name="q4_recommend" value="3"> 3</label>
                            <label><input type="radio" name="q4_recommend" value="4"> 4</label>
                            <label><input type="radio" name="q4_recommend" value="5"> 5</label>
                        </div>
                        <div class="rating-labels"><span>‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢</span><span>‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏Å</span></div>
                    </div>
                    
                    <!-- Q5: Open feedback -->
                    <div class="survey-question">
                        <label>5. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea id="survey-feedback" rows="2" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-family:inherit;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="skipSurvey()" class="btn-secondary" style="flex:1;">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô</button>
                        <button type="submit" class="btn-primary" style="flex:1;">‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        const CRITERIA_LIST = [
            { code: "1.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", nameEn: "Analytical Reasoning" },
            { code: "1.2", nameTh: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö", nameEn: "Systematic Problem Solving" },
            { code: "1.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°", nameEn: "Systems Thinking" },
            { code: "2.1", nameTh: "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", nameEn: "Presentation Skills" },
            { code: "2.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", nameEn: "Listening & Comprehension" },
            { code: "2.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", nameEn: "English Communication" },
            { code: "3.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", nameEn: "Role Understanding" },
            { code: "3.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô", nameEn: "Task Management" },
            { code: "3.3", nameTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", nameEn: "Collaborative Work" },
            { code: "4.1", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ", nameEn: "Learning Agility" },
            { code: "4.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•", nameEn: "Digital Literacy" },
            { code: "4.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠", nameEn: "Tool Proficiency" },
            { code: "5.1", nameTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏∂‡∏î‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á", nameEn: "Human-Centered Design" },
            { code: "5.2", nameTh: "‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", nameEn: "Project Management" },
            { code: "5.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à", nameEn: "Business Awareness" },
            { code: "6.1", nameTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", nameEn: "Personal Growth" },
            { code: "6.2", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß", nameEn: "Resilience" },
            { code: "6.3", nameTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à", nameEn: "Empathy" }
        ];

        let currentStudent = null;
        let pendingFormData = null;
        let aiAnalysisResult = null;
        let allActivitiesCache = []; // Cache for activity name autocomplete

        // === Research Logging Variables ===
        let formStartTime = null;
        let aiAnalysisStartTime = null;
        let aiAnalysisEndTime = null;
        let sessionStartTime = Date.now();

        // Character counter
        function updateCharCount(textarea, counterId) {
            const counter = document.getElementById(counterId);
            const length = textarea.value.length;
            counter.textContent = `${length} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`;
            
            counter.classList.remove('warning', 'good');
            if (length >= 20) {
                counter.classList.add('good');
            } else if (length > 0) {
                counter.classList.add('warning');
            }
        }

        // ============================================
        // ACTIVITY NAME AUTOCOMPLETE
        // ============================================
        async function loadActivitiesForAutocomplete() {
            try {
                const query = await db.collection('activities').get();
                allActivitiesCache = query.docs.map(doc => {
                    const data = doc.data();
                    return {
                        name: data.name || '',
                        organizer: data.organizer || '',
                        date: data.date || '',
                        skills: data.skills || []
                    };
                }).filter(a => a.name);
                console.log('Loaded', allActivitiesCache.length, 'activities for autocomplete');
            } catch (error) {
                console.error('Failed to load activities for autocomplete:', error);
            }
        }

        function filterActivitySuggestions() {
            const input = document.getElementById('activity-name');
            const dropdown = document.getElementById('activity-suggestions');
            const matchInfo = document.getElementById('activity-match-info');
            const query = input.value.trim().toLowerCase();

            if (query.length < 2 || allActivitiesCache.length === 0) {
                dropdown.style.display = 'none';
                matchInfo.style.display = 'none';
                return;
            }

            const matches = allActivitiesCache.filter(a =>
                a.name.toLowerCase().includes(query)
            ).slice(0, 8);

            if (matches.length === 0) {
                dropdown.style.display = 'none';
                matchInfo.style.display = 'none';
                return;
            }

            dropdown.innerHTML = '<div class="suggestion-header">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (' + matches.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</div>' +
                matches.map((a, idx) => {
                    const highlighted = a.name.replace(new RegExp('(' + query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi'), '<mark>$1</mark>');
                    const skillTags = (a.skills || []).slice(0, 3).map(s => {
                        const c = CRITERIA_LIST.find(cr => cr.code === s.code);
                        return `<span class="suggestion-skill-tag">${s.code} ${c?.nameTh || ''} Lv.${s.level}</span>`;
                    }).join('');
                    return `<div class="suggestion-item" onclick="selectActivitySuggestion(${idx}, '${query}')">
                        <div class="suggestion-name">${highlighted}</div>
                        <div class="suggestion-meta">${a.organizer ? 'üë®‚Äçüíº ' + a.organizer : ''}${a.date ? ' | üìÖ ' + a.date : ''}</div>
                        ${skillTags ? '<div class="suggestion-skills">' + skillTags + '</div>' : ''}
                    </div>`;
                }).join('');

            dropdown.style.display = 'block';

            // Store matches for selection
            dropdown._matches = matches;
        }

        function selectActivitySuggestion(index, query) {
            const dropdown = document.getElementById('activity-suggestions');
            const matchInfo = document.getElementById('activity-match-info');
            const activity = dropdown._matches[index];

            if (!activity) return;

            document.getElementById('activity-name').value = activity.name;

            // Auto-fill organizer if available and empty
            const organizerInput = document.getElementById('activity-organizer');
            if (activity.organizer && !organizerInput.value.trim()) {
                organizerInput.value = activity.organizer;
            }

            dropdown.style.display = 'none';

            // Show match info with skills
            const skills = (activity.skills || []).slice(0, 3);
            if (skills.length > 0) {
                const skillTags = skills.map(s => {
                    const c = CRITERIA_LIST.find(cr => cr.code === s.code);
                    return `<span style="background:#c8e6c9;color:#1b5e20;padding:2px 8px;border-radius:10px;font-size:0.85em;">${s.code} ${c?.nameTh || ''} Lv.${s.level}</span>`;
                }).join(' ');
                matchInfo.innerHTML = `‚úÖ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß<br><div style="margin-top:5px;display:flex;flex-wrap:wrap;gap:4px;">‡∏ó‡∏±‡∏Å‡∏©‡∏∞: ${skillTags}</div>`;
                matchInfo.style.display = 'block';
            } else {
                matchInfo.innerHTML = '‚úÖ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß';
                matchInfo.style.display = 'block';
            }
        }

        // LinkedIn Learning auto-detect
        function detectLinkedInLearning() {
            const name = (document.getElementById('activity-name').value || '').trim();
            const hint = document.getElementById('linkedin-auto-detect');
            const checkbox = document.getElementById('is-linkedin-learning');

            if (!name || name.length < 5) {
                hint.style.display = 'none';
                return;
            }

            const lower = name.toLowerCase();
            const hasLinkedIn = lower.includes('linkedin');
            const hasThai = /[\u0E00-\u0E7F]/.test(name);
            const looksLikeCourse = /^[a-z0-9\s:,\-\.\(\)&\/\+\'\"]+$/i.test(name);
            const hasColon = lower.includes(':');
            const wordCount = name.split(/\s+/).length;

            const isLikely = hasLinkedIn || (!hasThai && looksLikeCourse && (hasColon || wordCount >= 3));

            if (isLikely && !checkbox.checked) {
                hint.style.display = 'block';
            } else {
                hint.style.display = 'none';
            }
        }

        function onLinkedInCheckboxChange() {
            const checkbox = document.getElementById('is-linkedin-learning');
            const hint = document.getElementById('linkedin-auto-detect');
            const group = document.getElementById('linkedin-checkbox-group').querySelector('label');

            if (checkbox.checked) {
                hint.style.display = 'none';
                group.style.background = '#c8e6c9';
                group.style.borderColor = '#4caf50';
            } else {
                group.style.background = '#e3f2fd';
                group.style.borderColor = '#bbdefb';
                detectLinkedInLearning();
            }
        }

        // Close suggestions on click outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('activity-suggestions');
            const input = document.getElementById('activity-name');
            if (dropdown && !dropdown.contains(e.target) && e.target !== input) {
                dropdown.style.display = 'none';
            }
        });

        async function loginStudent() {
            const email = document.getElementById('student-email').value.trim().toLowerCase();
            const errorEl = document.getElementById('login-error');
            
            if (!email || !email.includes('@')) {
                errorEl.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                return;
            }
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...');
            
            try {
                const query = await db.collection('students').where('email', '==', email).limit(1).get();
                if (query.empty) {
                    errorEl.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                    showLoading(false);
                    return;
                }
                
                currentStudent = { id: query.docs[0].id, ...query.docs[0].data() };
                sessionStorage.setItem('studentSession', JSON.stringify(currentStudent));
                
                document.getElementById('student-avatar').textContent = currentStudent.name?.charAt(0) || 'S';
                document.getElementById('display-name').textContent = currentStudent.name || '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
                document.getElementById('display-email').textContent = currentStudent.email;
                
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('form-section').style.display = 'block';
                
                // Track form start time for research
                formStartTime = Date.now();
                
                await Promise.all([loadMySubmissions(), loadActivitiesForAutocomplete()]);
            } catch (error) {
                errorEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
            }
            showLoading(false);
        }

        function logoutStudent() {
            currentStudent = null;
            sessionStorage.removeItem('studentSession');
            document.getElementById('login-section').style.display = 'flex';
            document.getElementById('form-section').style.display = 'none';
        }

        async function analyzeWithAI(formData) {
            const GEMINI_API_KEY = 'AIzaSyCiFyQQGHrp5gO0yjFtYALsqu_Fxpdydoo';
            
            // Track AI analysis start time
            aiAnalysisStartTime = Date.now();
            
            const prompt = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏ï‡∏≤‡∏° CMU Engineer Competency V4 Rubric

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:
- ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.activityName}
- ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î: ${formData.activityOrganizer}  
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.activityLevel}
- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${formData.duration} ${formData.durationUnit}

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å - ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞):
- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.role}
- ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${formData.activities}
- ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: ${formData.learnings}

## ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö (Level) ‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:
- **Level 1 (‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å)**: ‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢, ‡∏î‡∏π‡∏™‡∏≤‡∏ò‡∏¥‡∏ï, ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á, ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥
- **Level 2 (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à)**: Workshop, Lab, ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≥‡∏•‡∏≠‡∏á, ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
- **Level 3 (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô)**: ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á, ‡∏ó‡∏≥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£, ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô, ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ö‡∏≠‡∏Å
- **Level 4 (‡∏ú‡∏π‡πâ‡∏ô‡∏≥)**: ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô, ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ, ‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô, ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£

## ‚ö†Ô∏è ‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞

**‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô = ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô**

| ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó | ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|-------|---------------|--------|
| ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î/Organizer/‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô | Level 4 | ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ |
| ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°/Leader | Level 3-4 | ‡∏ô‡∏≥‡∏ó‡∏µ‡∏° ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à |
| ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£/‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô | Level 4 | ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô |
| ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠/Presenter | Level 3 | ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á |
| Staff/‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô | Level 2-3 | ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ |
| ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°/Participant | Level 2 | ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° |
| ‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á/Audience | Level 1 | ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥ |

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "Workshop AI for Beginners"
- ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î ‚Üí 5.2 ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Level 4 (‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô)
- ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£ ‚Üí 2.1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ Level 4 (‡∏™‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô)
- Staff ‚Üí 3.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó Level 2 (‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢)
- ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‚Üí 4.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• Level 2 (‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡∏≠‡∏ô)
- ‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á ‚Üí 4.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ Level 1 (‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢)

## CMU Engineer Competency - 6 Domains, 18 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞:

**Domain 1: ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Critical Thinking & Problem Solving)**
- 1.1 ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Analytical Reasoning) - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞ ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ
- 1.2 ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Systematic Problem Solving) - ‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ ‡∏ß‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ
- 1.3 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö (Systems Thinking) - ‡∏°‡∏≠‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏µ‡∏¢

**Domain 2: ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ (Communication)**
- 2.1 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ (Presentation Skills) - ‡∏û‡∏π‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô ‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
- 2.2 ‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à (Listening & Comprehension) - ‡∏ü‡∏±‡∏á‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö
- 2.3 ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (English Communication) - ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏û‡∏π‡∏î/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°

**Domain 3: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏° (Teamwork & Collaboration)**
- 3.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role Understanding) - ‡∏£‡∏π‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏á‡∏≤‡∏ô
- 3.2 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (Task Management) - ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î
- 3.3 ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô (Collaborative Work) - ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á

**Domain 4: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û (Professional Growth & Adaptability)**
- 4.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (Learning Agility) - ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡πá‡∏ß ‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
- 4.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (Digital Literacy) - ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏û ‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ AI ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
- 4.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Tool Proficiency) - ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Lab

**Domain 5: ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (Innovation & Business Acumen)**
- 5.1 Human-Centered Design - ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏∂‡∏á‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏ó‡∏≥ User Research ‡∏™‡∏£‡πâ‡∏≤‡∏á Prototype
- 5.2 ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Project Management) - ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£ ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤
- 5.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (Business Awareness) - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à Startup

**Domain 6: ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á (Self-Development & Resilience)**
- 6.1 ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personal Growth) - ‡∏£‡∏π‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á/‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î
- 6.2 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (Resilience & Adaptability) - ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÑ‡∏°‡πà‡∏ó‡πâ‡∏≠
- 6.3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏à (Empathy) - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ï‡πà‡∏≤‡∏á

## ‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1-3 ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏à‡∏≤‡∏Å "‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥" ‡πÅ‡∏•‡∏∞ "‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ" ‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
2. **‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö (Level) ‡πÇ‡∏î‡∏¢‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏à‡∏≤‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å** ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
3. ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (${formData.activityLevel})
4. ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≥

## ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô):
{"skills":[{"code":"X.X","level":N,"reason":"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤"}]}

‡∏ï‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ JSON ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.3, maxOutputTokens: 1024 }
                    })
                });

                const result = await response.json();
                console.log('AI Response:', result);
                
                if (result.candidates && result.candidates[0]) {
                    const text = result.candidates[0].content.parts[0].text;
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    
                    if (jsonMatch) {
                        aiAnalysisEndTime = Date.now();
                        const analysis = JSON.parse(jsonMatch[0]);
                        analysis.skills = analysis.skills.map(s => ({
                            ...s,
                            level: Math.min(s.level, formData.activityLevel)
                        })).slice(0, 3);
                        analysis.usedAI = true;
                        analysis.aiResponseTime = aiAnalysisEndTime - aiAnalysisStartTime;
                        return analysis;
                    }
                }
            } catch (error) {
                console.warn('AI error, using fallback:', error);
            }
            
            // Fallback analysis based on keywords
            aiAnalysisEndTime = Date.now();
            const fallback = fallbackAnalysis(formData);
            fallback.usedAI = false;
            fallback.aiResponseTime = aiAnalysisEndTime - aiAnalysisStartTime;
            return fallback;
        }
        
        function fallbackAnalysis(formData) {
            const combined = `${formData.role} ${formData.activities} ${formData.learnings}`.toLowerCase();
            const roleText = formData.role.toLowerCase();
            const skills = [];
            const maxLevel = formData.activityLevel;
            
            // Determine base level from role
            let roleBaseLevel = 2; // default
            if (roleText.includes('‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î') || roleText.includes('organizer') || roleText.includes('‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô') || roleText.includes('‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô')) {
                roleBaseLevel = 4;
            } else if (roleText.includes('‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤') || roleText.includes('leader') || roleText.includes('‡∏ô‡∏≥‡∏ó‡∏µ‡∏°') || roleText.includes('‡∏ú‡∏π‡πâ‡∏ô‡∏≥')) {
                roleBaseLevel = 3;
            } else if (roleText.includes('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£') || roleText.includes('‡∏™‡∏≠‡∏ô') || roleText.includes('‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î')) {
                roleBaseLevel = 4;
            } else if (roleText.includes('‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠') || roleText.includes('presenter') || roleText.includes('‡∏û‡∏π‡∏î')) {
                roleBaseLevel = 3;
            } else if (roleText.includes('staff') || roleText.includes('‡∏™‡∏ï‡πä‡∏≤‡∏ü') || roleText.includes('‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô') || roleText.includes('‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô')) {
                roleBaseLevel = 2;
            } else if (roleText.includes('‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°') || roleText.includes('participant') || roleText.includes('‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°')) {
                roleBaseLevel = 2;
            } else if (roleText.includes('‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á') || roleText.includes('audience') || roleText.includes('‡∏ü‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢')) {
                roleBaseLevel = 1;
            }
            
            // Keyword matching with role-based level
            if (combined.includes('‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠') || combined.includes('‡∏û‡∏π‡∏î') || combined.includes('present')) {
                skills.push({ code: '2.1', level: Math.min(roleBaseLevel, maxLevel), reason: '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô' });
            }
            if (combined.includes('‡∏ó‡∏µ‡∏°') || combined.includes('‡∏Å‡∏•‡∏∏‡πà‡∏°') || combined.includes('‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô') || combined.includes('‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô')) {
                skills.push({ code: '3.3', level: Math.min(roleBaseLevel, maxLevel), reason: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô' });
            }
            if (combined.includes('staff') || combined.includes('‡∏™‡∏ï‡πä‡∏≤‡∏ü') || combined.includes('‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô') || combined.includes('‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô')) {
                skills.push({ code: '3.1', level: Math.min(roleBaseLevel, maxLevel), reason: '‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Staff' });
            }
            if (combined.includes('‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î') || combined.includes('‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤') || combined.includes('organizer') || combined.includes('‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô') || combined.includes('‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£')) {
                skills.push({ code: '5.2', level: Math.min(roleBaseLevel, maxLevel), reason: '‡∏°‡∏µ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£' });
            }
            if (combined.includes('‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ') || combined.includes('‡∏≠‡∏ö‡∏£‡∏°') || combined.includes('workshop')) {
                skills.push({ code: '4.1', level: Math.min(roleBaseLevel, maxLevel), reason: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà' });
            }
            if (combined.includes('‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•') || combined.includes('ai') || combined.includes('‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ') || combined.includes('‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°') || combined.includes('software')) {
                skills.push({ code: '4.2', level: Math.min(roleBaseLevel, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•' });
            }
            if (combined.includes('‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠') || combined.includes('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå') || combined.includes('tool')) {
                skills.push({ code: '4.3', level: Math.min(roleBaseLevel, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á' });
            }
            if (combined.includes('‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå') || combined.includes('‡∏Ñ‡∏¥‡∏î') || combined.includes('‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤')) {
                skills.push({ code: '1.1', level: Math.min(roleBaseLevel, maxLevel), reason: '‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå' });
            }
            if (combined.includes('‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©') || combined.includes('english')) {
                skills.push({ code: '2.3', level: Math.min(roleBaseLevel, maxLevel), reason: '‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©' });
            }
            if (combined.includes('‡∏™‡∏≠‡∏ô') || combined.includes('‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î') || combined.includes('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£')) {
                skills.push({ code: '2.1', level: Math.min(4, maxLevel), reason: '‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô' });
            }
            
            // Default if no matches
            if (skills.length === 0) {
                skills.push({ code: '4.1', level: Math.min(roleBaseLevel, maxLevel), reason: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' });
            }
            
            return { skills: skills.slice(0, 3) };
        }

        async function submitActivity(event) {
            event.preventDefault();
            if (!currentStudent) return;
            
            // Validate reflection fields
            const role = document.getElementById('reflection-role').value.trim();
            const activities = document.getElementById('reflection-activities').value.trim();
            const learnings = document.getElementById('reflection-learnings').value.trim();
            
            if (role.length < 5) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-role').focus();
                return;
            }
            if (activities.length < 10) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-activities').focus();
                return;
            }
            if (learnings.length < 10) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ');
                document.getElementById('reflection-learnings').focus();
                return;
            }
            
            showLoading(true, 'ü§ñ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏î‡πâ‡∏ß‡∏¢ AI...');
            
            try {
                const formData = {
                    studentId: currentStudent.studentId,
                    studentName: currentStudent.name,
                    studentEmail: currentStudent.email,
                    activityName: document.getElementById('activity-name').value.trim(),
                    activityOrganizer: document.getElementById('activity-organizer').value.trim(),
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    duration: parseInt(document.getElementById('duration').value),
                    durationUnit: document.getElementById('duration-unit').value,
                    activityLevel: parseInt(document.querySelector('input[name="activity-level"]:checked').value),
                    // Reflection data
                    role: role,
                    activities: activities,
                    learnings: learnings,
                    // Combined description for backward compatibility
                    description: `‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ${role}\n‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥: ${activities}\n‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: ${learnings}`,
                    evidenceLink: document.getElementById('evidence-link').value.trim(),
                    evidenceDescription: document.getElementById('evidence-desc').value.trim(),
                    isLinkedInLearning: document.getElementById('is-linkedin-learning').checked
                };
                
                // Check for duplicate
                const existingQuery = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .where('activityName', '==', formData.activityName)
                    .get();
                
                if (!existingQuery.empty && existingQuery.docs[0].data().status === 'Pending Review') {
                    alert('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß');
                    showLoading(false);
                    return;
                }
                
                // AI Analysis
                aiAnalysisResult = await analyzeWithAI(formData);
                pendingFormData = formData;
                showLoading(false);
                
                // Show AI result modal
                showAIResultModal(aiAnalysisResult);
                
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                showLoading(false);
            }
        }

        function showAIResultModal(aiResult) {
            const content = document.getElementById('ai-result-content');
            const titleEl = document.querySelector('#ai-modal h3');
            
            // Update title with badge
            if (titleEl) {
                if (aiResult.usedAI) {
                    titleEl.innerHTML = '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏à‡∏≤‡∏Å AI <span class="ai-badge ai-badge-ai">AI</span>';
                } else {
                    titleEl.innerHTML = '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ <span class="ai-badge ai-badge-rule">Auto</span>';
                }
            }
            
            let html = '';
            aiResult.skills.forEach(skill => {
                const criteria = CRITERIA_LIST.find(c => c.code === skill.code);
                html += `
                    <div class="ai-skill-card">
                        <div class="skill-header">
                            <div>
                                <span class="skill-code">${skill.code}</span>
                                <span class="skill-name">${criteria?.nameTh || skill.code}</span>
                            </div>
                            <span class="skill-level">Level ${skill.level}</span>
                        </div>
                        <div class="skill-reason">${skill.reason || '-'}</div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
            document.getElementById('ai-modal').classList.add('show');
        }

        async function confirmSubmission() {
            if (!pendingFormData || !aiAnalysisResult) return;
            
            showLoading(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            closeAIModal();
            
            try {
                // Calculate research metrics
                const submissionTime = Date.now();
                const formCompletionTime = formStartTime ? (submissionTime - formStartTime) : null;
                
                // Create submission with research logging data
                const submissionData = {
                    ...pendingFormData,
                    aiSuggestedSkills: aiAnalysisResult.skills,
                    status: 'Pending Review',
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    
                    // === Research Logging Data ===
                    _research: {
                        usedAI: aiAnalysisResult.usedAI || false,
                        aiResponseTimeMs: aiAnalysisResult.aiResponseTime || null,
                        formCompletionTimeMs: formCompletionTime,
                        reflectionLengths: {
                            role: pendingFormData.role?.length || 0,
                            activities: pendingFormData.activities?.length || 0,
                            learnings: pendingFormData.learnings?.length || 0,
                            total: (pendingFormData.role?.length || 0) + 
                                   (pendingFormData.activities?.length || 0) + 
                                   (pendingFormData.learnings?.length || 0)
                        },
                        activityLevel: pendingFormData.activityLevel,
                        skillCount: aiAnalysisResult.skills?.length || 0,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    }
                };
                
                const docRef = await db.collection('submissions').add(submissionData);
                
                // Reset form
                document.getElementById('activity-form').reset();
                // Reset LinkedIn checkbox visual
                const linkedInGroup = document.getElementById('linkedin-checkbox-group')?.querySelector('label');
                if (linkedInGroup) { linkedInGroup.style.background = '#e3f2fd'; linkedInGroup.style.borderColor = '#bbdefb'; }
                document.getElementById('linkedin-auto-detect').style.display = 'none';
                const savedFormData = {...pendingFormData};
                pendingFormData = null;
                aiAnalysisResult = null;
                formStartTime = Date.now(); // Reset for next submission
                
                // Show survey modal instead of success modal
                showSurveyModal(docRef.id, savedFormData.activityName);
                await loadMySubmissions();
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
            showLoading(false);
        }

        function closeAIModal() { document.getElementById('ai-modal').classList.remove('show'); }
        function closeModal() { document.getElementById('success-modal').classList.remove('show'); }
        
        // === Survey Functions ===
        function showSurveyModal(submissionId, activityName) {
            document.getElementById('survey-submission-id').value = submissionId;
            document.getElementById('survey-activity-name').value = activityName;
            document.getElementById('survey-form').reset();
            document.getElementById('survey-modal').classList.add('show');
        }
        
        function closeSurveyModal() {
            document.getElementById('survey-modal').classList.remove('show');
        }
        
        function skipSurvey() {
            closeSurveyModal();
            // Show brief success message
            document.getElementById('success-modal').classList.add('show');
        }
        
        document.getElementById('survey-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submissionId = document.getElementById('survey-submission-id').value;
            const surveyData = {
                submissionId: submissionId,
                activityName: document.getElementById('survey-activity-name').value,
                studentEmail: currentStudent?.email,
                responses: {
                    easeOfUse: parseInt(document.querySelector('input[name="q1_ease"]:checked')?.value) || null,
                    aiAccuracy: parseInt(document.querySelector('input[name="q2_ai"]:checked')?.value) || null,
                    reflectionHelpful: parseInt(document.querySelector('input[name="q3_reflection"]:checked')?.value) || null,
                    wouldRecommend: parseInt(document.querySelector('input[name="q4_recommend"]:checked')?.value) || null,
                    feedback: document.getElementById('survey-feedback').value.trim()
                },
                submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                timestamp: new Date().toISOString()
            };
            
            try {
                // Save survey response
                await db.collection('surveys').add(surveyData);
                
                // Update submission with survey flag
                if (submissionId) {
                    await db.collection('submissions').doc(submissionId).update({
                        '_research.surveyCompleted': true
                    });
                }
                
                closeSurveyModal();
                
                // Show thank you message
                alert('üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô!');
                
            } catch (error) {
                console.error('Survey error:', error);
                closeSurveyModal();
            }
        });

        async function loadMySubmissions() {
            const container = document.getElementById('my-submissions');
            try {
                const query = await db.collection('submissions')
                    .where('studentEmail', '==', currentStudent.email)
                    .get();
                
                if (query.empty) {
                    container.innerHTML = '<div class="empty-state"><span class="icon">üì≠</span><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p></div>';
                    return;
                }
                
                // Sort by submittedAt desc in JavaScript
                const docs = query.docs.sort((a, b) => {
                    const timeA = a.data().submittedAt?.toDate?.() || new Date(0);
                    const timeB = b.data().submittedAt?.toDate?.() || new Date(0);
                    return timeB - timeA;
                });
                
                container.innerHTML = docs.map(doc => {
                    const data = doc.data();
                    const statusClass = data.status?.toLowerCase().includes('approved') ? 'approved' : 
                                        data.status?.toLowerCase().includes('rejected') ? 'rejected' : 'pending';
                    const statusText = statusClass === 'approved' ? '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' : 
                                       statusClass === 'rejected' ? '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    const date = data.submittedAt?.toDate?.() || new Date();
                    const skills = data.aiSuggestedSkills || [];
                    
                    // Show reject reason if rejected
                    const rejectReasonHtml = (statusClass === 'rejected' && data.rejectReason) ? `
                        <div style="background:#ffebee;border:1px solid #ef9a9a;border-radius:6px;padding:8px 10px;margin-top:8px;">
                            <span style="color:#c62828;font-weight:600;">üí¨ ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</span>
                            <span style="color:#b71c1c;">${data.rejectReason}</span>
                        </div>
                    ` : '';
                    
                    return `<div class="submission-item status-${statusClass}">
                        <div class="submission-header">
                            <h4>${data.activityName}</h4>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="submission-meta">
                            <span>üìÖ ${data.startDate || '-'}</span>
                            <span>‚è±Ô∏è ${data.duration} ${data.durationUnit}</span>
                            <span>üìä Level ${data.activityLevel}</span>
                        </div>
                        ${skills.length > 0 ? `<div style="margin-top:8px;">
                            ${skills.map(s => `<span style="background:#e3f2fd;padding:2px 8px;border-radius:4px;font-size:0.8em;margin-right:4px;">${s.code} Lv.${s.level}</span>`).join('')}
                        </div>` : ''}
                        ${rejectReasonHtml}
                        <div class="submission-date">‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${date.toLocaleDateString('th-TH')}</div>
                    </div>`;
                }).join('');
            } catch (error) {
                console.error('Load submissions error:', error);
                container.innerHTML = '<div class="empty-state"><span class="icon">‚ö†Ô∏è</span><p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p></div>';
            }
        }

        function showLoading(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading-overlay').classList.toggle('show', show);
        }

        document.getElementById('student-email').addEventListener('keypress', e => { if (e.key === 'Enter') loginStudent(); });

        document.addEventListener('DOMContentLoaded', async () => {
            const session = sessionStorage.getItem('studentSession');
            if (session) {
                try {
                    currentStudent = JSON.parse(session);
                    if (currentStudent.email) {
                        document.getElementById('student-avatar').textContent = currentStudent.name?.charAt(0) || 'S';
                        document.getElementById('display-name').textContent = currentStudent.name || '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤';
                        document.getElementById('display-email').textContent = currentStudent.email;
                        document.getElementById('login-section').style.display = 'none';
                        document.getElementById('form-section').style.display = 'block';
                        await Promise.all([loadMySubmissions(), loadActivitiesForAutocomplete()]);
                    }
                } catch (e) { sessionStorage.removeItem('studentSession'); }
            }
        });
    </script>
</body>
</html>
